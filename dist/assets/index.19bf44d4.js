var Bs=Object.defineProperty,Gs=Object.defineProperties;var zs=Object.getOwnPropertyDescriptors;var oi=Object.getOwnPropertySymbols;var js=Object.prototype.hasOwnProperty,$s=Object.prototype.propertyIsEnumerable;var ai=(e,t,i)=>t in e?Bs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,li=(e,t)=>{for(var i in t||(t={}))js.call(t,i)&&ai(e,i,t[i]);if(oi)for(var i of oi(t))$s.call(t,i)&&ai(e,i,t[i]);return e},hi=(e,t)=>Gs(e,zs(t));import{L as x,l as g,a as qs,c as ci,b as Hs,d as Vs,e as Zs,f as ui,g as Js,h as Ks}from"./vendor.6fcaca65.js";const Ws=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}};Ws();L.Control.Slider=L.Control.extend({update:function(e){return e},options:{size:"100px",position:"topright",min:0,max:250,step:1,id:"slider",value:50,collapsed:!0,title:"Leaflet Slider",logo:"S",orientation:"horizontal",increment:!1,getValue:function(e){return e},showValue:!0,syncSlider:!1},initialize:function(e,t){L.setOptions(this,t),typeof e=="function"?this.update=e:this.update=function(i){console.log(i)},typeof this.options.getValue!="function"&&(this.options.getValue=function(i){return i}),this.options.orientation!="vertical"&&(this.options.orientation="horizontal")},onAdd:function(e){return this._initLayout(),this.update(this.options.value+""),this._container},_updateValue:function(){this.value=this.slider.value,this.options.showValue&&(this._sliderValue.innerHTML=this.options.getValue(this.value)),this.update(this.value)},_initLayout:function(){var e="leaflet-control-slider";this._container=L.DomUtil.create("div",e+" "+e+"-"+this.options.orientation),this._sliderLink=L.DomUtil.create("a",e+"-toggle",this._container),this._sliderLink.setAttribute("title",this.options.title),this._sliderLink.innerHTML=this.options.logo,this.options.showValue&&(this._sliderValue=L.DomUtil.create("p",e+"-value",this._container),this._sliderValue.innerHTML=this.options.getValue(this.options.value)),this.options.increment&&(this._plus=L.DomUtil.create("a",e+"-plus",this._container),this._plus.innerHTML="+",L.DomEvent.on(this._plus,"click",this._increment,this),L.DomUtil.addClass(this._container,"leaflet-control-slider-incdec")),this._sliderContainer=L.DomUtil.create("div","leaflet-slider-container",this._container),this.slider=L.DomUtil.create("input","leaflet-slider",this._sliderContainer),this.options.orientation=="vertical"&&this.slider.setAttribute("orient","vertical"),this.slider.setAttribute("title",this.options.title),this.slider.setAttribute("id",this.options.id),this.slider.setAttribute("type","range"),this.slider.setAttribute("min",this.options.min),this.slider.setAttribute("max",this.options.max),this.slider.setAttribute("step",this.options.step),this.slider.setAttribute("value",this.options.value),this.options.syncSlider?L.DomEvent.on(this.slider,"input",function(t){this._updateValue()},this):L.DomEvent.on(this.slider,"change",function(t){this._updateValue()},this),this.options.increment&&(this._minus=L.DomUtil.create("a",e+"-minus",this._container),this._minus.innerHTML="-",L.DomEvent.on(this._minus,"click",this._decrement,this)),this.options.showValue?window.matchMedia("screen and (-webkit-min-device-pixel-ratio:0)").matches&&this.options.orientation=="vertical"?(this.slider.style.width=this.options.size.replace("px","")-36+"px",this._sliderContainer.style.height=this.options.size.replace("px","")-36+"px"):this.options.orientation=="vertical"?this._sliderContainer.style.height=this.options.size.replace("px","")-36+"px":this._sliderContainer.style.width=this.options.size.replace("px","")-56+"px":window.matchMedia("screen and (-webkit-min-device-pixel-ratio:0)").matches&&this.options.orientation=="vertical"?(this.slider.style.width=this.options.size.replace("px","")-10+"px",this._sliderContainer.style.height=this.options.size.replace("px","")-10+"px"):this.options.orientation=="vertical"?this._sliderContainer.style.height=this.options.size.replace("px","")-10+"px":this._sliderContainer.style.width=this.options.size.replace("px","")-25+"px",L.DomEvent.disableClickPropagation(this._container),this.options.collapsed?(L.Browser.android||L.DomEvent.on(this._container,"mouseenter",this._expand,this).on(this._container,"mouseleave",this._collapse,this),L.Browser.touch?L.DomEvent.on(this._sliderLink,"click",L.DomEvent.stop).on(this._sliderLink,"click",this._expand,this):L.DomEvent.on(this._sliderLink,"focus",this._expand,this)):this._expand()},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-slider-expanded")},_collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-control-slider-expanded")},_increment:function(){console.log(this.slider.value-this.slider.step+" "+this.slider.value+this.slider.step),this.slider.value=this.slider.value*1+this.slider.step*1,this._updateValue()},_decrement:function(){console.log(this.slider.value-this.slider.step+" "+this.slider.value+this.slider.step),this.slider.value=this.slider.value*1-this.slider.step*1,this._updateValue()}});L.control.slider=function(e,t){return new L.Control.Slider(e,t)};function O(e){return e&&e.normalize&&e.normalize(),e&&e.textContent||""}const It=[["speed","speeds"],["course","courses"],["hAcc","hAccs"],["vAcc","vAccs"],["heartRate","heartRates"]];function di(e){const t={};if(e){const i=Z(e,"line");if(i){const s=O(Z(i,"color")),r=parseFloat(O(Z(i,"opacity"))),n=parseFloat(O(Z(i,"width")));s&&(t.stroke=s),isNaN(r)||(t["stroke-opacity"]=r),isNaN(n)||(t["stroke-width"]=n*96/25.4)}}return t}function _e(e,t){const i={};let s,r;for(r=0;r<t.length;r++)s=Z(e,t[r]),s&&(i[t[r]]=O(s));return i}function ye(e){const t=_e(e,["name","cmt","desc","type","time","keywords"]),i=e.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*");for(let r=0;r<i.length;r++){const n=i[r];n.parentNode.parentNode===e&&(t[n.tagName.replace(":","_")]=O(n))}const s=e.getElementsByTagName("link");s.length&&(t.links=[]);for(let r=0;r<s.length;r++)t.links.push(Object.assign({href:s[r].getAttribute("href")},_e(s[r],["text","type"])));return t}function Z(e,t){const i=e.getElementsByTagName(t);return i.length?i[0]:null}function fi(e){const t=[parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))],i=Z(e,"ele"),s=Z(e,"gpxtpx:hr")||Z(e,"hr"),r=Z(e,"time");let n;i&&(n=parseFloat(O(i)),isNaN(n)||t.push(n));const o={coordinates:t,time:r?O(r):null,heartRate:s?parseFloat(O(s)):null},a=Z(e,"extensions");return a!==null&&It.map(h=>h[0]).filter(h=>h!=="heartrate").forEach(h=>{const l=Z(a,h);if(l!==null){const c=parseFloat(O(l));isNaN(c)||(o[h]=c)}}),o}function Xs(e){const t=pi(e,"rtept");if(!!t.line)return{type:"Feature",properties:Object.assign(ye(e),di(Z(e,"extensions"))),geometry:{type:"LineString",coordinates:t.line}}}function pi(e,t){const i=e.getElementsByTagName(t),s=[],r=[],n=i.length,o={};if(n<2)return{};for(let h=0;h<n;h++){const l=fi(i[h]);s.push(l.coordinates),l.time&&r.push(l.time),It.map(c=>c[0]).forEach(c=>{(l[c]||o[c])&&(o[c]||(o[c]=Array(h).fill(null)),o[c].push(l[c]||null))})}const a={line:s,times:r};return It.forEach(h=>{o[h[0]]&&(a[h[1]]=o[h[0]]||[])}),a}function Ys(e){const t=e.getElementsByTagName("trkseg"),i=[],s=[],r={};let n;for(let a=0;a<t.length;a++)n=pi(t[a],"trkpt"),n&&(n.line&&i.push(n.line),n.times&&n.times.length&&s.push(n.times),It.map(h=>h[1]).forEach(h=>{if(r[h]&&r[h].length||n[h]&&n[h].length){if(r[h]||(r[h]=[]),!r[h].length)for(let l=0;l<a;l++)r[h].push(Array(i[l].length).fill(null));n[h]&&n[h].length?r[h].push(n[h]):r[h].push(Array(n.line.length||0).fill(null))}}));if(i.length===0)return;const o=Object.assign(ye(e),di(Z(e,"extensions")));return s.length&&(o.coordTimes=i.length===1?s[0]:s),It.forEach(a=>{r[a[1]]&&r[a[1]].length&&(o[a[1]]=i.length===1?r[a[1]][0]:r[a[1]])}),{type:"Feature",properties:o,geometry:{type:i.length===1?"LineString":"MultiLineString",coordinates:i.length===1?i[0]:i}}}function Qs(e){return{type:"Feature",properties:Object.assign(ye(e),_e(e,["sym"])),geometry:{type:"Point",coordinates:fi(e).coordinates}}}function*tr(e){const t=e.getElementsByTagName("trk"),i=e.getElementsByTagName("rte"),s=e.getElementsByTagName("wpt");for(let r=0;r<t.length;r++){const n=Ys(t[r]);n&&(yield n)}for(let r=0;r<i.length;r++){const n=Xs(i[r]);n&&(yield n)}for(let r=0;r<s.length;r++)yield Qs(s[r])}function er(e){return{type:"FeatureCollection",features:Array.from(tr(e))}}const ir=/\s*/g,sr=/^\s*|\s*$/g,rr=/\s+/;function mi(e){if(!e||!e.length)return 0;let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)|0;return t}function E(e,t){const i=e.getElementsByTagName(t);return i.length?i[0]:null}function gi(e){return e.replace(ir,"").split(",").map(parseFloat)}function _i(e){return e.replace(sr,"").split(rr).map(gi)}function ve(e){if(e.xml!==void 0)return e.xml;if(e.tagName){let t=e.tagName;for(let i=0;i<e.attributes.length;i++)t+=e.attributes[i].name+e.attributes[i].value;for(let i=0;i<e.childNodes.length;i++)t+=ve(e.childNodes[i]);return t}return e.nodeName==="#text"?(e.nodeValue||e.value||"").trim():e.nodeName==="#cdata-section"?e.nodeValue:""}const lt=["Polygon","LineString","Point","Track","gx:Track"];function yi(e){let t,i;return e=e||"",e.substr(0,1)==="#"&&(e=e.substr(1)),(e.length===6||e.length===3)&&(t=e),e.length===8&&(i=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(i)?void 0:i]}function nr(e){let t=e.getElementsByTagName("coord");const i=[],s=[];t.length===0&&(t=e.getElementsByTagName("gx:coord"));for(let n=0;n<t.length;n++)i.push(O(t[n]).split(" ").map(parseFloat));const r=e.getElementsByTagName("when");for(let n=0;n<r.length;n++)s.push(O(r[n]));return{coords:i,times:s}}function $t(e){let t,i,s,r,n;const o=[],a=[];if(E(e,"MultiGeometry"))return $t(E(e,"MultiGeometry"));if(E(e,"MultiTrack"))return $t(E(e,"MultiTrack"));if(E(e,"gx:MultiTrack"))return $t(E(e,"gx:MultiTrack"));for(s=0;s<lt.length;s++)if(i=e.getElementsByTagName(lt[s]),i){for(r=0;r<i.length;r++)if(t=i[r],lt[s]==="Point")o.push({type:"Point",coordinates:gi(O(E(t,"coordinates")))});else if(lt[s]==="LineString")o.push({type:"LineString",coordinates:_i(O(E(t,"coordinates")))});else if(lt[s]==="Polygon"){const h=t.getElementsByTagName("LinearRing"),l=[];for(n=0;n<h.length;n++)l.push(_i(O(E(h[n],"coordinates"))));o.push({type:"Polygon",coordinates:l})}else if(lt[s]==="Track"||lt[s]==="gx:Track"){const h=nr(t);o.push({type:"LineString",coordinates:h.coords}),h.times.length&&a.push(h.times)}}return{geoms:o,coordTimes:a}}function or(e,t,i,s){const r=$t(e);let n;const o={},a=O(E(e,"name")),h=O(E(e,"address"));let l=O(E(e,"styleUrl"));const c=O(E(e,"description")),u=E(e,"TimeSpan"),d=E(e,"TimeStamp"),f=E(e,"ExtendedData");let p=E(e,"LineStyle"),_=E(e,"PolyStyle");const v=E(e,"visibility");if(!r.geoms.length)return;if(a&&(o.name=a),h&&(o.address=h),l){l[0]!=="#"&&(l="#"+l),o.styleUrl=l,t[l]&&(o.styleHash=t[l]),i[l]&&(o.styleMapHash=i[l],o.styleHash=t[i[l].normal]);const b=s[o.styleHash];if(b){p||(p=E(b,"LineStyle")),_||(_=E(b,"PolyStyle"));const w=E(b,"IconStyle");if(w){const T=E(w,"Icon");if(T){const S=O(E(T,"href"));S&&(o.icon=S)}}}}if(c&&(o.description=c),u){const b=O(E(u,"begin")),w=O(E(u,"end"));o.timespan={begin:b,end:w}}if(d&&(o.timestamp=O(E(d,"when"))),p){const b=yi(O(E(p,"color"))),w=b[0],T=b[1],S=parseFloat(O(E(p,"width")));w&&(o.stroke=w),isNaN(T)||(o["stroke-opacity"]=T),isNaN(S)||(o["stroke-width"]=S)}if(_){const b=yi(O(E(_,"color"))),w=b[0],T=b[1],S=O(E(_,"fill")),R=O(E(_,"outline"));w&&(o.fill=w),isNaN(T)||(o["fill-opacity"]=T),S&&(o["fill-opacity"]=S==="1"?o["fill-opacity"]||1:0),R&&(o["stroke-opacity"]=R==="1"?o["stroke-opacity"]||1:0)}if(f){const b=f.getElementsByTagName("Data"),w=f.getElementsByTagName("SimpleData");for(n=0;n<b.length;n++)o[b[n].getAttribute("name")]=O(E(b[n],"value"));for(n=0;n<w.length;n++)o[w[n].getAttribute("name")]=O(w[n])}v&&(o.visibility=O(v)),r.coordTimes.length&&(o.coordTimes=r.coordTimes.length===1?r.coordTimes[0]:r.coordTimes);const k={type:"Feature",geometry:r.geoms.length===1?r.geoms[0]:{type:"GeometryCollection",geometries:r.geoms},properties:o};return e.getAttribute("id")&&(k.id=e.getAttribute("id")),k}function*ar(e){const t={},i={},s={},r=e.getElementsByTagName("Placemark"),n=e.getElementsByTagName("Style"),o=e.getElementsByTagName("StyleMap");for(let a=0;a<n.length;a++){const h=mi(ve(n[a])).toString(16);t["#"+n[a].getAttribute("id")]=h,i[h]=n[a]}for(let a=0;a<o.length;a++){t["#"+o[a].getAttribute("id")]=mi(ve(o[a])).toString(16);const h=o[a].getElementsByTagName("Pair"),l={};for(let c=0;c<h.length;c++)l[O(E(h[c],"key"))]=O(E(h[c],"styleUrl"));s["#"+o[a].getAttribute("id")]=l}for(let a=0;a<r.length;a++){const h=or(r[a],t,s,i);h&&(yield h)}}function lr(e){return{type:"FeatureCollection",features:Array.from(ar(e))}}const hr=x.Layer.extend({options:{layer:x.geoJson,layerOptions:{},fileSizeLimit:1024},initialize(e,t){this._map=e,x.Util.setOptions(this,t),this._parsers={geojson:this._loadGeoJSON,json:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load(e,t){let i,s;return this._isParameterMissing(e,"file")||!this._isFileSizeOk(e.size)||(i=this._getParser(e.name,t),!i)?!1:(s=new FileReader,s.addEventListener("load",x.Util.bind(function(r){let n;try{this.fire("data:loading",{filename:e.name,format:i.ext}),n=i.processor.call(this,r.target.result,i.ext),this.fire("data:loaded",{layer:n,filename:e.name,format:i.ext})}catch(o){this.fire("data:error",{error:o})}},this)),e.testing||s.readAsText(e),s)},loadMultiple(e,t){const i=[];if(e[0])for(e=Array.prototype.slice.apply(e);e.length>0;)i.push(this.load(e.shift(),t));return i},loadData(e,t,i){let s,r;if(!(this._isParameterMissing(e,"data")||this._isParameterMissing(t,"name"))&&!!this._isFileSizeOk(e.length)&&(s=this._getParser(t,i),!!s))try{this.fire("data:loading",{filename:t,format:s.ext}),r=s.processor.call(this,e,s.ext),this.fire("data:loaded",{layer:r,filename:t,format:s.ext})}catch(n){this.fire("data:error",{error:n})}},_isParameterMissing(e,t){return typeof e=="undefined"?(this.fire("data:error",{error:new Error("Missing parameter: "+t)}),!0):!1},_getParser(e,t){let i;if(t=t||e.split(".").pop(),i=this._parsers[t],!i){this.fire("data:error",{error:new Error("Unsupported file type ("+t+")")});return}return{processor:i,ext:t}},_isFileSizeOk(e){const t=(e/1024).toFixed(4);return t>this.options.fileSizeLimit?(this.fire("data:error",{error:new Error("File size exceeds limit ("+t+" > "+this.options.fileSizeLimit+"kb)")}),!1):!0},_loadGeoJSON:function(t){let i;if(typeof t=="string"&&(t=JSON.parse(t)),i=this.options.layer(t,this.options.layerOptions),i.getLayers().length===0)throw new Error("GeoJSON has no valid layers.");return this.options.addToMap&&i.addTo(this._map),i},_convertToGeoJSON:function(t,i){let s;return typeof t=="string"&&(t=new window.DOMParser().parseFromString(t,"text/xml")),i==="gpx"&&(s=er(t)),i==="kml"&&(s=lr(t)),this._loadGeoJSON(s)}}),cr=x.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{},addToMap:!0,fileSizeLimit:1024},initialize(e){x.Util.setOptions(this,e),this.loader=null},onAdd(e){return this.loader=x.FileLayer.fileLoader(e,this.options),this.loader.on("data:loaded",function(t){this.options.fitBounds&&window.setTimeout(function(){e.fitBounds(t.layer.getBounds())},500)},this),this._initDragAndDrop(e),this._initContainer()},_initDragAndDrop(e){let t;const i=this.loader,s=e._container,r={dragenter(){e.scrollWheelZoom.disable()},dragleave(){e.scrollWheelZoom.enable()},dragover(n){n.stopPropagation(),n.preventDefault()},drop(n){n.stopPropagation(),n.preventDefault(),i.loadMultiple(n.dataTransfer.files),e.scrollWheelZoom.enable()}};for(t in r)r.hasOwnProperty(t)&&s.addEventListener(t,r[t],!1)},_initContainer(){const e=this.loader,t="leaflet-control-filelayer leaflet-control-zoom",i="leaflet-bar",s=i+"-part",r=x.DomUtil.create("div",t+" "+i),n=x.DomUtil.create("a",t+"-in "+s,r);n.innerHTML=x.Control.FileLayerLoad.LABEL,n.href="#",n.title=x.Control.FileLayerLoad.TITLE;const o=x.DomUtil.create("input","hidden",r);return o.type="file",o.multiple="multiple",o.accept=this.options.formats?this.options.formats.join(","):".gpx,.kml,.json,.geojson",o.style.display="none",o.addEventListener("change",function(){e.loadMultiple(this.files),this.value=""},!1),x.DomEvent.disableClickPropagation(n),x.DomEvent.on(n,"click",function(a){o.click(),a.preventDefault()}),r}});x.FileLayer={};x.FileLayer.FileLoader=hr;x.FileLayer.fileLoader=function(e,t){return new x.FileLayer.FileLoader(e,t)};x.Control.FileLayerLoad=cr;x.Control.fileLayerLoad=function(e){return new x.Control.FileLayerLoad(e)};/*! Version: 0.6.1
Date: 2018-04-30 */L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,exclusiveGroups:[],groupCheckboxes:!1},initialize:function(e,t,i){var s,r;L.Util.setOptions(this,i),this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._groupList=[],this._domGroups=[];for(s in e)this._addLayer(e[s],s);for(s in t)for(r in t[s])this._addLayer(t[s][r],r,s,!0)},onAdd:function(e){return this._initLayout(),this._update(),e.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(e){e.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._update(),this},addOverlay:function(e,t,i){return this._addLayer(e,t,i,!0),this._update(),this},removeLayer:function(e){var t=L.Util.stamp(e),i=this._getLayer(t);return i&&delete this._layers[this._layers.indexOf(i)],this._update(),this},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&L.stamp(this._layers[t].layer)===e)return this._layers[t]},_initLayout:function(){var e="leaflet-control-layers",t=this._container=L.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(t,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(t),L.DomEvent.on(t,"wheel",L.DomEvent.stopPropagation));var i=this._form=L.DomUtil.create("form",e+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);var s=this._layersLink=L.DomUtil.create("a",e+"-toggle",t);s.href="#",s.title="Layers",L.Browser.touch?L.DomEvent.on(s,"click",L.DomEvent.stop).on(s,"click",this._expand,this):L.DomEvent.on(s,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",e+"-base",i),this._separator=L.DomUtil.create("div",e+"-separator",i),this._overlaysList=L.DomUtil.create("div",e+"-overlays",i),t.appendChild(i)},_addLayer:function(e,t,i,s){var r=(L.Util.stamp(e),{layer:e,name:t,overlay:s});this._layers.push(r),i=i||"";var n=this._indexOf(this._groupList,i);n===-1&&(n=this._groupList.push(i)-1);var o=this._indexOf(this.options.exclusiveGroups,i)!==-1;r.group={name:i,id:n,exclusive:o},this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="",this._domGroups.length=0;for(var e,t,i=!1,s=!1,e=0;e<this._layers.length;e++)t=this._layers[e],this._addItem(t),s=s||t.overlay,i=i||!t.overlay;this._separator.style.display=s&&i?"":"none"}},_onLayerChange:function(e){var t,i=this._getLayer(L.Util.stamp(e.layer));i&&(this._handlingClick||this._update(),t=i.overlay?e.type==="layeradd"?"overlayadd":"overlayremove":e.type==="layeradd"?"baselayerchange":null,t&&this._map.fire(t,i))},_createRadioElement:function(e,t){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"';t&&(i+=' checked="checked"'),i+="/>";var s=document.createElement("div");return s.innerHTML=i,s.firstChild},_addItem:function(e){var t,i,s,r=document.createElement("label"),n=this._map.hasLayer(e.layer);e.overlay?e.group.exclusive?(s="leaflet-exclusive-group-layer-"+e.group.id,t=this._createRadioElement(s,n)):(t=document.createElement("input"),t.type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=n):t=this._createRadioElement("leaflet-base-layers",n),t.layerId=L.Util.stamp(e.layer),t.groupID=e.group.id,L.DomEvent.on(t,"click",this._onInputClick,this);var o=document.createElement("span");if(o.innerHTML=" "+e.name,r.appendChild(t),r.appendChild(o),e.overlay){i=this._overlaysList;var a=this._domGroups[e.group.id];if(!a){a=document.createElement("div"),a.className="leaflet-control-layers-group",a.id="leaflet-control-layers-group-"+e.group.id;var h=document.createElement("label");if(h.className="leaflet-control-layers-group-label",e.group.name!==""&&!e.group.exclusive&&this.options.groupCheckboxes){var l=document.createElement("input");l.type="checkbox",l.className="leaflet-control-layers-group-selector",l.groupID=e.group.id,l.legend=this,L.DomEvent.on(l,"click",this._onGroupInputClick,l),h.appendChild(l)}var c=document.createElement("span");c.className="leaflet-control-layers-group-name",c.innerHTML=e.group.name,h.appendChild(c),a.appendChild(h),i.appendChild(a),this._domGroups[e.group.id]=a}i=a}else i=this._baseLayersList;return i.appendChild(r),r},_onGroupInputClick:function(){var e,t,i,s=this.legend;s._handlingClick=!0;var r=s._form.getElementsByTagName("input"),n=r.length;for(e=0;n>e;e++)t=r[e],t.groupID===this.groupID&&t.className==="leaflet-control-layers-selector"&&(t.checked=this.checked,i=s._getLayer(t.layerId),t.checked&&!s._map.hasLayer(i.layer)?s._map.addLayer(i.layer):!t.checked&&s._map.hasLayer(i.layer)&&s._map.removeLayer(i.layer));s._handlingClick=!1},_onInputClick:function(){var e,t,i,s=this._form.getElementsByTagName("input"),r=s.length;for(this._handlingClick=!0,e=0;r>e;e++)t=s[e],t.className==="leaflet-control-layers-selector"&&(i=this._getLayer(t.layerId),t.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!t.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer));this._handlingClick=!1},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");var e=this._map._size.y-4*this._container.offsetTop;e<this._form.clientHeight&&(L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=e+"px")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")},_indexOf:function(e,t){for(var i=0,s=e.length;s>i;i++)if(e[i]===t)return i;return-1}}),L.control.groupedLayers=function(e,t,i){return new L.Control.GroupedLayers(e,t,i)};var ur={exports:{}};/*!
Copyright (c) 2016 Dominik Moritz

This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/(function(e,t){(function(i,s){typeof s!="undefined"&&s.L?e.exports=i(L):e.exports=i(g.exports),typeof s!="undefined"&&s.L&&(s.L.Control.Locate=i(L))})(function(i){var s=function(l,c,u){u=u.split(" "),u.forEach(function(d){i.DomUtil[l].call(this,c,d)})},r=function(l,c){s("addClass",l,c)},n=function(l,c){s("removeClass",l,c)},o=i.Marker.extend({initialize:function(l,c){i.Util.setOptions(this,c),this._latlng=l,this.createIcon()},createIcon:function(){var l=this.options,c="";l.color!==void 0&&(c+="stroke:"+l.color+";"),l.weight!==void 0&&(c+="stroke-width:"+l.weight+";"),l.fillColor!==void 0&&(c+="fill:"+l.fillColor+";"),l.fillOpacity!==void 0&&(c+="fill-opacity:"+l.fillOpacity+";"),l.opacity!==void 0&&(c+="opacity:"+l.opacity+";");var u=this._getIconSVG(l,c);this._locationIcon=i.divIcon({className:u.className,html:u.svg,iconSize:[u.w,u.h]}),this.setIcon(this._locationIcon)},_getIconSVG:function(l,c){var u=l.radius,d=l.weight,f=u+d,p=f*2,_='<svg xmlns="http://www.w3.org/2000/svg" width="'+p+'" height="'+p+'" version="1.1" viewBox="-'+f+" -"+f+" "+p+" "+p+'"><circle r="'+u+'" style="'+c+'" /></svg>';return{className:"leaflet-control-locate-location",svg:_,w:p,h:p}},setStyle:function(l){i.Util.setOptions(this,l),this.createIcon()}}),a=o.extend({initialize:function(l,c,u){i.Util.setOptions(this,u),this._latlng=l,this._heading=c,this.createIcon()},setHeading:function(l){this._heading=l},_getIconSVG:function(l,c){var u=l.radius,d=l.width+l.weight,f=(u+l.depth+l.weight)*2,p="M0,0 l"+l.width/2+","+l.depth+" l-"+d+",0 z",_="transform: rotate("+this._heading+"deg)",v='<svg xmlns="http://www.w3.org/2000/svg" width="'+d+'" height="'+f+'" version="1.1" viewBox="-'+d/2+" 0 "+d+" "+f+'" style="'+_+'"><path d="'+p+'" style="'+c+'" /></svg>';return{className:"leaflet-control-locate-heading",svg:v,w:d,h:f}}}),h=i.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,initialZoomLevel:!1,getLocationBounds:function(l){return l.bounds},flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:o,compassClass:a,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:!0,createButtonCallback:function(l,c){var u=i.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",l);u.title=c.strings.title,u.role="button",u.href="#";var d=i.DomUtil.create(c.iconElementTag,c.icon,u);if(c.strings.text!==void 0){var f=i.DomUtil.create(c.textElementTag,"leaflet-locate-text",u);f.textContent=c.strings.text,u.classList.add("leaflet-locate-text-active"),u.parentNode.style.display="flex",c.icon.length>0&&d.classList.add("leaflet-locate-icon")}return{link:u,icon:d}},onLocationError:function(l,c){alert(l.message)},onLocationOutsideMapBounds:function(l){l.stop(),alert(l.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize:function(l){for(var c in l)typeof this.options[c]=="object"?i.extend(this.options[c],l[c]):this.options[c]=l[c];this.options.followMarkerStyle=i.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=i.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=i.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd:function(l){var c=i.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=c,this._map=l,this._layer=this.options.layer||new i.LayerGroup,this._layer.addTo(l),this._event=void 0,this._compassHeading=null,this._prevBounds=null;var u=this.options.createButtonCallback(c,this.options);return this._link=u.link,this._icon=u.icon,i.DomEvent.on(this._link,"click",function(d){i.DomEvent.stopPropagation(d),i.DomEvent.preventDefault(d),this._onClick()},this).on(this._link,"dblclick",i.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),c},_onClick:function(){this._justClicked=!0;var l=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active){var c=this.options.clickBehavior,u=c.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(u=l?c.inView:c.inViewNotFollowing),c[u]&&(u=c[u]),u){case"setView":this.setView();break;case"stop":if(this.stop(),this.options.returnToPrevBounds){var d=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;d.bind(this._map)(this._prevBounds)}break}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start:function(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop:function(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing:function(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate:function(){if(!this._active&&(this._map.locate(this.options.locateOptions),this._map.fire("locateactivate",this),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass)){var l="ondeviceorientationabsolute"in window;if(l||"ondeviceorientation"in window){var c=this,u=function(){i.DomEvent.on(window,l?"deviceorientationabsolute":"deviceorientation",c._onDeviceOrientation,c)};DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(d){d==="granted"&&u()}):u()}}},_deactivate:function(){this._map.stopLocate(),this._map.fire("locatedeactivate",this),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?i.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&i.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this))},setView:function(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this._justClicked&&this.options.initialZoomLevel!==!1){var l=this.options.flyTo?this._map.flyTo:this._map.setView;l.bind(this._map)([this._event.latitude,this._event.longitude],this.options.initialZoomLevel)}else if(this.options.keepCurrentZoomLevel){var l=this.options.flyTo?this._map.flyTo:this._map.panTo;l.bind(this._map)([this._event.latitude,this._event.longitude])}else{var l=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,l.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.initialZoomLevel||this.options.locateOptions.maxZoom}),i.Util.requestAnimFrame(function(){this._ignoreEvent=!1},this)}},_drawCompass:function(){if(!!this._event){var l=this._event.latlng;if(this.options.showCompass&&l&&this._compassHeading!==null){var c=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(l),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(c)):this._compass=new this.options.compassClass(l,this._compassHeading,c).addTo(this._layer)}this._compass&&(!this.options.showCompass||this._compassHeading===null)&&(this._compass.removeFrom(this._layer),this._compass=null)}},_drawMarker:function(){this._event.accuracy===void 0&&(this._event.accuracy=0);var l=this._event.accuracy,c=this._event.latlng;if(this.options.drawCircle){var u=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(c).setRadius(l).setStyle(u):this._circle=i.circle(c,l,u).addTo(this._layer)}var d,f;if(this.options.metric?(d=l.toFixed(0),f=this.options.strings.metersUnit):(d=(l*3.2808399).toFixed(0),f=this.options.strings.feetUnit),this.options.drawMarker){var p=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(c),this._marker.setStyle&&this._marker.setStyle(p)):this._marker=new this.options.markerClass(c,p).addTo(this._layer)}this._drawCompass();var _=this.options.strings.popup;function v(){return typeof _=="string"?i.Util.template(_,{distance:d,unit:f}):typeof _=="function"?_({distance:d,unit:f}):_}this.options.showPopup&&_&&this._marker&&this._marker.bindPopup(v())._popup.setLatLng(c),this.options.showPopup&&_&&this._compass&&this._compass.bindPopup(v())._popup.setLatLng(c)},_removeMarker:function(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload:function(){this.stop(),this._map.off("unload",this._unload,this)},_setCompassHeading:function(l){!isNaN(parseFloat(l))&&isFinite(l)?(l=Math.round(l),this._compassHeading=l,i.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration:function(){this._setCompassHeading()},_onDeviceOrientation:function(l){!this._active||(l.webkitCompassHeading?this._setCompassHeading(l.webkitCompassHeading):l.absolute&&l.alpha&&this._setCompassHeading(360-l.alpha))},_onLocationError:function(l){l.code==3&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(l,this))},_onLocationFound:function(l){if(!(this._event&&this._event.latlng.lat===l.latlng.lat&&this._event.latlng.lng===l.latlng.lng&&this._event.accuracy===l.accuracy)&&!!this._active){switch(this._event=l,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":!this._userPanned&&!this._userZoomed&&this.setView();break;case"always":this.setView();break}this._justClicked=!1}},_onDrag:function(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom:function(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd:function(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing:function(){if(!this._active)return!1;if(this.options.setView==="always")return!0;if(this.options.setView==="untilPan")return!this._userPanned;if(this.options.setView==="untilPanOrZoom")return!this._userPanned&&!this._userZoomed},_isOutsideMapBounds:function(){return this._event===void 0?!1:this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_updateContainerStyle:function(){!this._container||(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses:function(l){l=="requesting"?(n(this._container,"active following"),r(this._container,"requesting"),n(this._icon,this.options.icon),r(this._icon,this.options.iconLoading)):l=="active"?(n(this._container,"requesting following"),r(this._container,"active"),n(this._icon,this.options.iconLoading),r(this._icon,this.options.icon)):l=="following"&&(n(this._container,"requesting"),r(this._container,"active following"),n(this._icon,this.options.iconLoading),r(this._icon,this.options.icon))},_cleanClasses:function(){i.DomUtil.removeClass(this._container,"requesting"),i.DomUtil.removeClass(this._container,"active"),i.DomUtil.removeClass(this._container,"following"),n(this._icon,this.options.iconLoading),r(this._icon,this.options.icon)},_resetVariables:function(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});return i.control.locate=function(l){return new i.Control.Locate(l)},h},window)})(ur);var qt=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,rt=document.documentElement.style.pointerEvents==="",ht={cors:qt,pointerEvents:rt},dr={attributionWidthOffset:55},vi=0;function Ht(e){var t="";e.f=e.f||"json";for(var i in e)if(e.hasOwnProperty(i)){var s=e[i],r=Object.prototype.toString.call(s),n;t.length&&(t+="&"),r==="[object Array]"?n=Object.prototype.toString.call(s[0])==="[object Object]"?JSON.stringify(s):s.join(","):r==="[object Object]"?n=JSON.stringify(s):r==="[object Date]"?n=s.valueOf():n=s,t+=encodeURIComponent(i)+"="+encodeURIComponent(n)}return t}function be(e,t){var i=new window.XMLHttpRequest;return i.onerror=function(s){i.onreadystatechange=g.exports.Util.falseFn,e.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},i.onreadystatechange=function(){var s,r;if(i.readyState===4){try{s=JSON.parse(i.responseText)}catch{s=null,r={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!r&&s.error&&(r=s.error,s=null),i.onerror=g.exports.Util.falseFn,e.call(t,r,s)}},i.ontimeout=function(){this.onerror()},i}function fr(e,t,i,s){var r=be(i,s);return r.open("POST",e),typeof s!="undefined"&&s!==null&&typeof s.options!="undefined"&&(r.timeout=s.options.timeout),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(Ht(t)),r}function bi(e,t,i,s){var r=be(i,s);return r.open("GET",e+"?"+Ht(t),!0),typeof s!="undefined"&&s!==null&&typeof s.options!="undefined"&&(r.timeout=s.options.timeout,s.options.withCredentials&&(r.withCredentials=!0)),r.send(null),r}function xi(e,t,i,s){var r=Ht(t),n=be(i,s),o=(e+"?"+r).length;if(o<=2e3&&ht.cors?n.open("GET",e+"?"+r):o>2e3&&ht.cors&&(n.open("POST",e),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof s!="undefined"&&s!==null&&typeof s.options!="undefined"&&(n.timeout=s.options.timeout,s.options.withCredentials&&(n.withCredentials=!0)),o<=2e3&&ht.cors)n.send(null);else if(o>2e3&&ht.cors)n.send(r);else{if(o<=2e3&&!ht.cors)return xe(e,t,i,s);ct("a request to "+e+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");return}return n}function xe(e,t,i,s){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var r="c"+vi;t.callback="window._EsriLeafletCallbacks."+r,window._EsriLeafletCallbacks[r]=function(o){if(window._EsriLeafletCallbacks[r]!==!0){var a,h=Object.prototype.toString.call(o);h==="[object Object]"||h==="[object Array]"||(a={error:{code:500,message:"Expected array or object as JSONP response"}},o=null),!a&&o.error&&(a=o,o=null),i.call(s,a,o),window._EsriLeafletCallbacks[r]=!0}};var n=g.exports.DomUtil.create("script",null,document.body);return n.type="text/javascript",n.src=e+"?"+Ht(t),n.id=r,n.onerror=function(o){if(o&&window._EsriLeafletCallbacks[r]!==!0){var a={error:{code:500,message:"An unknown error occurred"}};i.call(s,a),window._EsriLeafletCallbacks[r]=!0}},g.exports.DomUtil.addClass(n,"esri-leaflet-jsonp"),vi++,{id:r,url:n.src,abort:function(){window._EsriLeafletCallbacks._callback[r]({code:0,message:"Request aborted."})}}}var we=ht.cors?bi:xe;we.CORS=bi;we.JSONP=xe;function ct(){console&&console.warn&&console.warn.apply(console,arguments)}var Vt={request:xi,get:we,post:fr};/* @preserve
* @terraformer/arcgis - v2.0.7 - MIT
* Copyright (c) 2012-2021 Environmental Systems Research Institute, Inc.
* Thu Jul 22 2021 13:58:30 GMT-0700 (Pacific Daylight Time)
*/var pr=function(t,i,s,r){var n=(r[0]-s[0])*(t[1]-s[1])-(r[1]-s[1])*(t[0]-s[0]),o=(i[0]-t[0])*(t[1]-s[1])-(i[1]-t[1])*(t[0]-s[0]),a=(r[1]-s[1])*(i[0]-t[0])-(r[0]-s[0])*(i[1]-t[1]);if(a!==0){var h=n/a,l=o/a;if(h>=0&&h<=1&&l>=0&&l<=1)return!0}return!1},mr=function(t,i){for(var s=!1,r=-1,n=t.length,o=n-1;++r<n;o=r)(t[r][1]<=i[1]&&i[1]<t[o][1]||t[o][1]<=i[1]&&i[1]<t[r][1])&&i[0]<(t[o][0]-t[r][0])*(i[1]-t[r][1])/(t[o][1]-t[r][1])+t[r][0]&&(s=!s);return s},gr=function(t,i){for(var s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0},wi=function(t,i){for(var s=0;s<t.length-1;s++)for(var r=0;r<i.length-1;r++)if(pr(t[s],t[s+1],i[r],i[r+1]))return!0;return!1},Se=function(t){return gr(t[0],t[t.length-1])||t.push(t[0]),t},Le=function(t){var i=0,s=0,r=t.length,n=t[s],o;for(s;s<r-1;s++)o=t[s+1],i+=(o[0]-n[0])*(o[1]+n[1]),n=o;return i>=0},Si=function(t){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);return i},_r=function(t,i){var s=wi(t,i),r=mr(t,i[0]);return!!(!s&&r)},yr=function(t){for(var i=[],s=[],r,n,o,a=0;a<t.length;a++){var h=Se(t[a].slice(0));if(!(h.length<4))if(Le(h)){var l=[h.slice().reverse()];i.push(l)}else s.push(h.slice().reverse())}for(var c=[];s.length;){o=s.pop();var u=!1;for(r=i.length-1;r>=0;r--)if(n=i[r][0],_r(n,o)){i[r].push(o),u=!0;break}u||c.push(o)}for(;c.length;){o=c.pop();var d=!1;for(r=i.length-1;r>=0;r--)if(n=i[r][0],wi(n,o)){i[r].push(o),d=!0;break}d||i.push([o.reverse()])}return i.length===1?{type:"Polygon",coordinates:i[0]}:{type:"MultiPolygon",coordinates:i}},vr=function(t,i){for(var s=i?[i,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<s.length;r++){var n=s[r];if(n in t&&(typeof t[n]=="string"||typeof t[n]=="number"))return t[n]}throw Error("No valid id attribute found")},br=function e(t,i){var s={};if(t.features){s.type="FeatureCollection",s.features=[];for(var r=0;r<t.features.length;r++)s.features.push(e(t.features[r],i))}if(typeof t.x=="number"&&typeof t.y=="number"&&(s.type="Point",s.coordinates=[t.x,t.y],typeof t.z=="number"&&s.coordinates.push(t.z)),t.points&&(s.type="MultiPoint",s.coordinates=t.points.slice(0)),t.paths&&(t.paths.length===1?(s.type="LineString",s.coordinates=t.paths[0].slice(0)):(s.type="MultiLineString",s.coordinates=t.paths.slice(0))),t.rings&&(s=yr(t.rings.slice(0))),typeof t.xmin=="number"&&typeof t.ymin=="number"&&typeof t.xmax=="number"&&typeof t.ymax=="number"&&(s.type="Polygon",s.coordinates=[[[t.xmax,t.ymax],[t.xmin,t.ymax],[t.xmin,t.ymin],[t.xmax,t.ymin],[t.xmax,t.ymax]]]),(t.geometry||t.attributes)&&(s.type="Feature",s.geometry=t.geometry?e(t.geometry):null,s.properties=t.attributes?Si(t.attributes):null,t.attributes))try{s.id=vr(t.attributes,i)}catch{}return JSON.stringify(s.geometry)===JSON.stringify({})&&(s.geometry=null),t.spatialReference&&t.spatialReference.wkid&&t.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(t.spatialReference)),s},Li=function(t){var i=[],s=t.slice(0),r=Se(s.shift().slice(0));if(r.length>=4){Le(r)||r.reverse(),i.push(r);for(var n=0;n<s.length;n++){var o=Se(s[n].slice(0));o.length>=4&&(Le(o)&&o.reverse(),i.push(o))}}return i},xr=function(t){for(var i=[],s=0;s<t.length;s++)for(var r=Li(t[s]),n=r.length-1;n>=0;n--){var o=r[n].slice(0);i.push(o)}return i},wr=function e(t,i){i=i||"OBJECTID";var s={wkid:4326},r={},n;switch(t.type){case"Point":r.x=t.coordinates[0],r.y=t.coordinates[1],t.coordinates[2]&&(r.z=t.coordinates[2]),r.spatialReference=s;break;case"MultiPoint":r.points=t.coordinates.slice(0),t.coordinates[0][2]&&(r.hasZ=!0),r.spatialReference=s;break;case"LineString":r.paths=[t.coordinates.slice(0)],t.coordinates[0][2]&&(r.hasZ=!0),r.spatialReference=s;break;case"MultiLineString":r.paths=t.coordinates.slice(0),t.coordinates[0][0][2]&&(r.hasZ=!0),r.spatialReference=s;break;case"Polygon":r.rings=Li(t.coordinates.slice(0)),t.coordinates[0][0][2]&&(r.hasZ=!0),r.spatialReference=s;break;case"MultiPolygon":r.rings=xr(t.coordinates.slice(0)),t.coordinates[0][0][0][2]&&(r.hasZ=!0),r.spatialReference=s;break;case"Feature":t.geometry&&(r.geometry=e(t.geometry,i)),r.attributes=t.properties?Si(t.properties):{},t.id&&(r.attributes[i]=t.id);break;case"FeatureCollection":for(r=[],n=0;n<t.features.length;n++)r.push(e(t.features[n],i));break;case"GeometryCollection":for(r=[],n=0;n<t.geometries.length;n++)r.push(e(t.geometries[n],i));break}return r},Ti='<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',Sr='Powered by <a href="https://www.esri.com">Esri</a>';function Zt(e,t){return wr(e,t)}function Lr(e,t){return br(e,t)}function ki(e){if(e.xmin!=="NaN"&&e.ymin!=="NaN"&&e.xmax!=="NaN"&&e.ymax!=="NaN"){var t=g.exports.latLng(e.ymin,e.xmin),i=g.exports.latLng(e.ymax,e.xmax);return g.exports.latLngBounds(t,i)}else return null}function Ci(e){return e=g.exports.latLngBounds(e),{xmin:e.getSouthWest().lng,ymin:e.getSouthWest().lat,xmax:e.getNorthEast().lng,ymax:e.getNorthEast().lat,spatialReference:{wkid:4326}}}var Ai=/^(OBJECTID|FID|OID|ID)$/i;function Tr(e){var t;if(e.objectIdFieldName)t=e.objectIdFieldName;else if(e.fields){for(var i=0;i<=e.fields.length-1;i++)if(e.fields[i].type==="esriFieldTypeOID"){t=e.fields[i].name;break}if(!t){for(i=0;i<=e.fields.length-1;i++)if(e.fields[i].name.match(Ai)){t=e.fields[i].name;break}}}return t}function kr(e){for(var t in e.attributes)if(t.match(Ai))return t}function Jt(e,t){var i,s=e.features||e.results,r=s&&s.length;t?i=t:i=Tr(e);var n={type:"FeatureCollection",features:[]};if(r)for(var o=s.length-1;o>=0;o--){var a=Lr(s[o],i||kr(s[o]));n.features.push(a)}return n}function Te(e){return e=g.exports.Util.trim(e),e[e.length-1]!=="/"&&(e+="/"),e}function Kt(e){if(e.url.indexOf("?")!==-1){e.requestParams=e.requestParams||{};var t=e.url.substring(e.url.indexOf("?")+1);e.url=e.url.split("?")[0],e.requestParams=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return e.url=Te(e.url.split("?")[0]),e}function Cr(e){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(e)}function Ei(e){var t;switch(e){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":t="esriGeometryPolyline";break;case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":t="esriGeometryPolygon";break;case"MultiPolygon":t="esriGeometryPolygon";break}return t}function ke(e){return e.getSize().x-dr.attributionWidthOffset+"px"}function Wt(e){if(!!e.attributionControl){if(e.attributionControl._esriAttributionLayerCount||(e.attributionControl._esriAttributionLayerCount=0),e.attributionControl._esriAttributionLayerCount===0){if(!e.attributionControl._esriAttributionAddedOnce){var t=document.createElement("style");t.type="text/css",t.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(t);var i=document.createElement("style");i.type="text/css",i.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+ke(e)+";}",document.getElementsByTagName("head")[0].appendChild(i),e.on("resize",function(s){e.attributionControl&&(e.attributionControl._container.style.maxWidth=ke(s.target))}),e.attributionControl._esriAttributionAddedOnce=!0}e.attributionControl.setPrefix(Ti+" | "+Sr),g.exports.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution:hover"),g.exports.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution")}e.attributionControl._esriAttributionLayerCount=e.attributionControl._esriAttributionLayerCount+1}}function Xt(e){!e.attributionControl||(e.attributionControl._esriAttributionLayerCount&&e.attributionControl._esriAttributionLayerCount===1&&(e.attributionControl.setPrefix(Ti),g.exports.DomUtil.removeClass(e.attributionControl._container,"esri-truncated-attribution:hover"),g.exports.DomUtil.removeClass(e.attributionControl._container,"esri-truncated-attribution")),e.attributionControl._esriAttributionLayerCount=e.attributionControl._esriAttributionLayerCount-1)}function Ii(e){var t={geometry:null,geometryType:null};if(e instanceof g.exports.LatLngBounds)return t.geometry=Ci(e),t.geometryType="esriGeometryEnvelope",t;if(e.getLatLng&&(e=e.getLatLng()),e instanceof g.exports.LatLng&&(e={type:"Point",coordinates:[e.lng,e.lat]}),e instanceof g.exports.GeoJSON&&(e=e.getLayers()[0].feature.geometry,t.geometry=Zt(e),t.geometryType=Ei(e.type)),e.toGeoJSON&&(e=e.toGeoJSON()),e.type==="Feature"&&(e=e.geometry),e.type==="Point"||e.type==="LineString"||e.type==="Polygon"||e.type==="MultiPolygon")return t.geometry=Zt(e),t.geometryType=Ei(e.type),t;ct("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function Ar(e,t){ht.cors&&xi(e,{},g.exports.Util.bind(function(i,s){if(!i){t._esriAttributions=[];for(var r=0;r<s.contributors.length;r++)for(var n=s.contributors[r],o=0;o<n.coverageAreas.length;o++){var a=n.coverageAreas[o],h=g.exports.latLng(a.bbox[0],a.bbox[1]),l=g.exports.latLng(a.bbox[2],a.bbox[3]);t._esriAttributions.push({attribution:n.attribution,score:a.score,bounds:g.exports.latLngBounds(h,l),minZoom:a.zoomMin,maxZoom:a.zoomMax})}t._esriAttributions.sort(function(u,d){return d.score-u.score});var c={target:t};Ce(c)}},this))}function Ce(e){var t=e.target,i=t._esriAttributions;if(!(!t||!t.attributionControl)){var s=t.attributionControl._container.querySelector(".esri-dynamic-attribution");if(s&&i){for(var r="",n=t.getBounds(),o=g.exports.latLngBounds(n.getSouthWest().wrap(),n.getNorthEast().wrap()),a=t.getZoom(),h=0;h<i.length;h++){var l=i[h],c=l.attribution;!r.match(c)&&l.bounds.intersects(o)&&a>=l.minZoom&&a<=l.maxZoom&&(r+=", "+c)}r=r.substr(2),s.innerHTML=r,s.style.maxWidth=ke(t),t.fire("attributionupdated",{attribution:r})}}}var Ae=g.exports.Class.extend({options:{proxy:!1,useCors:qt},generateSetter:function(e,t){return g.exports.Util.bind(function(i){return this.params[e]=i,this},t)},initialize:function(e){if(e.request&&e.options?(this._service=e,g.exports.Util.setOptions(this,e.options)):(g.exports.Util.setOptions(this,e),this.options.url=Te(e.url)),this.params=g.exports.Util.extend({},this.params||{}),this.setters)for(var t in this.setters){var i=this.setters[t];this[t]=this.generateSetter(i,this)}},token:function(e){return this._service?this._service.authenticate(e):this.params.token=e,this},apikey:function(e){return this.token(e)},format:function(e){return this.params.returnUnformattedValues=!e,this},request:function(e,t){return this.options.requestParams&&g.exports.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,e,t):this._request("request",this.path,this.params,e,t)},_request:function(e,t,i,s,r){var n=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(e==="get"||e==="request")&&!this.options.useCors?Vt.get.JSONP(n,i,s,r):Vt[e](n,i,s,r)}}),Er=Ae.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(e,t){return e=g.exports.latLng(e),this.params.geometry=[e.lng,e.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=t,this.params.inSR=4326,this},where:function(e){return this.params.where=e,this},between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},orderBy:function(e,t){return t=t||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[e,t].join(" "),this},run:function(e,t){return this._cleanParams(),this.options.isModern||Cr(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(i,s){this._trapSQLerrors(i),e.call(t,i,s,s)},this)):this.request(function(i,s){this._trapSQLerrors(i),e.call(t,i,s&&Jt(s),s)},this)},count:function(e,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(i,s){e.call(this,i,s&&s.count,s)},t)},ids:function(e,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(i,s){e.call(this,i,s&&s.objectIds,s)},t)},bounds:function(e,t){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(i,s){s&&s.extent&&ki(s.extent)?e.call(t,i,ki(s.extent),s):(i={message:"Invalid Bounds"},e.call(t,i,null,s))},t)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(e){var t=g.exports.point(e);return this.params.pixelSize=[t.x,t.y],this},layer:function(e){return this.path=e+"/query",this},_trapSQLerrors:function(e){e&&e.code==="400"&&ct("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(e){this.params.inSR=4326;var t=Ii(e);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function Ee(e){return new Er(e)}var Ir=Ae.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(e,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[e,t].join(":"),this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},run:function(e,t){return this.request(function(i,s){e.call(t,i,s&&Jt(s),s)},t)}});function Or(e){return new Ir(e)}var Oi=Ae.extend({path:"identify",between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this}}),Pr=Oi.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(e){var t=Ci(e.getBounds()),i=e.getSize();return this.params.imageDisplay=[i.x,i.y,96],this.params.mapExtent=[t.xmin,t.ymin,t.xmax,t.ymax],this},at:function(e){return e.length===2&&(e=g.exports.latLng(e)),this._setGeometryParams(e),this},layerDef:function(e,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[e,t].join(":"),this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},run:function(e,t){return this.request(function(i,s){if(i){e.call(t,i,void 0,s);return}else{var r=Jt(s);s.results=s.results.reverse();for(var n=0;n<r.features.length;n++){var o=r.features[n];o.layerId=s.results[n].layerId}e.call(t,void 0,r,s)}})},_setGeometryParams:function(e){var t=Ii(e);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function Dr(e){return new Pr(e)}var Rr=Oi.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(e){return e=g.exports.latLng(e),this.params.geometry=JSON.stringify({x:e.lng,y:e.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(e,t){return this.request(function(i,s){e.call(t,i,s&&this._responseToGeoJSON(s),s)},this)},_responseToGeoJSON:function(e){var t=e.location,i=e.catalogItems,s=e.catalogItemVisibilities,r={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[t.x,t.y]},crs:{type:"EPSG",properties:{code:t.spatialReference.wkid}},properties:{OBJECTID:e.objectId,name:e.name,value:e.value},id:e.objectId}};if(e.properties&&e.properties.Values&&(r.pixel.properties.values=e.properties.Values),i&&i.features&&(r.catalogItems=Jt(i),s&&s.length===r.catalogItems.features.length))for(var n=s.length-1;n>=0;n--)r.catalogItems.features[n].properties.catalogItemVisibility=s[n];return r}});function Mr(e){return new Rr(e)}var Ie=g.exports.Evented.extend({options:{proxy:!1,useCors:qt,timeout:0},initialize:function(e){e=e||{},this._requestQueue=[],this._authenticating=!1,g.exports.Util.setOptions(this,e),this.options.url=Te(this.options.url)},get:function(e,t,i,s){return this._request("get",e,t,i,s)},post:function(e,t,i,s){return this._request("post",e,t,i,s)},request:function(e,t,i,s){return this._request("request",e,t,i,s)},metadata:function(e,t){return this._request("get","",{},e,t)},authenticate:function(e){return this._authenticating=!1,this.options.token=e,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(e){this.options.timeout=e},_request:function(e,t,i,s,r){this.fire("requeststart",{url:this.options.url+t,params:i,method:e},!0);var n=this._createServiceCallback(e,t,i,s,r);if(this.options.token&&(i.token=this.options.token),this.options.requestParams&&g.exports.Util.extend(i,this.options.requestParams),this._authenticating){this._requestQueue.push([e,t,i,s,r]);return}else{var o=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(e==="get"||e==="request")&&!this.options.useCors?Vt.get.JSONP(o,i,n,r):Vt[e](o,i,n,r)}},_createServiceCallback:function(e,t,i,s,r){return g.exports.Util.bind(function(n,o){n&&(n.code===499||n.code===498)&&(this._authenticating=!0,this._requestQueue.push([e,t,i,s,r]),this.fire("authenticationrequired",{authenticate:g.exports.Util.bind(this.authenticate,this)},!0),n.authenticate=g.exports.Util.bind(this.authenticate,this)),s.call(r,n,o),n?this.fire("requesterror",{url:this.options.url+t,params:i,message:n.message,code:n.code,method:e},!0):this.fire("requestsuccess",{url:this.options.url+t,params:i,response:o,method:e},!0),this.fire("requestend",{url:this.options.url+t,params:i,method:e},!0)},this)},_runQueue:function(){for(var e=this._requestQueue.length-1;e>=0;e--){var t=this._requestQueue[e],i=t.shift();this[i].apply(this,t)}this._requestQueue=[]}}),Fr=Ie.extend({identify:function(){return Dr(this)},find:function(){return Or(this)},query:function(){return Ee(this)}});function Pi(e){return new Fr(e)}var Nr=Ie.extend({query:function(){return Ee(this)},identify:function(){return Mr(this)}});function Ur(e){return new Nr(e)}var Br=Ie.extend({options:{idAttribute:"OBJECTID"},query:function(){return Ee(this)},addFeature:function(e,t,i){this.addFeatures(e,t,i)},addFeatures:function(e,t,i){for(var s=e.features?e.features:[e],r=s.length-1;r>=0;r--)delete s[r].id;return e=Zt(e),e=s.length>1?e:[e],this.post("addFeatures",{features:e},function(n,o){var a=o&&o.addResults?o.addResults.length>1?o.addResults:o.addResults[0]:void 0;t&&t.call(i,n||o.addResults[0].error,a)},i)},updateFeature:function(e,t,i){this.updateFeatures(e,t,i)},updateFeatures:function(e,t,i){var s=e.features?e.features:[e];return e=Zt(e,this.options.idAttribute),e=s.length>1?e:[e],this.post("updateFeatures",{features:e},function(r,n){var o=n&&n.updateResults?n.updateResults.length>1?n.updateResults:n.updateResults[0]:void 0;t&&t.call(i,r||n.updateResults[0].error,o)},i)},deleteFeature:function(e,t,i){this.deleteFeatures(e,t,i)},deleteFeatures:function(e,t,i){return this.post("deleteFeatures",{objectIds:e},function(s,r){var n=r&&r.deleteResults?r.deleteResults.length>1?r.deleteResults:r.deleteResults[0]:void 0;t&&t.call(i,s||r.deleteResults[0].error,n)},i)}});function Gr(e){return new Br(e)}var U=window.location.protocol!=="https:"?"http:":"https:",Di=g.exports.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:U+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:U+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:rt?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:U+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:U+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:U+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:U+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(e,t){var i;if(typeof e=="object"&&e.urlTemplate&&e.options)i=e;else if(typeof e=="string"&&Di.TILES[e])i=Di.TILES[e];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var s=g.exports.Util.extend(i.options,t);g.exports.Util.setOptions(this,s),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&i.urlTemplate.indexOf("token=")===-1&&(i.urlTemplate+="?token="+this.options.token),this.options.proxy&&(i.urlTemplate=this.options.proxy+"?"+i.urlTemplate),g.exports.TileLayer.prototype.initialize.call(this,i.urlTemplate,s)},onAdd:function(e){Wt(e),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&Ar((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,e),e.on("moveend",Ce),g.exports.TileLayer.prototype.onAdd.call(this,e)},onRemove:function(e){Xt(e),e.off("moveend",Ce),g.exports.TileLayer.prototype.onRemove.call(this,e)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var e=this._map.createPane(this.options.pane);e.style.pointerEvents="none",e.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var e='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return e}}),zr=g.exports.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{"0":156543.033928,"1":78271.5169639999,"2":39135.7584820001,"3":19567.8792409999,"4":9783.93962049996,"5":4891.96981024998,"6":2445.98490512499,"7":1222.99245256249,"8":611.49622628138,"9":305.748113140558,"10":152.874056570411,"11":76.4370282850732,"12":38.2185141425366,"13":19.1092570712683,"14":9.55462853563415,"15":4.77731426794937,"16":2.38865713397468,"17":1.19432856685505,"18":.597164283559817,"19":.298582141647617,"20":.14929107082381,"21":.07464553541191,"22":.0373227677059525,"23":.0186613838529763}},initialize:function(e){e=g.exports.Util.setOptions(this,e),e=Kt(e),this.tileUrl=(e.proxy?e.proxy+"?":"")+e.url+"tile/{z}/{y}/{x}"+(e.requestParams&&Object.keys(e.requestParams).length>0?g.exports.Util.getParamString(e.requestParams):""),e.url.indexOf("{s}")!==-1&&e.subdomains&&(e.url=e.url.replace("{s}",e.subdomains[0])),this.service=Pi(e),this.service.addEventParent(this);var t=new RegExp(/tiles.arcgis(online)?\.com/g);t.test(e.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),e.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),g.exports.TileLayer.prototype.initialize.call(this,this.tileUrl,e)},getTileUrl:function(e){var t=this._getZoomForUrl();return g.exports.Util.template(this.tileUrl,g.exports.Util.extend({s:this._getSubdomain(e),x:e.x,y:e.y,z:this._lodMap&&this._lodMap[t]?this._lodMap[t]:t},this.options))},createTile:function(e,t){var i=document.createElement("img");return g.exports.DomEvent.on(i,"load",g.exports.Util.bind(this._tileOnLoad,this,t,i)),g.exports.DomEvent.on(i,"error",g.exports.Util.bind(this._tileOnError,this,t,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?i.src=this.getTileUrl(e):this.once("lodmap",function(){i.src=this.getTileUrl(e)},this),i},onAdd:function(e){Wt(e),this._lodMap||this.metadata(function(t,i){if(!t&&i.spatialReference){var s=i.spatialReference.latestWkid||i.spatialReference.wkid;if(!this.options.attribution&&e.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,e.attributionControl.addAttribution(this.getAttribution())),e.options.crs===g.exports.CRS.EPSG3857&&(s===102100||s===3857)){this._lodMap={};for(var r=i.tileInfo.lods,n=zr.MercatorZoomLevels,o=0;o<r.length;o++){var a=r[o];for(var h in n){var l=n[h];if(this._withinPercentage(a.resolution,l,this.options.zoomOffsetAllowance)){this._lodMap[h]=a.level;break}}}this.fire("lodmap")}else e.options.crs&&e.options.crs.code&&e.options.crs.code.indexOf(s)>-1||ct("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html")}},this),g.exports.TileLayer.prototype.onAdd.call(this,e)},onRemove:function(e){Xt(e),g.exports.TileLayer.prototype.onRemove.call(this,e)},metadata:function(e,t){return this.service.metadata(e,t),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(e){var t="?token="+e;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,t):this.tileUrl+t,this.options.token=e,this.service.authenticate(e),this},_withinPercentage:function(e,t,i){var s=Math.abs(e/t-1);return s<i}}),jr=g.exports.ImageOverlay.extend({onAdd:function(e){this._topLeft=e.getPixelBounds().min,g.exports.ImageOverlay.prototype.onAdd.call(this,e)},_reset:function(){this._map.options.crs===g.exports.CRS.EPSG3857?g.exports.ImageOverlay.prototype._reset.call(this):g.exports.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),Ri=g.exports.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:qt,attribution:null,interactive:!1,alt:""},onAdd:function(e){Wt(e),this.options.zIndex&&(this.options.position=null),this._update=g.exports.Util.throttle(this._update,this.options.updateInterval,this),e.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?e.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(t,i){!t&&!this.options.attribution&&e.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,e.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(e){Xt(e),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(e,t){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=g.exports.popup(t),this._popupFunction=e,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(e){return this.options.zIndex=e,this._currentImage&&this._currentImage.setZIndex(e),this},_setAutoZIndex:function(e){if(!!this._currentImage){for(var t=this._currentImage.getPane().children,i=-e(-1/0,1/0),s=0,r=t.length,n;s<r;s++)n=t[s].style.zIndex,t[s]!==this._currentImage._image&&n&&(i=e(i,+n));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(e){return this.options.opacity=e,this._currentImage&&this._currentImage.setOpacity(e),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(e,t){return this.options.from=e,this.options.to=t,this._update(),this},metadata:function(e,t){return this.service.metadata(e,t),this},authenticate:function(e){return this.service.authenticate(e),this},redraw:function(){this._update()},_renderImage:function(e,t,i){if(this._map){if(i&&(e="data:"+i+";base64,"+e),!e)return;var s=new jr(e,t,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),r=function(){this._map.removeLayer(s),this.fire("error"),s.off("load",n,this)},n=function(o){if(s.off("error",n,this),this._map){var a=o.target,h=this._currentImage;a._bounds.equals(t)&&a._bounds.equals(this._map.getBounds())?(this._currentImage=a,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),h&&this._map&&this._map.removeLayer(h),h&&h._map&&h._map.removeLayer(h)):this._map.removeLayer(a)}this.fire("load",{bounds:t})};s.once("error",r,this),s.once("load",n,this)}},_update:function(){if(!!this._map){var e=this._map.getZoom(),t=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(e>this.options.maxZoom||e<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var i=this._buildExportParams();g.exports.Util.extend(i,this.options.requestParams),i?(this._requestExport(i,t),this.fire("loading",{bounds:t})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(e,t,i,s){if(e=g.exports.latLng(e),this._shouldRenderPopup&&this._lastClick.equals(e)){var r=this._popupFunction(t,i,s);r&&this._popup.setLatLng(e).setContent(r).openOn(this._map)}},_resetPopupState:function(e){this._shouldRenderPopup=!1,this._lastClick=e.latlng},_calculateBbox:function(){var e=this._map.getPixelBounds(),t=this._map.unproject(e.getBottomLeft()),i=this._map.unproject(e.getTopRight()),s=this._map.options.crs.project(i),r=this._map.options.crs.project(t),n=g.exports.bounds(s,r);return[n.getBottomLeft().x,n.getBottomLeft().y,n.getTopRight().x,n.getTopRight().y].join(",")},_calculateImageSize:function(){var e=this._map.getPixelBounds(),t=this._map.getSize(),i=this._map.unproject(e.getBottomLeft()),s=this._map.unproject(e.getTopRight()),r=this._map.latLngToLayerPoint(s).y,n=this._map.latLngToLayerPoint(i).y;return(r>0||n<t.y)&&(t.y=n-r),t.x+","+t.y}});Ri.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(e){e=Kt(e),this.service=Ur(e),this.service.addEventParent(this),g.exports.Util.setOptions(this,e)},setPixelType:function(e){return this.options.pixelType=e,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(e){return g.exports.Util.isArray(e)?this.options.bandIds=e.join(","):this.options.bandIds=e.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(e,t){return g.exports.Util.isArray(e)?this.options.noData=e.join(","):this.options.noData=e.toString(),t&&(this.options.noDataInterpretation=t),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(e){this.options.renderingRule=e,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(e){this.options.mosaicRule=e,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(e){var t=g.exports.Util.bind(function(s,r,n){s||setTimeout(g.exports.Util.bind(function(){this._renderPopup(e.latlng,s,r,n)},this),300)},this),i=this.identify().at(e.latlng);this.options.mosaicRule&&i.setMosaicRule(this.options.mosaicRule),i.run(t),this._shouldRenderPopup=!0,this._lastClick=e.latlng},_buildExportParams:function(){var e=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:e,imageSR:e};return this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(t.pixelType=this.options.pixelType),this.options.interpolation&&(t.interpolation=this.options.interpolation),this.options.compressionQuality&&(t.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(t.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(t.noData=this.options.noData),this.options.noDataInterpretation&&(t.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(t.token=this.service.options.token),this.options.renderingRule&&(t.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(t.mosaicRule=JSON.stringify(this.options.mosaicRule)),t},_requestExport:function(e,t){if(this.options.f==="json")this.service.request("exportImage",e,function(s,r){s||(this.options.token&&(r.href+="?token="+this.options.token),this.options.proxy&&(r.href=this.options.proxy+"?"+r.href),this._renderImage(r.href,t))},this);else{e.f="image";var i=this.options.url+"exportImage"+g.exports.Util.getParamString(e);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,t)}}});var $r=Ri.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(e){e=Kt(e),this.service=Pi(e),this.service.addEventParent(this),g.exports.Util.setOptions(this,e)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(e){return this.options.dynamicLayers=e,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(e){return this.options.layers=e,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(e){return this.options.layerDefs=e,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(e){return this.options.timeOptions=e,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(e){var t=g.exports.Util.bind(function(r,n,o){r||setTimeout(g.exports.Util.bind(function(){this._renderPopup(e.latlng,r,n,o)},this),300)},this),i;if(this.options.popup?i=this.options.popup.on(this._map).at(e.latlng):i=this.identify().on(this._map).at(e.latlng),i.params.maxAllowableOffset||i.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?i.layers("visible:"+this.options.layers.join(",")):i.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!i.params.layerDefs)for(var s in this.options.layerDefs)this.options.layerDefs.hasOwnProperty(s)&&i.layerDef(s,this.options.layerDefs[s]);i.run(t),this._shouldRenderPopup=!0,this._lastClick=e.latlng},_buildExportParams:function(){var e=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:e,imageSR:e};if(this.options.dynamicLayers&&(t.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;t.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(t.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(t.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(t.token=this.service.options.token),this.options.proxy&&(t.proxy=this.options.proxy),this.options.disableCache&&(t._ts=Date.now()),t},_requestExport:function(e,t){if(this.options.f==="json")this.service.request("export",e,function(s,r){s||(this.options.token&&r.href&&(r.href+="?token="+this.options.token),this.options.proxy&&r.href&&(r.href=this.options.proxy+"?"+r.href),r.href?this._renderImage(r.href,t):this._renderImage(r.imageData,t,r.contentType))},this);else{e.f="image";var i=this.options.url+"export"+g.exports.Util.getParamString(e);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,t)}}});function qr(e,t){return new $r(e,t)}var Yt=g.exports.Layer.extend({options:{cellSize:512,updateWhenIdle:g.exports.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(e){g.exports.Util.setOptions(this,e)},onAdd:function(e){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(e){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=g.exports.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),e},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var e=this.options.cellSize;return e instanceof g.exports.Point?e:new g.exports.Point(e,e)},_pruneCells:function(){if(!!this._map){var e,t;for(e in this._cells)t=this._cells[e],t.retain=t.current;for(e in this._cells)if(t=this._cells[e],t.current&&!t.active){var i=t.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(e in this._cells)this._cells[e].retain||this._removeCell(e)}},_removeAllCells:function(){for(var e in this._cells)this._removeCell(e)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(e,t,i,s){var r=Math.floor(e/2),n=Math.floor(t/2),o=i-1,a=new g.exports.Point(+r,+n);a.z=+o;var h=this._cellCoordsToKey(a),l=this._cells[h];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),o>s?this._retainParent(r,n,o,s):!1)},_retainChildren:function(e,t,i,s){for(var r=2*e;r<2*e+2;r++)for(var n=2*t;n<2*t+2;n++){var o=new g.exports.Point(r,n);o.z=i+1;var a=this._cellCoordsToKey(o),h=this._cells[a];if(h&&h.active){h.retain=!0;continue}else h&&h.loaded&&(h.retain=!0);i+1<s&&this._retainChildren(r,n,i+1,s)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);t||this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_setView:function(e,t,i,s){var r=Math.round(t);s||(this._cellZoom=r,this._abortLoading&&this._abortLoading(),this._resetGrid(),r!==void 0&&this._update(e),i||this._pruneCells(),this._noPrune=!!i)},_resetGrid:function(){var e=this._map,t=e.options.crs,i=this._cellSize=this.getCellSize(),s=this._cellZoom,r=this._map.getPixelWorldBounds(this._cellZoom);r&&(this._globalCellRange=this._pxBoundsToCellRange(r)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],s).x/i.x),Math.ceil(e.project([0,t.wrapLng[1]],s).x/i.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],s).y/i.x),Math.ceil(e.project([t.wrapLat[1],0],s).y/i.y)]},_onMoveEnd:function(e){var t=e&&(e.pinch||e.flyTo);t||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(e){var t=this._map,i=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),s=t.getZoomScale(i,this._cellZoom),r=t.project(e,this._cellZoom).floor(),n=t.getSize().divideBy(s*2);return new g.exports.Bounds(r.subtract(n),r.add(n))},_update:function(e){var t=this._map;if(!!t){var i=Math.round(t.getZoom());e===void 0&&(e=t.getCenter());var s=this._getCelldPixelBounds(e),r=this._pxBoundsToCellRange(s),n=r.getCenter(),o=[],a=this.options.keepBuffer,h=new g.exports.Bounds(r.getBottomLeft().subtract([a,-a]),r.getTopRight().add([a,-a]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var l in this._cells){var c=this._cells[l].coords;(c.z!==this._cellZoom||!h.contains(new g.exports.Point(c.x,c.y)))&&(this._cells[l].current=!1)}if(Math.abs(i-this._cellZoom)>1){this._setView(e,i);return}for(var u=r.min.y;u<=r.max.y;u++)for(var d=r.min.x;d<=r.max.x;d++){var f=new g.exports.Point(d,u);if(f.z=this._cellZoom,!!this._isValidCell(f)){var p=this._cells[this._cellCoordsToKey(f)];p?p.current=!0:o.push(f)}}if(o.sort(function(k,b){return k.distanceTo(n)-b.distanceTo(n)}),o.length!==0)for(this._loading||(this._loading=!0),d=0;d<o.length;d++){var _=this._cellCoordsToKey(o[d]),v=this._keyToCellCoords(_);this._activeCells[v]?this._reuseCell(o[d]):this._createCell(o[d])}}},_isValidCell:function(e){var t=this._map.options.crs;if(!t.infinite){var i=this._globalCellRange;if(!t.wrapLng&&(e.x<i.min.x||e.x>i.max.x)||!t.wrapLat&&(e.y<i.min.y||e.y>i.max.y))return!1}if(!this.options.bounds)return!0;var s=this._cellCoordsToBounds(e);return g.exports.toLatLngBounds(this.options.bounds).overlaps(s)},_keyToBounds:function(e){return this._cellCoordsToBounds(this._keyToCellCoords(e))},_cellCoordsToNwSe:function(e){var t=this._map,i=this.getCellSize(),s=e.scaleBy(i),r=s.add(i),n=t.unproject(s,e.z),o=t.unproject(r,e.z);return[n,o]},_cellCoordsToBounds:function(e){var t=this._cellCoordsToNwSe(e),i=new g.exports.LatLngBounds(t[0],t[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_cellCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToCellCoords:function(e){var t=e.split(":"),i=new g.exports.Point(+t[0],+t[1]);return i.z=+t[2],i},_removeCell:function(e){var t=this._cells[e];if(!!t){var i=this._keyToCellCoords(e),s=this._wrapCoords(i),r=this._cellCoordsToBounds(this._wrapCoords(i));t.current=!1,delete this._cells[e],this._activeCells[e]=t,this.cellLeave(r,s,e),this.fire("cellleave",{key:e,coords:s,bounds:r})}},_reuseCell:function(e){var t=this._cellCoordsToKey(e);this._cells[t]=this._activeCells[t],this._cells[t].current=!0;var i=this._wrapCoords(e),s=this._cellCoordsToBounds(this._wrapCoords(e));this.cellEnter(s,i,t),this.fire("cellenter",{key:t,coords:i,bounds:s})},_createCell:function(e){var t=this._cellCoordsToKey(e),i=this._wrapCoords(e),s=this._cellCoordsToBounds(this._wrapCoords(e));this.createCell(s,i,t),this.fire("cellcreate",{key:t,coords:i,bounds:s}),this._cells[t]={coords:e,current:!0},g.exports.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(e,t,i){var s=this._cellCoordsToKey(e);i=this._cells[s],!!i&&(i.loaded=+new Date,i.active=!0)},_getCellPos:function(e){return e.scaleBy(this.getCellSize())},_wrapCoords:function(e){var t=new g.exports.Point(this._wrapX?g.exports.Util.wrapNum(e.x,this._wrapX):e.x,this._wrapY?g.exports.Util.wrapNum(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToCellRange:function(e){var t=this.getCellSize();return new g.exports.Bounds(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))}});function it(e){this.values=[].concat(e||[])}it.prototype.query=function(e){var t=this.getIndex(e);return this.values[t]};it.prototype.getIndex=function(t){this.dirty&&this.sort();for(var i=0,s=this.values.length-1,r,n;i<=s;)if(r=(i+s)/2|0,n=this.values[Math.round(r)],+n.value<+t)i=r+1;else if(+n.value>+t)s=r-1;else return r;return Math.abs(~s)};it.prototype.between=function(t,i){var s=this.getIndex(t),r=this.getIndex(i);if(s===0&&r===0)return[];for(;this.values[s-1]&&this.values[s-1].value===t;)s--;for(;this.values[r+1]&&this.values[r+1].value===i;)r++;return this.values[r]&&this.values[r].value===i&&this.values[r+1]&&r++,this.values.slice(s,r)};it.prototype.insert=function(t){return this.values.splice(this.getIndex(t.value),0,t),this};it.prototype.bulkAdd=function(t,i){return this.values=this.values.concat([].concat(t||[])),i?this.sort():this.dirty=!0,this};it.prototype.sort=function(){return this.values.sort(function(t,i){return+i.value-+t.value}).reverse(),this.dirty=!1,this};var Oe=Yt.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(e){if(Yt.prototype.initialize.call(this,e),e=Kt(e),e=g.exports.Util.setOptions(this,e),this.service=Gr(e),this.service.addEventParent(this),this.options.fields[0]!=="*"){for(var t=!1,i=0;i<this.options.fields.length;i++)this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)&&(t=!0);t===!1&&ct("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new it,this._endTimeIndex=new it):this.options.timeField&&(this._timeIndex=new it),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(e){return Wt(e),this.service.metadata(function(t,i){if(!t){var s=i.supportedQueryFormats,r=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(r=!0),!r&&s&&s.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),i.objectIdField&&(this.service.options.idAttribute=i.objectIdField),!this.options.attribution&&e.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,e.attributionControl.addAttribution(this.getAttribution()))}},this),e.on("zoomend",this._handleZoomChange,this),Yt.prototype.onAdd.call(this,e)},onRemove:function(e){return Xt(e),e.off("zoomend",this._handleZoomChange,this),Yt.prototype.onRemove.call(this,e)},getAttribution:function(){return this.options.attribution},createCell:function(e,t){this._visibleZoom()&&this._requestFeatures(e,t)},_requestFeatures:function(e,t,i,s){this._activeRequests++,s=s||0;var r=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:e},!0),this._buildQuery(e,s).run(function(n,o,a){a&&a.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===r&&(!n&&o&&o.features.length&&g.exports.Util.requestAnimFrame(g.exports.Util.bind(function(){this._addFeatures(o.features,t),this._postProcessFeatures(e)},this)),!n&&o&&!o.features.length&&this._postProcessFeatures(e),n&&this._postProcessFeatures(e),i&&i.call(this,n,o),a&&(a.exceededTransferLimit||a.properties&&a.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(e,t,i,s+o.features.length))},this)},_postProcessFeatures:function(e){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:e})},_cacheKey:function(e){return e.z+":"+e.x+":"+e.y},_addFeatures:function(e,t){if(t){var i=this._cacheKey(t);this._cache[i]=this._cache[i]||[]}for(var s=e.length-1;s>=0;s--){var r=e[s].id;this._currentSnapshot.indexOf(r)===-1&&this._currentSnapshot.push(r),typeof i!="undefined"&&this._cache[i].indexOf(r)===-1&&this._cache[i].push(r)}this.options.timeField&&this._buildTimeIndexes(e),this.createLayers(e)},_buildQuery:function(e,t){var i=this.service.query().intersects(e).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(t))&&(i=i.offset(t)),i.params.resultType="tile",this.options.requestParams&&g.exports.Util.extend(i.params,this.options.requestParams),this.options.simplifyFactor&&i.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&i.between(this.options.from,this.options.to),i},setWhere:function(e,t,i){this.options.where=e&&e.length?e:"1=1";for(var s=[],r=[],n=0,o=null,a=g.exports.Util.bind(function(d,f){if(d&&(o=d),f)for(var p=f.features.length-1;p>=0;p--)r.push(f.features[p].id);n--,n<=0&&this._visibleZoom()&&e===this.options.where&&(this._currentSnapshot=r,g.exports.Util.requestAnimFrame(g.exports.Util.bind(function(){this.removeLayers(s),this.addLayers(r),t&&t.call(i,o)},this)))},this),h=this._currentSnapshot.length-1;h>=0;h--)s.push(this._currentSnapshot[h]);this._cache={};for(var l in this._cells){n++;var c=this._keyToCellCoords(l),u=this._cellCoordsToBounds(c);this._requestFeatures(u,c,a)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(e,t,i,s){var r=this.options.from,n=this.options.to,o=0,a=null,h=g.exports.Util.bind(function(d){d&&(a=d),this._filterExistingFeatures(r,n,e,t),o--,i&&o<=0&&i.call(s,a)},this);if(this.options.from=e,this.options.to=t,this._filterExistingFeatures(r,n,e,t),this.options.timeFilterMode==="server")for(var l in this._cells){o++;var c=this._keyToCellCoords(l),u=this._cellCoordsToBounds(c);this._requestFeatures(u,c,h)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(e,t,i,s){var r=e&&t?this._getFeaturesInTimeRange(e,t):this._currentSnapshot,n=this._getFeaturesInTimeRange(i,s);if(n.indexOf)for(var o=0;o<n.length;o++){var a=r.indexOf(n[o]);a>=0&&r.splice(a,1)}g.exports.Util.requestAnimFrame(g.exports.Util.bind(function(){this.removeLayers(r),this.addLayers(n)},this))},_getFeaturesInTimeRange:function(e,t){var i=[],s;if(this.options.timeField.start&&this.options.timeField.end){var r=this._startTimeIndex.between(e,t),n=this._endTimeIndex.between(e,t);s=r.concat(n)}else if(this._timeIndex)s=this._timeIndex.between(e,t);else return ct("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(var o=s.length-1;o>=0;o--)i.push(s[o].id);return i},_buildTimeIndexes:function(e){var t,i;if(this.options.timeField.start&&this.options.timeField.end){var s=[],r=[];for(t=e.length-1;t>=0;t--)i=e[t],s.push({id:i.id,value:new Date(i.properties[this.options.timeField.start])}),r.push({id:i.id,value:new Date(i.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(s),this._endTimeIndex.bulkAdd(r)}else{var n=[];for(t=e.length-1;t>=0;t--)i=e[t],n.push({id:i.id,value:new Date(i.properties[this.options.timeField])});this._timeIndex.bulkAdd(n)}},_featureWithinTimeRange:function(e){if(!this.options.from||!this.options.to)return!0;var t=+this.options.from.valueOf(),i=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){var s=+e.properties[this.options.timeField];return s>=t&&s<=i}if(this.options.timeField.start&&this.options.timeField.end){var r=+e.properties[this.options.timeField.start],n=+e.properties[this.options.timeField.end];return r>=t&&r<=i||n>=t&&n<=i||r<=t&&n>=i}},_visibleZoom:function(){if(!this._map)return!1;var e=this._map.getZoom();return!(e>this.options.maxZoom||e<this.options.minZoom)},_handleZoomChange:function(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot);else for(var e in this._cells){var t=this._cells[e].coords,i=this._cacheKey(t);this._cache[i]&&this.addLayers(this._cache[i])}},authenticate:function(e){return this.service.authenticate(e),this},metadata:function(e,t){return this.service.metadata(e,t),this},query:function(){return this.service.query()},_getMetadata:function(e){if(this._metadata){var t;e(t,this._metadata)}else this.metadata(g.exports.Util.bind(function(i,s){this._metadata=s,e(i,this._metadata)},this))},addFeature:function(e,t,i){this.addFeatures(e,t,i)},addFeatures:function(e,t,i){this._getMetadata(g.exports.Util.bind(function(s,r){if(s){t&&t.call(this,s,null);return}var n=e.features?e.features:[e];this.service.addFeatures(e,g.exports.Util.bind(function(o,a){if(!o){for(var h=n.length-1;h>=0;h--)n[h].properties[r.objectIdField]=n.length>1?a[h].objectId:a.objectId,n[h].id=n.length>1?a[h].objectId:a.objectId;this._addFeatures(n)}t&&t.call(i,o,a)},this))},this))},updateFeature:function(e,t,i){this.updateFeatures(e,t,i)},updateFeatures:function(e,t,i){var s=e.features?e.features:[e];this.service.updateFeatures(e,function(r,n){if(!r){for(var o=s.length-1;o>=0;o--)this.removeLayers([s[o].id],!0);this._addFeatures(s)}t&&t.call(i,r,n)},this)},deleteFeature:function(e,t,i){this.deleteFeatures(e,t,i)},deleteFeatures:function(e,t,i){return this.service.deleteFeatures(e,function(s,r){var n=r.length?r:[r];if(!s&&n.length>0)for(var o=n.length-1;o>=0;o--)this.removeLayers([n[o].objectId],!0);t&&t.call(i,s,r)},this)}});Oe.extend({options:{cacheLayers:!0},initialize:function(e){e.apikey&&(e.token=e.apikey),Oe.prototype.initialize.call(this,e),this._originalStyle=this.options.style,this._layers={}},onRemove:function(e){for(var t in this._layers)e.removeLayer(this._layers[t]),this.fire("removefeature",{feature:this._layers[t].feature,permanent:!1},!0);return Oe.prototype.onRemove.call(this,e)},createNewLayer:function(e){var t=g.exports.GeoJSON.geometryToLayer(e,this.options);return t&&(t.defaultOptions=t.options),t},_updateLayer:function(e,t){var i=[],s=this.options.coordsToLatLng||g.exports.GeoJSON.coordsToLatLng;switch(t.properties&&(e.feature.properties=t.properties),t.geometry.type){case"Point":i=g.exports.GeoJSON.coordsToLatLng(t.geometry.coordinates),e.setLatLng(i);break;case"LineString":i=g.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,0,s),e.setLatLngs(i);break;case"MultiLineString":i=g.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1,s),e.setLatLngs(i);break;case"Polygon":i=g.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1,s),e.setLatLngs(i);break;case"MultiPolygon":i=g.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,2,s),e.setLatLngs(i);break}},createLayers:function(e){for(var t=e.length-1;t>=0;t--){var i=e[t],s=this._layers[i.id],r;this._visibleZoom()&&s&&!this._map.hasLayer(s)&&(!this.options.timeField||this._featureWithinTimeRange(i))&&(this._map.addLayer(s),this.fire("addfeature",{feature:s.feature},!0)),s&&this.options.simplifyFactor>0&&(s.setLatLngs||s.setLatLng)&&this._updateLayer(s,i),s||(r=this.createNewLayer(i),r?(r.feature=i,r.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(r.feature,r),this._layers[r.feature.id]=r,this.setFeatureStyle(r.feature.id,this.options.style),this.fire("createfeature",{feature:r.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(i))&&this._map.addLayer(r)):ct("invalid GeoJSON encountered"))}},addLayers:function(e){for(var t=e.length-1;t>=0;t--){var i=this._layers[e[t]];i&&(!this.options.timeField||this._featureWithinTimeRange(i.feature))&&this._map.addLayer(i)}},removeLayers:function(e,t){for(var i=e.length-1;i>=0;i--){var s=e[i],r=this._layers[s];r&&(this.fire("removefeature",{feature:r.feature,permanent:t},!0),this._map.removeLayer(r)),r&&t&&delete this._layers[s]}},cellEnter:function(e,t){this._visibleZoom()&&!this._zooming&&this._map&&g.exports.Util.requestAnimFrame(g.exports.Util.bind(function(){var i=this._cacheKey(t),s=this._cellCoordsToKey(t),r=this._cache[i];this._activeCells[s]&&r&&this.addLayers(r)},this))},cellLeave:function(e,t){this._zooming||g.exports.Util.requestAnimFrame(g.exports.Util.bind(function(){if(this._map){var i=this._cacheKey(t),s=this._cellCoordsToKey(t),r=this._cache[i],n=this._map.getBounds();if(!this._activeCells[s]&&r){for(var o=!0,a=0;a<r.length;a++){var h=this._layers[r[a]];h&&h.getBounds&&n.intersects(h.getBounds())&&(o=!1)}o&&this.removeLayers(r,!this.options.cacheLayers),!this.options.cacheLayers&&o&&(delete this._cache[i],delete this._cells[s],delete this._activeCells[s])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(e){this.resetFeatureStyle(e.feature.id)},this),this},setStyle:function(e){return this.options.style=e,this.eachFeature(function(t){this.setFeatureStyle(t.feature.id,e)},this),this},resetFeatureStyle:function(e){var t=this._layers[e],i=this._originalStyle||g.exports.Path.prototype.options;return t&&(g.exports.Util.extend(t.options,t.defaultOptions),this.setFeatureStyle(e,i)),this},setFeatureStyle:function(e,t){var i=this._layers[e];return typeof t=="function"&&(t=t(i.feature)),i.setStyle&&i.setStyle(t),this},eachActiveFeature:function(e,t){if(this._map){var i=this._map.getBounds();for(var s in this._layers)this._currentSnapshot.indexOf(this._layers[s].feature.id)!==-1&&(typeof this._layers[s].getLatLng=="function"&&i.contains(this._layers[s].getLatLng())?e.call(t,this._layers[s]):typeof this._layers[s].getBounds=="function"&&i.intersects(this._layers[s].getBounds())&&e.call(t,this._layers[s]))}return this},eachFeature:function(e,t){for(var i in this._layers)e.call(t,this._layers[i]);return this},getFeature:function(e){return this._layers[e]},bringToBack:function(){this.eachFeature(function(e){e.bringToBack&&e.bringToBack()})},bringToFront:function(){this.eachFeature(function(e){e.bringToFront&&e.bringToFront()})},redraw:function(e){return e&&this._redraw(e),this},_redraw:function(e){var t=this._layers[e],i=t.feature;if(t&&t.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var s=this.options.pointToLayer(i,g.exports.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])),r=s.options.icon;t.setIcon(r)}if(t&&t.setStyle&&this.options.pointToLayer){var n=this.options.pointToLayer(i,g.exports.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])),o=n.options;this.setFeatureStyle(i.id,o)}t&&t.setStyle&&this.options.style&&this.resetStyle(i.id)}});const Mi='<a href="http://www.kartverket.no/">Kartverket</a>',Fi=["opencache","opencache2","opencache3"],Ni='<a href="https://www.nve.no/">NVE</a>',Hr=x.tileLayer("https://{s}.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=toporaster4&zoom={z}&x={x}&y={y}",{attribution:Mi,subdomains:Fi}),Vr=x.tileLayer("https://{s}.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=topo4&zoom={z}&x={x}&y={y}",{attribution:Mi,subdomains:Fi}),Ui=qr({url:"https://gis2.nve.no/arcgis/rest/services/wmts/KastWMTS/MapServer",layers:[0,1,2,3]},{attribution:Ni}),Bi=x.tileLayer.wms("https://gis3.nve.no/map/services/Bratthet/MapServer/WmsServer?",{layers:"Bratthet_snoskred",format:"image/png",transparent:"true",attribution:Ni}),Pe={Vektorkart:Vr,Rasterkart:Hr},Gi={Helning:Bi,AutoKAST:Ui},zi={Tillegg:{Helning:Bi,AutoKAST:Ui}};x.control.groupedLayers(Pe,zi,{exclusiveGroups:["Tillegg"],position:"bottomright",collapsed:!0});var Zr={exports:{}};(function(e,t){(function(i,s){e.exports=i(g.exports),typeof s!="undefined"&&s.L&&i(s.L)})(function(i){return i.locales={},i.locale=null,i.registerLocale=function(r,n){i.locales[r]=i.Util.extend({},i.locales[r],n)},i.setLocale=function(r){i.locale=r},i.i18n=i._=function(r,n){i.locale&&i.locales[i.locale]&&i.locales[i.locale][r]&&(r=i.locales[i.locale][r]);try{r=i.Util.template(r,n)}catch{}return r}},window)})(Zr);function Qt(e,...t){if(!t.length)return e;const i=t.shift();if(ie(e)&&ie(i))for(const s in i)ie(i[s])?(e[s]||Object.assign(e,{[s]:{}}),Qt(e[s],i[s])):Object.assign(e,{[s]:i[s]});return Qt(e,...t)}function ji(e){document.readyState!=="complete"?window.addEventListener("load",e,{once:!0}):e()}function Jr(e,t,i,s){var r;return function(){var n=arguments;clearTimeout(r),r=setTimeout(function(){r=null,s||e.apply(i,n)},t),s&&!r&&e.apply(i,n)}}const $i=1e3,De=$i*60,te=De*60,ee=te*24;function Re(e){let t=Math.floor(e/ee),i=Math.floor((e-t*ee)/te),s=Math.floor((e-t*ee-i*te)/De),r=Math.round((e-t*ee-i*te-s*De)/$i);return r===60&&(s++,r=0),s===60&&(i++,s=0),i===24&&(t++,i=0),(t?t+"d ":"")+i.toString().padStart(2,0)+":"+s.toString().padStart(2,0)+"'"+r.toString().padStart(2,0)+'"'}function qi(e,t){typeof e=="string"&&(e=JSON.parse(e)),t=t||this;let i=t.options.distanceMarkers===!0?{lazy:!0}:L.extend({lazy:!0},t.options.distanceMarkers),s=t.options.wptIcons,r=L.geoJson(e,{distanceMarkers:i,style:n=>{let o=L.extend({},t.options.polyline);return t.options.theme&&(o.className+=" "+t.options.theme),o},pointToLayer:(n,o)=>{if(!t.options.waypoints)return;let a=n.properties,h=a.desc?a.desc:"",l=a.name?a.name:"",c=(a.sym?a.sym:l).replace(" ","-").replace('"',"").replace("'","").toLowerCase();s.hasOwnProperty(c)||(s[c]=L.divIcon(L.extend({},s[""].options,{html:'<i class="elevation-waypoint-icon '+c+'"></i>'})));let u=L.marker(o,{icon:s[c]});return(l||h)&&u.bindPopup("<b>"+l+"</b>"+(h.length>0?"<br>"+h:"")).openPopup(),t._addMarker(u),t._registerCheckPoint({latlng:o,label:l},!0),t.fire("waypoint_added",{point:u,element:o,properties:a}),u},onEachFeature:(n,o)=>{n.geometry&&n.geometry.type=="Point"||(o._latlngs.forEach((a,h,l)=>{if(a.meta={time:null,ele:null,hr:null,cad:null,atemp:null},"alt"in a&&(a.meta.ele=a.alt),n.properties){let c=n.properties;"coordTimes"in c?a.meta.time=new Date(Date.parse(c.coordTimes[h])):"times"in c?a.meta.time=new Date(Date.parse(c.times[h])):"time"in c&&(a.meta.time=new Date(Date.parse(typeof c.time=="object"?c.time[h]:c.time))),"heartRates"in c?a.meta.hr=parseInt(c.heartRates[h]):"heartRate"in c&&(a.meta.hr=parseInt(typeof c.heartRate=="object"?c.heartRate[h]:c.heartRate))}}),t.addData(o),t.options.distanceMarkers&&i.lazy&&o.on("add remove",a=>{let h=a.target;L.DistanceMarkers&&h instanceof L.Polyline&&h[a.type+"DistanceMarkers"]()}),t.track_info=L.extend({},t.track_info,{type:"geojson",name:e.name}))}});return L.Control.Elevation._d3LazyLoader.then(()=>{t._fireEvt("eledata_loaded",{data:e,layer:r,name:t.track_info.name,track_info:t.track_info})}),r}function Kr(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}function ie(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Hi(e){if(!e)return!1;let t=window.getComputedStyle(e);function i(r,n){return n.visibility!=="hidden"&&n.display!=="none"}function s(r,n){let o=r.getBoundingClientRect(),a=o.left+1,h=o.right-1,l=o.top+1;o.bottom-1;let c=!0,u=r.style.pointerEvents;return n["pointer-events"]=="none"&&(r.style.pointerEvents="auto"),document.elementFromPoint(a,l)!==r&&(c=!1),document.elementFromPoint(h,l)!==r&&(c=!1),r.style.pointerEvents=u,c}return!(!i(e,t)||!s(e,t))}function Vi(e,t){if(t=typeof t=="undefined"?!0:t,typeof e=="string"&&t)return e=e.trim(),e.indexOf("{")==0||e.indexOf("[")==0;try{JSON.parse(e.toString())}catch(i){return typeof e=="object"&&t?!0:(console.warn(i),!1)}return!0}function Zi(e,t){if(t=typeof t=="undefined"?!0:t,typeof e=="string"&&t)return e=e.trim(),e.indexOf("<")==0;{let i=(e?e.ownerDocument||e:0).documentElement;return i?i.nodeName!=="HTML":!1}}function ut(e,t,i){return t===!1?Promise.resolve():i instanceof Promise?i:new Promise((s,r)=>{let n=document.createElement("script");n.addEventListener("load",s,{once:!0}),n.src=e,document.head.appendChild(n)})}function Ji(e,t){let i=dt("a","",{href:e,target:"_new",download:t||"",style:"display:none;"}),s=document.body;s.appendChild(i),i.click(),s.removeChild(i)}function Ki(e){return new Promise((t,i)=>{let s=!1,r=()=>{s||(L.Util.requestAnimFrame(()=>{Hi(e)&&(window.removeEventListener("scroll",r),t()),s=!1}),s=!0)};window.addEventListener("scroll",r),e&&e.addEventListener("mouseenter",r,{once:!0}),r()})}function vt(e,t){e&&t.split(" ").every(i=>i&&L.DomUtil.addClass(e,i))}function Ot(e,t){e&&t.split(" ").every(i=>i&&L.DomUtil.removeClass(e,i))}function se(e,t,i){return(i?vt:Ot).call(null,e,t)}function re(e,t,i){t&&Ot(e,t),i&&vt(e,i)}function bt(e,t,i){return typeof i=="undefined"?L.DomUtil.getStyle(e,t):e.style.setProperty(t,i)}function Me(e,t,i,s){return bt(e,t,s?i:"")}function Fe(e,t,i,s){return e[s?"on":"off"](t,i)}function dt(e,t,i,s){let r=L.DomUtil.create(e,t||"");return i&&Wi(r,i),s&&Ne(s,r),r}function Ne(e,t){return e.appendChild(t)}function Ue(e,t,i){return e.insertAdjacentElement(i,t)}function Wi(e,t){for(let i in t)e.setAttribute(i,t[i])}function Pt(e,t){return(t||document).querySelector(e)}const X=L.DomEvent.on,Be=L.DomEvent.off,Xi=L.DomUtil.hasClass;function Yi(){return Math.random().toString(36).substr(2,9)}function Dt(e,t){for(let i in e)t(e[i],i)}var Wr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",deepMerge:Qt,deferFunc:ji,debounce:Jr,formatTime:Re,GeoJSONLoader:qi,isDomVisible:Kr,isObject:ie,isVisible:Hi,isJSONDoc:Vi,isXMLDoc:Zi,lazyLoader:ut,saveFile:Ji,waitHolder:Ki,addClass:vt,removeClass:Ot,toggleClass:se,replaceClass:re,style:bt,toggleStyle:Me,toggleEvent:Fe,create:dt,append:Ne,insert:Ue,setAttributes:Wi,select:Pt,on:X,off:Be,hasClass:Xi,randomId:Yi,each:Dt});const ne={lightblue:{area:"#3366CC",alpha:.45,stroke:"#3366CC"},magenta:{area:"#FF005E"},yellow:{area:"#FF0"},purple:{area:"#732C7B"},steelblue:{area:"#4682B4"},red:{area:"#F00"},lime:{area:"#9CC222",line:"#566B13"}},Qi=({width:e,height:t,xAttr:i,yAttr:s,scaleX:r,scaleY:n,interpolation:o="curveLinear"})=>d3.area().curve(typeof o=="string"?d3[o]:o).x(a=>a.xDiagCoord=r(a[i])).y0(t).y1(a=>n(a[s])),ts=({name:e,color:t,strokeColor:i,strokeOpacity:s,fillOpacity:r})=>{let n=d3.create("svg:path");return e&&n.classed(e,!0),n.style("pointer-events","none"),n.attr("fill",t||"#3366CC").attr("stroke",i||"#000").attr("stroke-opacity",s||"1").attr("fill-opacity",r||"0.8"),n},Ge=({type:e="axis",tickSize:t=6,tickPadding:i=3,position:s,height:r,width:n,axis:o,scale:a,ticks:h,tickFormat:l,label:c,labelX:u,labelY:d,name:f="",onAxisMount:p})=>_=>{let[v,k]=[0,0];s=="bottom"&&(k=r),s=="right"&&(v=n),o=="x"&&e=="grid"?t=-r:o=="y"&&e=="grid"&&(t=-n);let b=d3["axis"+s.replace(/\b\w/g,T=>T.toUpperCase())]().scale(a).ticks(h).tickPadding(i).tickSize(t).tickFormat(l),w=_.append("g").attr("class",[o,e,s,f].join(" ")).attr("transform","translate("+v+","+k+")").call(b);return c&&w.append("svg:text").attr("x",u).attr("y",d).text(c),p&&w.call(p),w},es=e=>(e.type="grid",Ge(e)),is=({theme:e,xCoord:t=0,yCoord:i=0,length:s=0})=>r=>r.attr("class",e+" height-focus line").attr("x1",t).attr("x2",t).attr("y1",i).attr("y2",s),ss=({theme:e,xCoord:t=0,yCoord:i=0,label:s})=>r=>{r.attr("class",e+" height-focus-label").style("pointer-events","none").attr("x",t+5).attr("y",i);let n=r.select(".height-focus-y");return n.node()||(n=r.append("svg:tspan")),n.attr("class","height-focus-y").text(s),r.selectAll("tspan").attr("x",t+5),r},rs=({theme:e,xCoord:t=0,yCoord:i=0})=>s=>s.attr("class",e+" height-focus circle-lower").attr("transform","translate("+t+","+i+")").attr("r",6).attr("cx",0).attr("cy",0),ns=({name:e,label:t,width:i,height:s,margins:r={},color:n,path:o})=>a=>{a.attr("class","legend-item legend-"+e.toLowerCase()).attr("data-name",e);const h=d3.select(a.node().ownerSVGElement||a);return a.on("click.legend",()=>h.dispatch("legend_clicked",{detail:{path:o.node(),name:e,legend:a.node(),enabled:!o.classed("leaflet-hidden")}})),a.append("svg:rect").attr("x",i/2-50).attr("y",s+r.bottom/2).attr("width",50).attr("height",10).attr("fill",n).attr("stroke","#000").attr("stroke-opacity","0.5").attr("fill-opacity","0.25"),a.append("svg:text").text(L._(t||e)).attr("x",i/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",s+r.bottom/2).attr("dy","0.75em"),a},ze=({xCoord:e=0,height:t})=>i=>i.attr("class","mouse-focus-line").attr("x2",e).attr("y2",0).attr("x1",e).attr("y1",t),je=({xCoord:e,yCoord:t,labelX:i="",labelY:s="",width:r})=>n=>{n.attr("class","mouse-focus-label");let o=n.select(".mouse-focus-label-rect"),a=n.select(".mouse-focus-label-text"),h=a.select(".mouse-focus-label-y"),l=a.select(".mouse-focus-label-x");o.node()||(o=n.append("svg:rect")),a.node()||(a=n.append("svg:text")),h.node()||(h=a.append("svg:tspan")),l.node()||(l=a.append("svg:tspan")),h.text(s),l.text(i);let c=0,u=0,d={width:0,height:0};try{d=a.node().getBBox()}catch{return n}return e&&(c=e+(e<r/2?10:-d.width-10)),t&&(u=Math.max(t-d.height,L.Browser.webkit?0:-1/0)),o.attr("class","mouse-focus-label-rect").attr("x",c-5).attr("y",u-5).attr("width",d.width+10).attr("height",d.height+10).attr("rx",3).attr("ry",3),a.attr("class","mouse-focus-label-text").style("font-weight","700").attr("y",u),h.attr("class","mouse-focus-label-y").attr("dy","1em"),l.attr("class","mouse-focus-label-x").attr("dy","2em"),a.selectAll("tspan").attr("x",c),n},os=({height:e,width:t})=>i=>{i.data([{x:0,y:e}]).attr("transform",a=>"translate("+a.x+","+a.y+")");let s=i.selectAll(".horizontal-drag-rect").data([{w:t}]),r=i.selectAll(".horizontal-drag-line").data([{w:t}]),n=i.selectAll(".horizontal-drag-label").data([{w:t-8}]),o=i.selectAll(".horizontal-drag-symbol").data([{type:d3.symbolTriangle,x:t+7,y:0,angle:-90,size:50}]);return s.exit().remove(),r.exit().remove(),n.exit().remove(),o.exit().remove(),s.enter().append("svg:rect").attr("class","horizontal-drag-rect").attr("x",0).attr("y",-8).attr("height",8).attr("fill","none").attr("pointer-events","all").merge(s).attr("width",a=>a.w),r.enter().append("svg:line").attr("class","horizontal-drag-line").attr("x1",0).merge(r).attr("x2",a=>a.w),n.enter().append("svg:text").attr("class","horizontal-drag-label").attr("text-anchor","end").attr("y",-8).merge(n).attr("x",a=>a.w),o.enter().append("svg:path").attr("class","horizontal-drag-symbol").merge(o).attr("d",d3.symbol().type(a=>a.type).size(a=>a.size)).attr("transform",a=>"translate("+a.x+","+a.y+") rotate("+a.angle+")"),i},$e=({min:e,max:t,attr:i,name:s,forceBounds:r,scale:n})=>function(o){i=i||s,n&&n.attr&&(i=n.attr);let a=o&&o.length?d3.extent(o,h=>h[i]):[0,1];return typeof e!="undefined"&&(e<a[0]||r)&&(a[0]=e),typeof t!="undefined"&&(t>a[1]||r)&&(a[1]=t),a},as=({axis:e})=>function(t,i){if(e=="x")return[0,t];if(e=="y")return[i,0]},oe=({data:e,attr:t,min:i,max:s,forceBounds:r,range:n})=>d3.scaleLinear().range(n).domain($e({min:i,max:s,attr:t,forceBounds:r})(e)),Xr=({data:e=[0,1],scale:t,x:i,attr:s})=>d3.bisector(r=>r[s]).left(e,t.invert(i)),ls=({width:e,height:t,margins:i={},ruler:s})=>{const r=e-i.left-i.right,n=t-i.top-i.bottom,o=d3.create("svg:svg").attr("class","background"),a=o.append("g"),h={grid:a.append("g").attr("class","grid"),area:a.append("g").attr("class","area"),point:a.append("g").attr("class","point"),axis:a.append("g").attr("class","axis"),brush:a.append("g").attr("class","brush"),tooltip:a.append("g").attr("class","tooltip").attr("display","none"),ruler:a.append("g").attr("class","ruler"),legend:a.append("g").attr("class","legend")},l=h.area.append("svg:clipPath").attr("id","elevation-clipper"),c=l.append("svg:rect"),u=h.area.append("svg:foreignObject"),d=u.append("xhtml:canvas").attr("class","canvas-plot"),f=d.node().getContext("2d"),p=h.ruler,_=h.tooltip,v=h.brush;_.append("svg:line").call(ze({xCoord:0,height:n})),_.append("g").call(je({xCoord:0,yCoord:0,height:n,width:r,labelX:"",labelY:""}));let k=d3.brushX().on("start.cursor end.cursor brush.cursor",()=>v.select(".overlay").attr("cursor",null));const b=S=>({x:oe(S.x),y:oe(S.y)});let w={clipPath:l,canvas:d,context:f,dragG:p,focusG:_,brush:k},T={svg:o,g:a,panes:h,utils:w,scale:b};return T._resize=({width:S,height:R,margins:B={},ruler:D})=>{const V=S-B.left-B.right,j=R-B.top-B.bottom;o.attr("viewBox",`0 0 ${S} ${R}`).attr("width",S).attr("height",R),a.attr("transform","translate("+B.left+","+B.top+")"),/Mac|iPod|iPhone|iPad/.test(navigator.platform)&&/AppleWebkit/i.test(navigator.userAgent)&&d.style("transform","translate("+B.left+"px,"+B.top+"px)"),c.attr("x",0).attr("y",0).attr("width",V).attr("height",j),u.attr("width",V).attr("height",j),d.attr("width",V).attr("height",j),D&&p.call(os({height:j,width:V})),v.call(k.extent([[0,0],[V,j]])),v.select(".overlay").attr("cursor",null),T._width=V,T._height=j,T.svg.dispatch("resize",{detail:{width:V,height:j}})},T.pane=S=>(h[S]||(h[S]=a.append("g").attr("class",S)),h[S]),T.get=S=>w[S],T._resize({width:e,height:t,margins:i}),T};var Yr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Colors:ne,Area:Qi,Path:ts,Axis:Ge,Grid:es,HeightFocusLine:is,HeightFocusLabel:ss,HeightFocusMarker:rs,LegendItem:ns,MouseFocusLine:ze,MouseFocusLabel:je,Ruler:os,Domain:$e,Range:as,Scale:oe,Bisect:Xr,Chart:ls}),hs=L.Class.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,initialize:function(e,t){this.options=e,this.control=t,this._data=[],this._props={scales:{},paths:{},areas:{},grids:{},axes:{},legendItems:{},focusLabels:{}},this._scales={},this._domains={},this._ranges={},this._paths={},this._brushEnabled=e.dragging,this._zoomEnabled=e.zooming,e.imperial?(this._xLabel="mi",this._yLabel="ft"):(this._xLabel=e.xLabel,this._yLabel=e.yLabel);let i=this._chart=ls(e);this._container=i.svg,this._grid=i.pane("grid"),this._area=i.pane("area"),this._point=i.pane("point"),this._axis=i.pane("axis"),this._legend=i.pane("legend"),this._initScale(),this._clipPath=i.get("clipPath"),this._canvas=i.get("canvas"),this._context=i.get("context"),this._dragG=i.get("dragG"),this._focusG=i.get("focusG"),this._brush=i.get("brush"),this._focusline=this._focusG.select(".mouse-focus-line"),this._focuslabel=this._focusG.select(".mouse-focus-label"),this._zoom=d3.zoom(),this._drag=d3.drag(),this._initInteractions()},update:function(e){return e&&(e.data&&(this._data=e.data),e.options&&(this.options=e.options)),this._updateScale(),this._updateArea(),this._updateAxis(),this._updateLegend(),this._updateClipper(),this},render:function(){return e=>e.append(()=>this._container.node())},clear:function(){this._resetDrag(),this._hideDiagramIndicator(),this._area.selectAll("path").attr("d","M0 0"),this._context.clearRect(0,0,this._width(),this._height()),this._path},_drawPath:function(e){let t=this.options,i=this._context,s=this._paths[e],r=this._props.areas[e],n=s.node(),o=this._scales[r.scaleX],a=this._scales[r.scaleY];if(r=L.extend({},r,{width:this._width(),height:this._height(),scaleX:o,scaleY:a}),!a||!a)return console.warn("Unable to render path:"+e);if(s.datum(this._data).attr("d",Qi(r)),!s.classed("leaflet-hidden"))if(t.preferCanvas){s.classed("canvas-path",!0),i.beginPath(),i.moveTo(0,0);let h=new Path2D(s.attr("d"));i.strokeStyle=s.attr("stroke"),i.fillStyle=s.attr("fill"),i.lineWidth=1.25,i.globalCompositeOperation="source-over",i.globalAlpha=s.attr("stroke-opacity")||.3,i.stroke(h),i.globalAlpha=s.attr("fill-opacity")||.45,i.fill(h),i.globalAlpha=1,i.closePath()}else this._area.append(()=>n)},_hasActiveLayers:function(){const e=this._paths;for(var t in e)if(!e[t].classed("leaflet-hidden"))return!0;return!1},_initBrush:function(e){const t=s=>{if(!this._data.length)return;let r=s.selection;if(r){let n=this._findIndexForXCoord(r[0]),o=this._findIndexForXCoord(r[1]);this.fire("dragged",{dragstart:this._data[n],dragend:this._data[o]})}},i=s=>{if(!this._data.length||s.type=="brush"&&!s.sourceEvent)return;let r=this._chart.panes.brush.select(".overlay").node(),o=d3.pointers(s,r)[0][0],a=this._data[this._findIndexForXCoord(o)];this.fire("mouse_move",{item:a,xCoord:o})};this._brush.filter(s=>this._brushEnabled&&!s.shiftKey&&!s.button).on("end.update",t).on("brush.update",i),this._chart.panes.brush.on("mouseenter.focus touchstart.focus",this.fire.bind(this,"mouse_enter")).on("mouseout.focus touchend.focus",this.fire.bind(this,"mouse_out")).on("mousemove.focus touchmove.focus",i)},_initClipper:function(){let e=this._container,t=this.options.margins;const i=this._zoom,s=o=>{o.sourceEvent&&o.sourceEvent.type=="mousedown"&&e.style("cursor","grabbing"),o.transform.k==1&&o.transform.x==0&&this._container.classed("zoomed",!0),this.zooming=!0},r=o=>{o.transform.k==1&&o.transform.x==0&&this._container.classed("zoomed",!1),this.zooming=!1,e.style("cursor","")},n=o=>{this.zooming=!1,this._updateScale(),this.zooming=!0,this._scales.distance=this._x=o.transform.rescaleX(this._x),this._resetDrag(),o.sourceEvent&&o.sourceEvent.type=="mousemove"&&this._hideDiagramIndicator(),this.fire("zoom")};i.scaleExtent([1,10]).extent([[t.left,0],[this._width()-t.right,this._height()]]).translateExtent([[t.left,-1/0],[this._width()-t.right,1/0]]).filter(o=>this._zoomEnabled&&(o.shiftKey||o.buttons==4)).on("start",s).on("end",r).on("zoom",n),e.call(i)},_initInteractions:function(){this._initBrush(),this._initRuler(),this._initClipper(),this._initLegend()},_initLegend:function(){this._container.on("legend_clicked",e=>{let{path:t,legend:i,name:s,enabled:r}=e.detail;if(!t)return;let n=Pt("text",i),o=Pt("rect",i);Me(n,"text-decoration-line","line-through",r),Me(o,"fill-opacity","0",r),se(t,"leaflet-hidden",r),this._updateArea(),this.fire("elepath_toggle",{path:t,name:s,legend:i,enabled:r})})},_initRuler:function(){if(!this.options.ruler)return;const e=d3.format(".0f"),t=this._drag,i=(r,n)=>{let o=this._height(),a=this._dragG.data()[0].y;(a>=o||a<=0)&&this._dragG.select(".horizontal-drag-label").text(""),this._hideDiagramIndicator()},s=(r,n)=>{let o=this._height(),a=d3.pointers(r,this._area.node())[0][1],h=a>0?a<o?a:o:0,l=this._y.invert(h),c=L.extend(this._dragG.data()[0],{y:h});this._dragG.data([c]).attr("transform",u=>"translate("+u.x+","+u.y+")").classed("active",h<o),this._container.select(".horizontal-drag-label").text(e(l)+" "+this._yLabel),this.fire("ruler_filter",{coords:a<o&&a>0?this._findCoordsForY(a):[]})};t.on("start end",i).on("drag",s),this._dragG.call(t)},_initScale:function(){let e=this.options;this._registerAxisScale({axis:"x",position:"bottom",attr:e.xAttr,min:e.xAxisMin,max:e.xAxisMax,name:"distance"}),this._registerAxisScale({axis:"y",position:"left",attr:e.yAttr,min:e.yAxisMin,max:e.yAxisMax,name:"altitude"}),this._x=this._scales.distance,this._y=this._scales.altitude},_registerAreaPath:function(e){let t=this.options;e.xAttr||(e.xAttr=t.xAttr),e.yAttr||(e.yAttr=t.yAttr),typeof e.preferCanvas=="undefined"&&(e.preferCanvas=t.preferCanvas);let i=ts(e);this._paths[e.name]=i,this._props.areas[e.name]=e,t.legend&&(this._props.legendItems[e.name]={name:e.name,label:e.label,color:e.color,path:i})},_registerAxisGrid:function(e){this._props.grids[e.name||e.axis]=e},_registerAxisScale:function(e){let t=this.options,i=e.scale;if(typeof i!="function"){i=L.extend({data:this._data,forceBounds:t.forceAxisBounds},i),i.attr=i.attr||e.name;let s=this._domains[e.name]=$e(e),r=this._ranges[e.name]=as(e);i.range=i.range||r(this._width(),this._height()),i.domain=i.domain||s(this._data),this._props.scales[e.name]=i,e.scale=this._scales[e.name]=oe(i)}return e.ticks||(e.axis=="x"?e.ticks=t.xTicks:e.axis=="y"&&(e.ticks=t.yTicks)),this._props.axes[e.name]=e,i},_registerCheckPoint:function(e){if(!this._data.length)return;let t,i,s;if(e.latlng)t=this._data[this._findIndexForLatLng(e.latlng)],i=this._x(t.dist),s=this._y(t.z);else if(!isNaN(e.dist))i=this._x(e.dist),t=this._data[this._findIndexForXCoord(i)],s=this._y(t.z);else if(isNaN(i)||isNaN(s))return;(!e.item||!e.item.property("isConnected"))&&(e.position=e.position||"bottom",e.item=this._point.append("g"),e.item.append("svg:line").attr("y1",0).attr("x1",0).attr("style","stroke: rgb(51, 51, 51); stroke-width: 0.5; stroke-dasharray: 2, 2;"),e.item.append("svg:circle").attr("class"," height-focus circle-lower").attr("r",3),e.label&&e.item.append("svg:text").attr("dx","4px").attr("dy","-4px")),e.item.datum({pos:e.position,x:i,y:s}).attr("class",r=>"point "+r.pos).attr("transform",r=>"translate("+r.x+","+r.y+")"),e.item.select("line").datum({y2:{top:-s,bottom:this._height()-s}[e.position],x2:{left:-i,right:this._width()-i}[e.position]||0}).attr("y2",r=>r.y2).attr("x2",r=>r.x2),e.label&&e.item.select("text").text(e.label)},_registerFocusLabel:function(e){this._props.focusLabels[e.name]=e},_updateArea:function(){let e=this._paths;this._context.clearRect(0,0,this._width(),this._height());for(var t in e)e[t].classed("leaflet-hidden")||this._drawPath(t)},_updateAxis:function(){let e=this.options;this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove();let t=this._props.grids,i=this._props.axes,s,r,n,o={width:this._width(),height:this._height(),tickFormat:""},a={width:this._width(),height:this._height()};for(let h in t)s=L.extend({},o,t[h]),n=es(s),this._grid.call(n);for(let h in i)e[h]===!1||e[h]==="summary"||(s=L.extend({},a,i[h]),r=Ge(s),this._axis.call(r));this._axis.selectAll(".y.axis.right").each((h,l,c)=>{let u=d3.select(c[l]),d=u.attr("transform"),f=d.substring(d.indexOf("(")+1,d.indexOf(")")).split(",");u.attr("transform","translate("+(+f[0]+l*40)+","+f[1]+")"),l>0&&(u.select(":scope > path").attr("opacity",.25),u.selectAll(":scope > .tick line").attr("opacity",.75))})},_updateClipper:function(){let e=this.options.margins;this._zoom.scaleExtent([1,10]).extent([[e.left,0],[this._width()-e.right,this._height()]]).translateExtent([[e.left,-1/0],[this._width()-e.right,1/0]])},_updateLegend:function(){if(this.options.legend==!1)return;let e=this._props.legendItems,t;this._legend.selectAll("g").remove();for(var i in e)t=ns(L.extend({width:this._width(),height:this._height(),margins:this.options.margins},e[i])),this._legend.append("g").call(t);let s=this._legend.selectAll(".legend-item"),r=s.nodes().length,n=Array(Math.floor(r/2)).fill(null).map((c,u)=>(u+1)*2-(1-Math.sign(r%2))),o=n.slice().reverse().map(c=>-c);r%2!=0&&o.push(0),n=o.concat(n);let a=this._axis.selectAll(".x.axis.bottom").nodes().length,h=30+a*2,l=r*30;r&&this.options.margins.right<l&&(this.options.margins.right=l,this.fire("margins_updated")),a&&this.options.margins.bottom<h&&(this.options.margins.bottom=h,this.fire("margins_updated")),s.each((c,u,d)=>{let f=d3.select(d[u]);f.select("rect");let p=f.attr("data-name"),_=this._paths[p],v=n[u]*55,k=a*2;f.attr("transform","translate("+v+", "+k+")"),p in this.options&&this.options[p]=="disabled"&&(_.classed("leaflet-hidden",!0),f.select("text").style("text-decoration-line","line-through"),f.select("rect").style("fill-opacity","0")),this._clipPath&&_.attr("clip-path","url(#"+this._clipPath.attr("id")+")")})},_updateScale:function(){if(this.zooming)return{x:this._x,y:this._y};this.options;let e=this._scales,t=this._domains,i=this._ranges;for(let s in e)e[s].domain(t[s](this._data)).range(i[s](this._width(),this._height()));return{x:this._x,y:this._y}},_width:function(){return this._chart._width},_height:function(){return this._chart._height},_findCoordsForY:function(e){let t=this._data,i=this._y.invert(e);const s=t.reduce((a,h,l)=>(h.z>=i&&a.push(l),a),[]);let r=0,n;return s.reduce((a,h,l)=>(n=l+1,(s[n]!==s[l]+1||n===s.length)&&(a.push(s.slice(r,n).map(c=>t[c].latlng)),r=n),a),[])},_findIndexForXCoord:function(e){return d3.bisector(t=>t[this.options.xAttr]).left(this._data||[0,1],this._x.invert(e))},_findIndexForLatLng:function(e){let t=null,i=1/0;return this._data.forEach((s,r)=>{let n=e.distanceTo(s.latlng);n<i&&(i=n,t=r)}),t},_resetDrag:function(){this._chart.panes.brush.select(".selection").attr("width")&&(this._chart.panes.brush.call(this._brush.clear),this._hideDiagramIndicator(),this.fire("reset_drag"))},_resetZoom:function(){this._zoom&&this._zoom.transform(this._chart.svg,d3.zoomIdentity)},_showDiagramIndicator:function(e,t){let i=this.options,s=this._y(e[i.yAttr]);this._focusG.attr("display",null),this._focusline.call(ze({xCoord:t,height:this._height()})),this._focuslabel.call(je({xCoord:t,yCoord:s,height:this._height(),width:this._width(),labelX:d3.format("."+i.decimalsX+"f")(e[i.xAttr])+" "+this._xLabel,labelY:d3.format("."+i.decimalsY+"f")(e[i.yAttr])+" "+this._yLabel}));let r=this._props.focusLabels,n=this._focuslabel.select("text"),o;for(var a in r)o=n.select(".mouse-focus-label-"+r[a].name),o.size()||(o=n.append("svg:tspan",".mouse-focus-label-x").attr("class","mouse-focus-label-"+r[a].name).attr("dy","1.5em")),o.text(typeof r[a].value!="function"?r[a].value:r[a].value(e)),this._focuslabel.select(".mouse-focus-label-x").attr("dy","1.5em")},_hideDiagramIndicator:function(){this._focusG.attr("display","none")}}),Qr=L.Class.extend({initialize:function(e){return this.options=e,this.options.imperial?(this._xLabel="mi",this._yLabel="ft"):(this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),this.options.marker=="elevation-line"?(this._focusline=d3.create("svg:line"),this._focusmarker=d3.create("svg:circle"),this._focuslabel=d3.create("svg:text")):this.options.marker=="position-marker"&&(this._marker=L.marker([0,0],{icon:this.options.markerIcon,zIndexOffset:1e6,interactive:!1})),this._focuslabels={},this},addTo:function(e){if(this._map=e,this.options.marker=="elevation-line"){let t=this._container=d3.select(e.getPane("elevationPane")).select("svg > g").attr("class","height-focus-group");t.append(()=>this._focusline.node()),t.append(()=>this._focusmarker.node()),t.append(()=>this._focuslabel.node())}else this.options.marker=="position-marker"&&this._marker.addTo(e,{pane:"overlayPane"});return this},update:function(e){if(e?this._props=e:e=this._props,!e)return;e.options&&(this.options=e.options),this._map||this.addTo(e.map);let t=this.options,i=this._map;this._latlng=e.item.latlng;let s=i.latLngToLayerPoint(this._latlng);i._rotate&&(s=i.rotatedPointToMapPanePoint(s));let r=L.extend({},e.item,s);if(this.options.marker=="elevation-line"){let o=this._height()/e.maxElevation*r.z,a=r.y-o;this._container.classed("leaflet-hidden",!1),this._focusmarker.call(rs({theme:t.theme,xCoord:r.x,yCoord:r.y})),this._focusline.call(is({theme:t.theme,xCoord:r.x,yCoord:r.y,length:a})),this._focuslabel.call(ss({theme:t.theme,xCoord:r.x,yCoord:a,label:d3.format("."+t.decimalsY+"f")(r[t.yAttr])+" "+this._yLabel}));let h=this._focuslabels,l=this._focuslabel,c;for(var n in h)c=l.select(".height-focus-"+h[n].name),c.size()||(c=l.append("svg:tspan").attr("class","height-focus-"+h[n].name).attr("dy","1.5em")),c.text(typeof h[n].value!="function"?h[n].value:h[n].value(e.item)),this._focuslabel.select(".height-focus-y").attr("dy","-1.5em")}else this.options.marker=="position-marker"&&(Ot(this._marker.getElement(),"leaflet-hidden"),this._marker.setLatLng(this._latlng))},remove:function(){this._props=null,this.options.marker=="elevation-line"?this._container&&this._container.classed("leaflet-hidden",!0):this.options.marker=="position-marker"&&vt(this._marker.getElement(),"leaflet-hidden")},getLatLng:function(){return this._latlng},_height:function(){let e=this.options;return e.height-e.margins.top-e.margins.bottom},_registerFocusLabel:function(e){this._focuslabels[e.name]=e}}),tn=L.Class.extend({initialize:function(e,t){this.options=e,this.control=t;let i=this._container=dt("div","elevation-summary "+(e.summary?e.summary+"-summary":""));bt(i,"max-width",e.width?e.width+"px":"")},render:function(){return e=>e.append(()=>this._container)},reset:function(){this._container.innerHTML=""},append:function(e,t,i){return this._container.innerHTML+=`<span class="${e}"><span class="summarylabel">${t}</span><span class="summaryvalue">${i}</span></span>`,this},_registerSummary:function(e){for(let t in e)this.append(t,L._(e[t].label),typeof e[t].value!="function"?e[t].value:e[t].value(this.control.track_info))}}),en={autofitBounds:!0,autohide:!L.Browser.mobile,autohideMarker:!0,almostover:!0,altitude:!0,collapsed:!1,detached:!0,distance:!0,distanceFactor:1,distanceMarkers:!1,decimalsX:2,decimalsY:0,dragging:!L.Browser.mobile,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,height:200,heightFactor:1,imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},margins:{top:30,right:30,bottom:30,left:40},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},polylineSegments:{className:"elevation-polyline-segments",color:"#F00",interactive:!1},preferCanvas:!1,reverseCoords:!1,ruler:!0,skipNullZCoords:!1,theme:"lightblue-theme",responsive:!0,summary:"inline",slope:!1,speed:!1,sLimit:void 0,time:!1,timeFactor:3600,timeFormat:!1,sDeltaMax:void 0,sInterpolation:"curveStepAfter",sRange:void 0,width:600,waypoints:!0,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})},xAttr:"dist",xLabel:"km",xTicks:void 0,yAttr:"z",yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:!1,zooming:!L.Browser.Mobile};const F=L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:en,__mileFactor:.621371,__footFactor:3.28084,__D3:"https://unpkg.com/d3@6.5.0/dist/d3.min.js",__TOGEOJSON:"https://unpkg.com/@tmcw/togeojson@4.3.0/dist/togeojson.umd.js",__LGEOMUTIL:"https://unpkg.com/leaflet-geometryutil@0.9.3/src/leaflet.geometryutil.js",__LALMOSTOVER:"https://unpkg.com/leaflet-almostover@1.0.1/src/leaflet.almostover.js",__LDISTANCEM:"https://unpkg.com/@raruto/leaflet-elevation@1.7.3/libs/leaflet-distance-marker.min.js",addData:function(e,t){typeof t=="undefined"&&e.on&&(t=e),F._d3LazyLoader=ut(this.__D3,typeof d3!="object"||!this.options.lazyLoadJS,F._d3LazyLoader).then(()=>{this._addData(e),this._addLayer(t),this._fireEvt("eledata_added",{data:e,layer:t,track_info:this.track_info})})},addTo:function(e){if(this.options.detached){let t=this._initElevationDiv();t.isConnected||Ue(e.getContainer(),t,"afterend"),Ne(t,this.onAdd(e))}else L.Control.prototype.addTo.call(this,e);return this},clear:function(){this._marker&&this._marker.remove(),this._chart&&this._clearChart(),this._layers&&this._clearLayers(),this._markers&&this._clearMarkers(),this._data=[],this.track_info={},this._fireEvt("eledata_clear"),this._updateChart()},_clearChart:function(){this._events&&this._events.elechart_updated&&this._events.elechart_updated.forEach(e=>controlElevation.off("elechart_updated",e.fn,e.ctx)),this._chart&&this._chart._container&&(this._chart._container.selectAll("g.point .point").remove(),this._chart.clear())},_clearLayers:function(){this._layers&&this._layers.eachLayer&&(this._layers.eachLayer(e=>e.remove()),this._layers.clearLayers())},_clearMarkers:function(){this._markers&&this._markers.eachLayer&&(this._markers.eachLayer(e=>e.remove()),this._markers.clearLayers())},disableBrush:function(){this._chart._brushEnabled=!1,this._resetDrag()},enableBrush:function(){this._chart._brushEnabled=!0},enableDragging:function(){this.enableBrushing()},disableDragging:function(){this.disableBrushing()},disableZoom:function(){this._chart._zoomEnabled=!1,this._chart._resetZoom()},enableZoom:function(){this._chart._zoomEnabled=!0},fitBounds:function(e){e=e||this.getBounds(),this._map&&e.isValid()&&this._map.fitBounds(e)},getBounds:function(e){return e=e||this._data,L.latLngBounds(e.map(t=>t.latlng))},getZFollow:function(){return this._zFollow},hide:function(){bt(this._container,"display","none")},initialize:function(e){this._data=[],this._layers=L.featureGroup(),this._markers=L.featureGroup(),this._markedSegments=L.polyline([]),this._chartEnabled=!0,this.track_info={},this.options=Qt({},this.options,e),this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0),this.options.legend&&(this.options.margins.bottom+=30),this.options.theme&&(this.options.polylineSegments.className+=" "+this.options.theme),this._markedSegments.setStyle(this.options.polylineSegments),L.extend(ne,this.options.colors||{})},load:function(e,t){this.loadData(e,t)},loadChart:function(e){this.addTo(e)},loadData:function(e,t){t=L.extend({},this.options.loadData,t),t.defer?this.loadDefer(e,t):t.lazy?this.loadLazy(e,t):Zi(e)?this.loadXML(e):Vi(e)?this.loadGeoJSON(e):this.loadFile(e)},loadDefer:function(e,t){t=L.extend({},this.options.loadData,t),t.defer=!1,ji(L.bind(this.loadData,this,e,t))},loadFile:function(e){fetch(e).then(t=>t.text()).then(t=>{this._downloadURL=e,this.loadData(t,{lazy:!1,defer:!1})}).catch(t=>console.warn(t))},loadGeoJSON:function(e){qi(e,this)},loadGPX:function(e){this.loadXML(e)},loadXML:function(e){F._togeojsonLazyLoader=ut(this.__TOGEOJSON,typeof toGeoJSON!="function"||!this.options.lazyLoadJS,F._togeojsonLazyLoader).then(()=>{let t=new DOMParser().parseFromString(e,"text/xml"),i=t.documentElement.tagName.toLowerCase();i in toGeoJSON||(i=t.documentElement.tagName=="TrainingCenterDatabase"?"tcx":"gpx");let s=toGeoJSON[i](t),r=t.getElementsByTagName("name");return r[0]?s.name=r[0].innerHTML:this._downloadURL&&(s.name=this._downloadURL.split("/").pop().split("#")[0].split("?")[0]),this.loadGeoJSON(s,this)})},loadLazy:function(e,t){t=L.extend({},this.options.loadData,t);let i=t.lazy.parentNode?t.lazy:this.placeholder;Ki(i).then(()=>{t.lazy=!1,this.loadData(e,t),this.once("eledata_loaded",()=>this.placeholder.parentNode.removeChild(i))})},onAdd:function(e){this._map=e;let t=this._container=dt("div","elevation-control elevation "+this.options.theme);return this.options.detached||vt(t,"leaflet-control"),this.options.placeholder&&!this._data.length&&(this.placeholder=dt("img","elevation-placeholder",typeof this.options.placeholder=="string"?{src:this.options.placeholder,alt:""}:this.options.placeholder),Ue(t,this.placeholder,"afterbegin")),F._d3LazyLoader=ut(this.__D3,typeof d3!="object"||!this.options.lazyLoadJS,F._d3LazyLoader).then(()=>{this._initButton(t),this._initChart(t),this._initSummary(t),this._initMarker(e),this._initLayer(e),e.on("zoom viewreset zoomanim",this._hideMarker,this).on("resize",this._resetView,this).on("resize",this._resizeChart,this).on("rotate",this._rotateMarker,this).on("mousedown",this._resetDrag,this),X(e.getContainer(),"mousewheel",this._resetDrag,this),X(e.getContainer(),"touchstart",this._resetDrag,this),this.on("eledata_added eledata_loaded",this._updateChart,this).on("eledata_added eledata_loaded",this._updateSummary,this),this._updateChart(),this._updateSummary()}),t},onRemove:function(e){this._container=null,e.off("zoom viewreset zoomanim",this._hideMarker,this).off("resize",this._resetView,this).off("resize",this._resizeChart,this).off("mousedown",this._resetDrag,this),Be(e.getContainer(),"mousewheel",this._resetDrag,this),Be(e.getContainer(),"touchstart",this._resetDrag,this),this.off("eledata_added eledata_loaded",this._updateChart,this).off("eledata_added eledata_loaded",this._updateSummary,this)},redraw:function(){this._resizeChart()},setZFollow:function(e){this._zFollow=e},show:function(){bt(this._container,"display","block")},_addData:function(e){if(!e)return;let t=e.geometry;if(t)switch(t.type){case"LineString":this._addGeoJSONData(t.coordinates);break;case"MultiLineString":Dt(t.coordinates,i=>this._addGeoJSONData(i));break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+t.type)}e.type==="FeatureCollection"&&Dt(e.features,i=>this._addData(i)),e._latlngs&&this._addGPXData(e._latlngs)},_addGeoJSONData:function(e){Dt(e,t=>{this._addPoint(t[1],t[0],t[2]),this._fireEvt("elepoint_added",{point:t,index:this._data.length-1})}),this._fireEvt("eletrack_added",{coords:e,index:this._data.length-1})},_addGPXData:function(e){Dt(e,t=>{this._addPoint(t.lat,t.lng,typeof t.alt!="undefined"?t.alt:t.meta.ele),this._fireEvt("elepoint_added",{point:t,index:this._data.length-1})}),this._fireEvt("eletrack_added",{coords:e,index:this._data.length-1})},_addPoint:function(e,t,i){this.options.reverseCoords&&([e,t]=[t,e]),this._data.push({x:e,y:t,z:i,latlng:L.latLng(e,t,i)}),this._fireEvt("eledata_updated",{index:this._data.length-1})},_addLayer:function(e){e&&this._layers.addLayer(e)},_addMarker:function(e){e&&this._markers.addLayer(e)},_initElevationDiv:function(){let e=Pt(this.options.elevationDiv);return e||(this.options.elevationDiv="#elevation-div_"+Yi(),e=dt("div","leaflet-control elevation elevation-div",{id:this.options.elevationDiv.substr(1)})),this.options.detached&&re(e,"leaflet-control","elevation-detached"),this.eleDiv=e,this.eleDiv},_collapse:function(){re(this._container,"elevation-expanded","elevation-collapsed")},_expand:function(){re(this._container,"elevation-collapsed","elevation-expanded")},_findItemForLatLng:function(e){return this._data[this._chart._findIndexForLatLng(e)]},_findItemForX:function(e){return this._data[this._chart._findIndexForXCoord(e)]},_fireEvt:function(e,t,i){this.fire&&this.fire(e,t,i),this._map&&this._map.fire(e,t,i)},_height:function(){if(this._chart)return this._chart._height();let e=this.options;return e.height-e.margins.top-e.margins.bottom},_hideMarker:function(){this.options.autohideMarker&&this._marker.remove()},_initChart:function(e){let t=this.options;if(t.xTicks=this._xTicks(),t.yTicks=this._yTicks(),t.responsive)if(t.detached){let{offsetWidth:s,offsetHeight:r}=this.eleDiv;s>0&&(t.width=s),r>20&&(t.height=r-20)}else{let{clientWidth:s}=this._map.getContainer();t._maxWidth=t._maxWidth>t.width?t._maxWidth:t.width,this._container.style.maxWidth=t._maxWidth+"px",t._maxWidth>s&&(t.width=s-30)}let i=this._chart=new hs(t,this);this._x=this._chart._x,this._y=this._chart._y,d3.select(e).call(i.render()),i.on("reset_drag",this._hideMarker,this).on("mouse_enter",this._fireEvt.bind("elechart_enter"),this).on("dragged",this._dragendHandler,this).on("mouse_move",this._mousemoveHandler,this).on("mouse_out",this._mouseoutHandler,this).on("ruler_filter",this._rulerFilterHandler,this).on("zoom",this._updateChart,this).on("elepath_toggle",this._toggleChartHandler,this).on("margins_updated",this._resizeChart,this),this._fireEvt("elechart_axis"),this.options.legend&&this._fireEvt("elechart_legend"),this._fireEvt("elechart_init")},_initLayer:function(){this._layers.on("layeradd layerremove",e=>{let t=e.layer,i=t.getElement&&t.getElement();se(i,this.options.polyline.className+" "+this.options.theme,e.type=="layeradd"),Fe(t,"mousemove",this._mousemoveLayerHandler.bind(this),e.type=="layeradd"),Fe(t,"mouseout",this._mouseoutHandler.bind(this),e.type=="layeradd")})},_initMarker:function(e){let t=e.getPane("elevationPane");t||(t=this._pane=e.createPane("elevationPane",e.getPane("norotatePane")||e.getPane("mapPane")),t.style.zIndex=625,t.style.pointerEvents="none"),this._renderer&&this._renderer.remove(),this._renderer=L.svg({pane:"elevationPane"}).addTo(this._map),this._marker=new Qr(this.options),this._fireEvt("elechart_marker")},_initButton:function(e){if(e.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(e),L.Browser.mobile&&X(e,"click",L.DomEvent.stopPropagation),X(e,"mousewheel",this._mousewheelHandler,this),!this.options.detached){let t=this._button=dt("a","elevation-toggle elevation-toggle-icon"+(this.options.autohide?"":" close-button"),{href:"#",title:L._("Elevation")},e);this.options.collapsed&&(this._collapse(),this.options.autohide?(X(e,"mouseover",this._expand,this),X(e,"mouseout",this._collapse,this)):(X(t,"click",L.DomEvent.stop),X(t,"click",this._toggle,this)),X(t,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_initSummary:function(e){let t=this._summary=new tn({summary:this.options.summary},this);d3.select(e).call(t.render()),this.summaryDiv=this._summary._container},_dragendHandler:function(e){this._hideMarker(),this.fitBounds(L.latLngBounds([e.dragstart.latlng,e.dragend.latlng])),this._fireEvt("elechart_dragged")},_mousemoveHandler:function(e){if(!this._data.length||!this._chartEnabled)return;let t=this._findItemForX(e.xCoord);if(t){let i=e.xCoord;this._chartEnabled&&this._chart._showDiagramIndicator(t,i),this._updateMarker(t),this._setMapView(t),this._map&&vt(this._map.getContainer(),"elechart-hover"),this._fireEvt("elechart_change",{data:t,xCoord:i}),this._fireEvt("elechart_hover",{data:t,xCoord:i})}},_mousemoveLayerHandler:function(e){if(!this._data.length)return;let t=this._findItemForLatLng(e.latlng);if(t){let i=t.xDiagCoord;this._chartEnabled&&this._chart._showDiagramIndicator(t,i),this._updateMarker(t),this._fireEvt("elechart_change",{data:t,xCoord:i})}},_mouseoutHandler:function(){this.options.detached||(this._hideMarker(),this._chart._hideDiagramIndicator()),this._map&&Ot(this._map.getContainer(),"elechart-hover"),this._fireEvt("elechart_leave")},_mousewheelHandler:function(e){if(this._map.gestureHandling&&this._map.gestureHandling._enabled)return;let t=this._marker.getLatLng()||this._map.getCenter(),i=this._map.getZoom()+Math.sign(e.deltaY);this._resetDrag(),this._map.flyTo(t,i)},_registerCheckPoint:function(e){this.on("elechart_updated",()=>this._chart._registerCheckPoint(e))},_registerAreaPath:function(e){this.on("elechart_init",()=>this._chart._registerAreaPath(e))},_registerAxisGrid:function(e){this.on("elechart_axis",()=>this._chart._registerAxisGrid(e))},_registerAxisScale:function(e){this.on("elechart_axis",()=>this._chart._registerAxisScale(e))},_registerFocusLabel:function(e){if(e.chart){let t=L.extend({},e,{value:e.chart});this.on("elechart_init",()=>this._chart._registerFocusLabel(t))}if(e.marker){let t=L.extend({},e,{value:e.marker});this.on("elechart_marker",()=>this._marker._registerFocusLabel(t))}},_registerSummary:function(e){this.on("elechart_summary",()=>this._summary._registerSummary(e))},_resetDrag:function(){this._chart._resetDrag(),this._hideMarker()},_resetView:function(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hideMarker(),this.options.autofitBounds&&this.fitBounds())},_resizeChart:function(){if(bt(this._container,"display")=="none")return;let e=this.options;if(e.responsive){let t;if(e.detached)t=(this.eleDiv||this._container).offsetWidth;else{let{clientWidth:i}=this._map.getContainer();t=e._maxWidth>i?i-30:e._maxWidth}if(t){let i=this._chart;e.width=t,i&&i._chart&&(i._chart._resize(e),e.xTicks=this._xTicks(),e.yTicks=this._yTicks(),this._updateChart())}}this._updateMapSegments()},_rulerFilterHandler:function(e){this._updateMapSegments(e.coords)},_toggle:function(){Xi(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function(e){if(!this.options.followMarker||!this._map)return;let t=this._map.getZoom();typeof this._zFollow=="number"?(t<this._zFollow&&(t=this._zFollow),this._map.setView(e.latlng,t,{animate:!0,duration:.25})):this._map.getBounds().contains(e.latlng)||this._map.setView(e.latlng,t,{animate:!0,duration:.25})},_toggleChartHandler:function(e){let{path:t,name:i,enabled:s}=e;this._chartEnabled=this._chart._hasActiveLayers(),this._layers.eachLayer(r=>{let n=r.getElement&&r.getElement();se(n,this.options.polyline.className+" "+this.options.theme,this._chartEnabled)}),this.options[i]=!s&&this.options[i]=="disabled"?"enabled":"disabled",this._chartEnabled||(this._chart._hideDiagramIndicator(),this._marker.remove())},_updateChart:function(){!this._container||(this._fireEvt("elechart_axis"),this._fireEvt("elechart_area"),this._chart.update({data:this._data,options:this.options}),this._x=this._chart._x,this._y=this._chart._y,this._fireEvt("elechart_updated"))},_updateMarker:function(e){!this._marker||this._marker.update({map:this._map,item:e,maxElevation:this.track_info.elevation_max||0,options:this.options})},_rotateMarker:function(){!this._marker||this._marker.update()},_updateMapSegments:function(e){this._markedSegments.setLatLngs(e||[]),e&&this._map&&!this._map.hasLayer(this._markedSegments)&&this._markedSegments.addTo(this._map)},_updateSummary:function(){this._summary.reset(),this.options.summary&&this._fireEvt("elechart_summary"),this.options.downloadLink&&this._downloadURL&&(this.summaryDiv.innerHTML+='<span class="download"><a href="#">'+L._("Download")+"</a></span>",Pt(".download a",this.summaryDiv).onclick=e=>{e.preventDefault(),this._fireEvt("eletrack_download",{downloadLink:this.options.downloadLink,confirm:Ji.bind(this,this._downloadURL)})})},_width:function(){if(this._chart)return this._chart._width();let e=this.options;return e.width-e.margins.left-e.margins.right},_xTicks:function(){return this.__xTicks&&(this.__xTicks=this.options.xTicks),this.__xTicks||Math.round(this._width()/75)},_yTicks:function(){return this.__yTicks&&(this.__yTicks=this.options.yTicks),this.__yTicks||Math.round(this._height()/30)}});F.addInitHook(function(){this.on("waypoint_added",function(i){let s=i.point,r=s._popup;r&&(r.options.className="elevation-popup"),r&&r._content&&(r._content=decodeURI(r._content),s.bindTooltip(r._content,{direction:"auto",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip())}),this.on("eletrack_download",function(i){i.downloadLink=="modal"&&typeof CustomEvent=="function"?document.dispatchEvent(new CustomEvent("eletrack_download",{detail:i})):(i.downloadLink=="link"||i.downloadLink===!0)&&i.confirm()}),this.on("eledata_loaded",function(i){let s=this._map,r=i.layer;if(!s){console.warn("Undefined elevation map object");return}s.once("layeradd",n=>this.options.autofitBounds&&this.fitBounds(r.getBounds())),L.Browser.mobile?this.options.polyline&&r.addTo(s):F._geomutilLazyLoader=ut(this.__LGEOMUTIL,typeof L.GeometryUtil!="function"||!this.options.lazyLoadJS,F._geomutilLazyLoader).then(()=>{this.options.almostOver&&(F._almostoverLazyLoader=ut(this.__LALMOSTOVER,typeof L.Handler.AlmostOver!="function"||!this.options.lazyLoadJS,F._almostoverLazyLoader).then(()=>{s.addHandler("almostOver",L.Handler.AlmostOver),L.GeometryUtil&&s.almostOver&&s.almostOver.enabled()&&(s.almostOver.addLayer(r),s.on("almost:move",n=>this._mousemoveLayerHandler(n)).on("almost:out",n=>this._mouseoutHandler(n)))})),this.options.distanceMarkers?F._distanceMarkersLazyLoader=ut(this.__LDISTANCEM,typeof L.DistanceMarkers!="function"||!this.options.lazyLoadJS,F._distanceMarkersLazyLoader).then(()=>this.options.polyline&&r.addTo(s)):this.options.polyline&&r.addTo(s)})});let e=L.Canvas.prototype._fillStroke,t=this;L.Canvas.include({_fillStroke:function(i,s){if(t._layers.hasLayer(s)){let r=t.options.theme.replace("-theme",""),n=ne[r]||{},o=s.options;if(o.color=n.line||n.area||r,o.stroke=!!o.color,e.call(this,i,s),o.stroke&&o.weight!==0){let a=i.globalCompositeOperation||"source-over";i.globalCompositeOperation="destination-over",i.strokeStyle="#FFF",i.lineWidth=o.weight*1.75,i.stroke(),i.globalCompositeOperation=a}}else e.call(this,i,s)}}),this.on("elechart_init",function(){this.once("elechart_change elechart_hover",function(i){this._chartEnabled&&(this._chart._showDiagramIndicator(i.data,i.xCoord),this._chart._showDiagramIndicator(i.data,i.xCoord)),this._updateMarker(i.data)})})});F.addInitHook(function(){let e=this.options,t={};this.options.imperial?(this._distanceFactor=this.__mileFactor,this._xLabel="mi"):(this._distanceFactor=e.distanceFactor,this._xLabel=e.xLabel),this.on("eledata_updated",function(i){let s=this._data,r=i.index,n=this.track_info,o=n.distance||0,a=s[r].latlng,h=r>0?s[r-1].latlng:a,l=a.distanceTo(h)*this._distanceFactor;o+=Math.round(l/1e3*1e5)/1e5,s[r].dist=o,n.distance=o}),this.on("elechart_axis",function(){this._chart._registerAxisGrid({axis:"x",position:"bottom",scale:this._chart._x})}),this.options.distance!="summary"&&this.on("elechart_axis",function(){t.x=this._chart._x,t.label=this._chart._xLabel,this._chart._registerAxisScale({axis:"x",position:"bottom",scale:t.x,label:t.label,labelY:25,labelX:()=>this._width()+6,name:"distance"})}),this._registerSummary({totlen:{label:"Total Length: ",value:i=>(i.distance||0).toFixed(2)+"&nbsp;"+this._xLabel}})});F.addInitHook(function(){let e=this.options,t={};e.imperial?(this._heightFactor=this.__footFactor,this._yLabel="ft"):(this._heightFactor=e.heightFactor,this._yLabel=e.yLabel),this.on("eledata_updated",function(i){let s=this._data,r=i.index,n=s[r].z*this._heightFactor,o=this.track_info,a=o.elevation_max||-1/0,h=o.elevation_min||1/0;if(!this.options.skipNullZCoords&&r>0){let l=s[r-1].z;if(isNaN(l)){let c=this._lastValidZ,u=n;if(!isNaN(c)&&!isNaN(u)?l=(c+u)/2:isNaN(c)?isNaN(u)||(l=u):l=c,!isNaN(l))return s.splice(r-1,1);s[r-1].z=l}}isNaN(n)||(a=a<n?n:a,h=h>n?n:h,this._lastValidZ=n),s[r].z=n,o.elevation_max=a,o.elevation_min=h}),this.on("elechart_axis",function(){this._chart._registerAxisGrid({axis:"y",position:"left",scale:this._chart._y})}),this.options.altitude!="summary"&&(this.on("elechart_axis",function(){t.y=this._chart._y,t.label=this._yLabel,this._chart._registerAxisScale({axis:"y",position:"left",scale:t.y,label:t.label,labelX:-3,labelY:-8,name:"altitude"})}),this.on("elechart_init",function(){let i=this.options.theme.replace("-theme",""),s=ne[i]||{},r=this.options.detached?s.alpha||"0.8":1,n=this.options.detached?s.stroke:!1;this._chart._registerAreaPath({name:"altitude",label:"Altitude",scaleX:"distance",scaleY:"altitude",color:s.area||i,strokeColor:n||"#000",strokeOpacity:"1",fillOpacity:r,preferCanvas:this.options.preferCanvas})})),this._registerSummary({maxele:{label:"Max Elevation: ",value:i=>(i.elevation_max||0).toFixed(2)+"&nbsp;"+this._yLabel},minele:{label:"Min Elevation: ",value:i=>(i.elevation_min||0).toFixed(2)+"&nbsp;"+this._yLabel}})});F.addInitHook(function(){let e=this.options,t={};t.label=e.timeLabel||"t",this._timeFactor=e.timeFactor,this._timeAVGSpeed=(e.timeAVGSpeed||3.6)*(e.speedFactor||1),e.timeFormat?e.timeFormat=="time"?e.timeFormat=i=>new Date(i).toLocaleTimeString():e.timeFormat=="date"&&(e.timeFormat=i=>new Date(i).toLocaleDateString()):e.timeFormat=i=>new Date(i).toLocaleString().replaceAll("/","-").replaceAll(","," "),e.xTimeFormat=e.xTimeFormat||(i=>Re(i).split("'")[0]),e.time&&e.time!="summary"&&!L.Browser.mobile&&this._registerAxisScale({axis:"x",position:"top",scale:{attr:"duration",min:0},label:t.label,labelY:-10,labelX:()=>this._width(),name:"time",tickFormat:i=>i==0?"":e.xTimeFormat(i),onAxisMount:i=>{i.select(".domain").remove(),i.selectAll("text").attr("opacity",.65).style("font-family","Monospace").style("font-size","110%"),i.selectAll(".tick line").attr("y2",this._height()).attr("stroke-dasharray",2).attr("opacity",.75)}}),this.on("elepoint_added",function(i){let s=this._data,r=i.index;if(!i.point.meta||!i.point.meta.time){i.point.meta=i.point.meta||{};let c=s[r].dist-s[r>0?r-1:r].dist,u=this._timeAVGSpeed;i.point.meta.time=new Date(r>0?s[r-1].time.getTime()+c/u*this._timeFactor*1e3:Date.now())}let n=i.point.meta.time;n.getTime()-n.getTimezoneOffset()*60*1e3==0&&(n=0);let o=n,a=r>0?s[r-1].time:o,h=Math.abs(o-a),l=(this.track_info.time||0)+h;s[r].time=n,s[r].duration=l,this.track_info.time=l}),this.options.time&&(this._registerFocusLabel({name:"time",chart:i=>this.options.timeFormat(i.time)}),this._registerSummary({tottime:{label:"Total Time: ",value:i=>Re(i.time||0)}}))});F.addInitHook(function(){if(!this.options.slope)return;let e=this.options,t={};t.label=e.slopeLabel||"%",this.options.slope!="summary"&&(this._registerAxisScale({axis:"y",position:"right",scale:{min:-1,max:1},tickPadding:16,label:t.label,labelX:25,labelY:-8,name:"slope"}),this._registerAreaPath({name:"slope",label:"Slope",yAttr:"slope",scaleX:"distance",scaleY:"slope",color:"#F00",strokeColor:"#000",strokeOpacity:"0.5",fillOpacity:"0.25"})),this.on("eledata_updated",function(i){let s=this._data,r=i.index,n=s[r].z,o=(s[r].dist-s[r>0?r-1:r].dist)*1e3,a=this.track_info,h=a.ascent||0,l=a.descent||0,c=a.slope_max||0,u=a.slope_min||0,d=0;if(!isNaN(n)){let f=r>0?n-s[r-1].z:0;f>0?h+=f:f<0&&(l-=f),o!==0&&(d=f/o*100)}if(this.options.sDeltaMax){let f=r>0?d-s[r-1].slope:0,p=this.options.sDeltaMax;Math.abs(f)>p&&(d=s[r-1].slope+p*Math.sign(f))}if(this.options.sRange){let f=this.options.sRange;d<f[0]?d=f[0]:d>f[1]&&(d=f[1])}d=L.Util.formatNum(d,2),d>c&&(c=d),d<u&&(u=d),s[r].slope=d,a.ascent=h,a.descent=l,a.slope_max=c,a.slope_min=u}),this._registerFocusLabel({name:"slope",chart:i=>i.slope+t.label,marker:i=>Math.round(i.slope)+t.label}),this._registerSummary({ascent:{label:"Total Ascent: ",value:i=>Math.round(i.ascent||0)+"&nbsp;"+this._yLabel},descent:{label:"Total Descent: ",value:i=>Math.round(i.descent||0)+"&nbsp;"+this._yLabel},minslope:{label:"Min Slope: ",value:i=>Math.round(i.slope_min||0)+"&nbsp;"+t.label},maxslope:{label:"Max Slope: ",value:i=>Math.round(i.slope_max||0)+"&nbsp;"+t.label}})});F.addInitHook(function(){if(!this.options.speed&&!this.options.acceleration)return;let e=this.options,t={};t.label=e.speedLabel||L._(this.options.imperial?"mph":"km/h"),this._speedFactor=e.speedFactor||1,this.options.speed&&this.options.speed!="summary"&&(this._registerAxisScale({axis:"y",position:"right",scale:{min:0,max:1},tickPadding:16,label:t.label,labelX:25,labelY:-8,name:"speed"}),this._registerAreaPath({name:"speed",label:"Speed",yAttr:"speed",scaleX:"distance",scaleY:"speed",color:"#03ffff",strokeColor:"#000",strokeOpacity:"0.5",fillOpacity:"0.25"})),this.on("elepoint_added",function(i){let s=this._data,r=i.index,n=s[r].time,o=r>0?s[r-1].time:n,a=n-o,h=this.track_info,l=h.speed_max||-1/0,c=h.speed_min||1/0,u=h.speed_avg||0,d=0;if(a>0){let f=(s[r].dist-s[r>0?r-1:r].dist)*1e3;d=Math.abs(f/a*this._timeFactor)*this._speedFactor}if(this.options.speedDeltaMax){let f=r>0?d-s[r-1].speed:0,p=this.options.speedDeltaMax;Math.abs(f)>p&&(d=s[r-1].speed+p*Math.sign(f))}if(this.options.speedRange){let f=this.options.speedRange;d<f[0]?d=f[0]:d>f[1]&&(d=f[1])}d=L.Util.formatNum(d,2),l=d>l?d:l,c=d<c?d:c,u=(d+u)/2,s[r].speed=d,h.speed_max=l,h.speed_min=c,h.speed_avg=u}),this.options.speed&&(this._registerFocusLabel({name:"speed",chart:i=>i.speed+" "+t.label,marker:i=>Math.round(i.speed)+" "+t.label}),this._registerSummary({minspeed:{label:"Min Speed: ",value:i=>Math.round(i.speed_min||0)+"&nbsp;"+t.label},maxspeed:{label:"Max Speed: ",value:i=>Math.round(i.speed_max||0)+"&nbsp;"+t.label},avgspeed:{label:"Avg Speed: ",value:i=>Math.round(i.speed_avg||0)+"&nbsp;"+t.label}}))});F.addInitHook(function(){if(!this.options.acceleration)return;let e=this.options,t={};t.label=e.accelerationLabel||L._(this.options.imperial?"ft/s\xB2":"m/s\xB2"),this._accelerationFactor=e.accelerationFactor||1,this.options.acceleration!="summary"&&(this._registerAxisScale({axis:"y",position:"right",scale:{min:0,max:1},tickPadding:16,label:t.label,labelX:25,labelY:-8,name:"acceleration"}),this._registerAreaPath({name:"acceleration",label:"Acceleration",yAttr:"acceleration",scaleX:"distance",scaleY:"acceleration",color:"#050402",strokeColor:"#000",strokeOpacity:"0.5",fillOpacity:"0.25"})),this.on("elepoint_added",function(i){let s=this._data,r=i.index,n=s[r].time,o=r>0?s[r-1].time:n,a=(n-o)/1e3,h=this.track_info,l=h.acceleration_max||-1/0,c=h.acceleration_min||1/0,u=h.acceleration_avg||0,d=0;if(a>0){let f=s[r].speed,p=r>0?s[r-1].speed:f,_=(f-p)*(1e3/this._timeFactor);d=Math.abs(_/a)*this._accelerationFactor}if(this.options.accelerationDeltaMax){let f=r>0?d-s[r-1].acceleration:0,p=this.options.accelerationDeltaMax;Math.abs(f)>p&&(d=s[r-1].acceleration+p*Math.sign(f))}if(this.options.accelerationRange){let f=this.options.accelerationRange;d<f[0]?d=f[0]:d>f[1]&&(d=f[1])}d=L.Util.formatNum(d,2),d>l&&(l=d),d<c&&(c=d),u=(d+u)/2,s[r].acceleration=d,h.acceleration_max=l,h.acceleration_min=c,h.acceleration_avg=u}),this._registerFocusLabel({name:"acceleration",chart:i=>i.acceleration+" "+t.label,marker:i=>Math.round(i.acceleration)+" "+t.label}),this._registerSummary({minacceleration:{label:"Min Acceleration: ",value:i=>Math.round(i.acceleration_min||0)+"&nbsp;"+t.label},maxacceleration:{label:"Max Acceleration: ",value:i=>Math.round(i.acceleration_max||0)+"&nbsp;"+t.label},avgacceleration:{label:"Avg Acceleration: ",value:i=>Math.round(i.acceleration_avg||0)+"&nbsp;"+t.label}})});F.Utils=Wr;F.Components=Yr;F.Chart=hs;L.control.elevation=e=>new F(e);function G(e){return(t,...i)=>sn(e,t,i)}function xt(e,t){return G(rn(e,t).get)}const{apply:sn,construct:fl,defineProperty:pl,get:ml,getOwnPropertyDescriptor:rn,getPrototypeOf:qe,has:gl,ownKeys:_l,set:yl,setPrototypeOf:vl}=Reflect,{iterator:Rt,species:bl,toStringTag:cs,for:xl}=Symbol,nn=Object,{create:us,defineProperty:wl,freeze:Sl,is:Ll}=nn,on=Array,an=on.prototype,ds=an[Rt],ln=G(ds),fs=ArrayBuffer;xt(fs.prototype,"byteLength");const ps=typeof SharedArrayBuffer!="undefined"?SharedArrayBuffer:null;ps&&xt(ps.prototype,"byteLength");const ms=qe(Uint8Array);ms.from;const q=ms.prototype;q[Rt];G(q.keys);G(q.values);G(q.entries);G(q.set);G(q.reverse);G(q.fill);G(q.copyWithin);G(q.sort);G(q.slice);G(q.subarray);xt(q,"buffer");xt(q,"byteOffset");xt(q,"length");xt(q,cs);const wt=Uint32Array,hn=Float32Array,gs=qe([][Rt]()),cn=G(gs.next),un=G(function*(){}().next),dn=qe(gs),fn=DataView.prototype,pn=G(fn.getUint16),_s=WeakMap,mn=_s.prototype,gn=G(mn.get),ys=new fs(4),_n=new hn(ys),yn=new wt(ys),Y=new wt(512),Q=new wt(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(Y[e]=0,Y[e|256]=32768,Q[e]=24,Q[e|256]=24):t<-14?(Y[e]=1024>>-t-14,Y[e|256]=1024>>-t-14|32768,Q[e]=-t-1,Q[e|256]=-t-1):t<=15?(Y[e]=t+15<<10,Y[e|256]=t+15<<10|32768,Q[e]=13,Q[e|256]=13):t<128?(Y[e]=31744,Y[e|256]=64512,Q[e]=24,Q[e|256]=24):(Y[e]=31744,Y[e|256]=64512,Q[e]=13,Q[e|256]=13)}const ae=new wt(2048),ft=new wt(64),le=new wt(64);ae[0]=0;for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;(t&8388608)==0;)i-=8388608,t<<=1;t&=~8388608,i+=947912704,ae[e]=t|i}for(let e=1024;e<2048;++e)ae[e]=939524096+(e-1024<<13);ft[0]=0;for(let e=1;e<31;++e)ft[e]=e<<23;ft[31]=1199570944;ft[32]=2147483648;for(let e=33;e<63;++e)ft[e]=2147483648+(e-32<<23);ft[63]=3347054592;le[0]=0;for(let e=1;e<64;++e)e===32?le[e]=0:le[e]=1024;function vn(e){const t=e>>10;return yn[0]=ae[le[t]+(e&1023)]+ft[t],_n[0]}function bn(e){if(e[Rt]===ds)return e;const t=ln(e);return us(null,{next:{value:function(){return cn(t)}},[Rt]:{value:function(){return this}}})}const xn=new _s;us(dn,{next:{value:function(){const t=gn(xn,this);return un(t)},writable:!0,configurable:!0},[cs]:{value:"Array Iterator",configurable:!0}});function vs(e,t,...i){return vn(pn(e,t,...bn(i)))}function wn(e,t,i){const s=i&&i.debug||!1;s&&console.log("getting "+t+" in "+e);const r=typeof e=="object"?e.outer:e,n=`${t}\\="([^"]*)"`;s&&console.log("pattern:",n);const a=new RegExp(n).exec(r);if(s&&console.log("match:",a),a)return a[1]}var bs=wn;function Sn(e,t,i){const r=new RegExp(t).exec(e.slice(i));return r?i+r.index:-1}var Ln=Sn;const He=Ln;function Tn(e,t,i){const s=i&&i.debug||!1,r=i&&i.startIndex||0;s&&console.log("starting findTagByName with",t," and ",i);const n=He(e,`<${t}[ >]`,r);if(s&&console.log("start:",n),n===-1)return;const o=e.slice(n+t.length);let a=He(o,"[ /]"+t+">",0);const h=a===-1;h&&(a=He(o,"[ /]>",0));const l=n+t.length+a+1+(h?0:t.length)+1;if(s&&console.log("end:",l),l===-1)return;const c=e.slice(n,l);let u;return h?u=null:u=c.slice(c.indexOf(">")+1,c.lastIndexOf("<")),{inner:u,outer:c,start:n,end:l}}var kn=Tn;const Cn=kn;function An(e,t,i){const s=[],r=i&&i.debug||!1;let n=i&&i.startIndex||0,o;for(;o=Cn(e,t,{debug:r,startIndex:n});)n=o.end,s.push(o);return r&&console.log("findTagsByName found",s.length,"tags"),s}var En=An;const Mt={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},tt={};for(const e in Mt)Mt.hasOwnProperty(e)&&(tt[Mt[e]]=parseInt(e,10));const In=[tt.BitsPerSample,tt.ExtraSamples,tt.SampleFormat,tt.StripByteCounts,tt.StripOffsets,tt.StripRowCounts,tt.TileByteCounts,tt.TileOffsets,tt.SubIFDs],Ve={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},C={};for(const e in Ve)Ve.hasOwnProperty(e)&&(C[Ve[e]]=parseInt(e,10));const J={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},On={Unspecified:0,Assocalpha:1,Unassalpha:2},Tl={Version:0,AddCompression:1},kl={None:0,Deflate:1},he={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Pn={};for(const e in he)he.hasOwnProperty(e)&&(Pn[he[e]]=parseInt(e,10));function Dn(e,t){const{width:i,height:s}=e,r=new Uint8Array(i*s*3);let n;for(let o=0,a=0;o<e.length;++o,a+=3)n=256-e[o]/t*256,r[a]=n,r[a+1]=n,r[a+2]=n;return r}function Rn(e,t){const{width:i,height:s}=e,r=new Uint8Array(i*s*3);let n;for(let o=0,a=0;o<e.length;++o,a+=3)n=e[o]/t*256,r[a]=n,r[a+1]=n,r[a+2]=n;return r}function Mn(e,t){const{width:i,height:s}=e,r=new Uint8Array(i*s*3),n=t.length/3,o=t.length/3*2;for(let a=0,h=0;a<e.length;++a,h+=3){const l=e[a];r[h]=t[l]/65536*256,r[h+1]=t[l+n]/65536*256,r[h+2]=t[l+o]/65536*256}return r}function Fn(e){const{width:t,height:i}=e,s=new Uint8Array(t*i*3);for(let r=0,n=0;r<e.length;r+=4,n+=3){const o=e[r],a=e[r+1],h=e[r+2],l=e[r+3];s[n]=255*((255-o)/256)*((255-l)/256),s[n+1]=255*((255-a)/256)*((255-l)/256),s[n+2]=255*((255-h)/256)*((255-l)/256)}return s}function Nn(e){const{width:t,height:i}=e,s=new Uint8ClampedArray(t*i*3);for(let r=0,n=0;r<e.length;r+=3,n+=3){const o=e[r],a=e[r+1],h=e[r+2];s[n]=o+1.402*(h-128),s[n+1]=o-.34414*(a-128)-.71414*(h-128),s[n+2]=o+1.772*(a-128)}return s}const Un=.95047,Bn=1,Gn=1.08883;function zn(e){const{width:t,height:i}=e,s=new Uint8Array(t*i*3);for(let r=0,n=0;r<e.length;r+=3,n+=3){const o=e[r+0],a=e[r+1]<<24>>24,h=e[r+2]<<24>>24;let l=(o+16)/116,c=a/500+l,u=l-h/200,d,f,p;c=Un*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),l=Bn*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),u=Gn*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=c*3.2406+l*-1.5372+u*-.4986,f=c*-.9689+l*1.8758+u*.0415,p=c*.0557+l*-.204+u*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,s[n]=Math.max(0,Math.min(1,d))*255,s[n+1]=Math.max(0,Math.min(1,f))*255,s[n+2]=Math.max(0,Math.min(1,p))*255}return s}const xs=new Map;function pt(e,t){Array.isArray(e)||(e=[e]),e.forEach(i=>xs.set(i,t))}async function jn(e){const t=xs.get(e.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${e.Compression}`);const i=await t();return new i(e)}pt([void 0,1],()=>import("./raw.687e8cce.js").then(e=>e.default));pt(5,()=>import("./lzw.caf16eda.js").then(e=>e.default));pt(6,()=>{throw new Error("old style JPEG compression is not supported.")});pt(7,()=>import("./jpeg.f3e1871d.js").then(e=>e.default));pt([8,32946],()=>import("./deflate.a9d67654.js").then(e=>e.default));pt(32773,()=>import("./packbits.1e87d104.js").then(e=>e.default));pt(34887,()=>import("./lerc.ab458e85.js").then(e=>e.default));function ce(e,t,i,s=1){return new(Object.getPrototypeOf(e)).constructor(t*i*s)}function $n(e,t,i,s,r){const n=t/s,o=i/r;return e.map(a=>{const h=ce(a,s,r);for(let l=0;l<r;++l){const c=Math.min(Math.round(o*l),i-1);for(let u=0;u<s;++u){const d=Math.min(Math.round(n*u),t-1),f=a[c*t+d];h[l*s+u]=f}}return h})}function St(e,t,i){return(1-i)*e+i*t}function qn(e,t,i,s,r){const n=t/s,o=i/r;return e.map(a=>{const h=ce(a,s,r);for(let l=0;l<r;++l){const c=o*l,u=Math.floor(c),d=Math.min(Math.ceil(c),i-1);for(let f=0;f<s;++f){const p=n*f,_=p%1,v=Math.floor(p),k=Math.min(Math.ceil(p),t-1),b=a[u*t+v],w=a[u*t+k],T=a[d*t+v],S=a[d*t+k],R=St(St(b,w,_),St(T,S,_),c%1);h[l*s+f]=R}}return h})}function Hn(e,t,i,s,r,n="nearest"){switch(n.toLowerCase()){case"nearest":return $n(e,t,i,s,r);case"bilinear":case"linear":return qn(e,t,i,s,r);default:throw new Error(`Unsupported resampling method: '${n}'`)}}function Vn(e,t,i,s,r,n){const o=t/s,a=i/r,h=ce(e,s,r,n);for(let l=0;l<r;++l){const c=Math.min(Math.round(a*l),i-1);for(let u=0;u<s;++u){const d=Math.min(Math.round(o*u),t-1);for(let f=0;f<n;++f){const p=e[c*t*n+d*n+f];h[l*s*n+u*n+f]=p}}}return h}function Zn(e,t,i,s,r,n){const o=t/s,a=i/r,h=ce(e,s,r,n);for(let l=0;l<r;++l){const c=a*l,u=Math.floor(c),d=Math.min(Math.ceil(c),i-1);for(let f=0;f<s;++f){const p=o*f,_=p%1,v=Math.floor(p),k=Math.min(Math.ceil(p),t-1);for(let b=0;b<n;++b){const w=e[u*t*n+v*n+b],T=e[u*t*n+k*n+b],S=e[d*t*n+v*n+b],R=e[d*t*n+k*n+b],B=St(St(w,T,_),St(S,R,_),c%1);h[l*s*n+f*n+b]=B}}}return h}function Jn(e,t,i,s,r,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return Vn(e,t,i,s,r,n);case"bilinear":case"linear":return Zn(e,t,i,s,r,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Kn(e,t,i){let s=0;for(let r=t;r<i;++r)s+=e[r];return s}function Ze(e,t,i){switch(e){case 1:if(t<=8)return new Uint8Array(i);if(t<=16)return new Uint16Array(i);if(t<=32)return new Uint32Array(i);break;case 2:if(t===8)return new Int8Array(i);if(t===16)return new Int16Array(i);if(t===32)return new Int32Array(i);break;case 3:switch(t){case 16:case 32:return new Float32Array(i);case 64:return new Float64Array(i)}break}throw Error("Unsupported data format/bitsPerSample")}function Wn(e,t){return(e===1||e===2)&&t<=32&&t%8==0?!1:!(e===3&&(t===16||t===32||t===64))}function Xn(e,t,i,s,r,n,o){const a=new DataView(e),h=i===2?o*n:o*n*s,l=i===2?1:s,c=Ze(t,r,h),u=parseInt("1".repeat(r),2);if(t===1){let d;i===1?d=s*r:d=r;let f=n*d;(f&7)!=0&&(f=f+7&~7);for(let p=0;p<o;++p){const _=p*f;for(let v=0;v<n;++v){const k=_+v*l*r;for(let b=0;b<l;++b){const w=k+b*r,T=(p*n+v)*l+b,S=Math.floor(w/8),R=w%8;if(R+r<=8)c[T]=a.getUint8(S)>>8-r-R&u;else if(R+r<=16)c[T]=a.getUint16(S)>>16-r-R&u;else if(R+r<=24){const B=a.getUint16(S)<<8|a.getUint8(S+2);c[T]=B>>24-r-R&u}else c[T]=a.getUint32(S)>>32-r-R&u}}}}return c.buffer}class Yn{constructor(t,i,s,r,n,o){this.fileDirectory=t,this.geoKeys=i,this.dataView=s,this.littleEndian=r,this.tiles=n?{}:null,this.isTiled=!t.StripOffsets;const a=t.PlanarConfiguration;if(this.planarConfiguration=typeof a=="undefined"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel!="undefined"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip!="undefined"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let i=0;i<this.fileDirectory.BitsPerSample.length;++i)t+=this.getSampleByteSize(i);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const i=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,s=this.fileDirectory.BitsPerSample[t];switch(i){case 1:if(s<=8)return DataView.prototype.getUint8;if(s<=16)return DataView.prototype.getUint16;if(s<=32)return DataView.prototype.getUint32;break;case 2:if(s<=8)return DataView.prototype.getInt8;if(s<=16)return DataView.prototype.getInt16;if(s<=32)return DataView.prototype.getInt32;break;case 3:switch(s){case 16:return function(r,n){return vs(this,r,n)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,i){const s=this.getSampleFormat(t),r=this.getBitsPerSample(t);return Ze(s,r,i)}async getTileOrStrip(t,i,s,r,n){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let h;const{tiles:l}=this;this.planarConfiguration===1?h=i*o+t:this.planarConfiguration===2&&(h=s*o*a+i*o+t);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[h],u=this.fileDirectory.TileByteCounts[h]):(c=this.fileDirectory.StripOffsets[h],u=this.fileDirectory.StripByteCounts[h]);const d=(await this.source.fetch([{offset:c,length:u}],n))[0];let f;return l===null||!l[h]?(f=(async()=>{let p=await r.decode(this.fileDirectory,d);const _=this.getSampleFormat(),v=this.getBitsPerSample();return Wn(_,v)&&(p=Xn(p,_,this.planarConfiguration,this.getSamplesPerPixel(),v,this.getTileWidth(),this.getBlockHeight(i))),p})(),l!==null&&(l[h]=f)):f=l[h],{x:t,y:i,sample:s,data:await f}}async _readRaster(t,i,s,r,n,o,a,h,l){const c=this.getTileWidth(),u=this.getTileHeight(),d=this.getWidth(),f=this.getHeight(),p=Math.max(Math.floor(t[0]/c),0),_=Math.min(Math.ceil(t[2]/c),Math.ceil(d/c)),v=Math.max(Math.floor(t[1]/u),0),k=Math.min(Math.ceil(t[3]/u),Math.ceil(f/u)),b=t[2]-t[0];let w=this.getBytesPerPixel();const T=[],S=[];for(let D=0;D<i.length;++D)this.planarConfiguration===1?T.push(Kn(this.fileDirectory.BitsPerSample,0,i[D])/8):T.push(0),S.push(this.getReaderForSample(i[D]));const R=[],{littleEndian:B}=this;for(let D=v;D<k;++D)for(let V=p;V<_;++V)for(let j=0;j<i.length;++j){const $=j,ge=i[j];this.planarConfiguration===2&&(w=this.getSampleByteSize(j));const _t=this.getTileOrStrip(V,D,ge,n,l);R.push(_t),_t.then(m=>{const y=m.data,A=new DataView(y),N=this.getBlockHeight(m.y),M=m.y*u,I=m.x*c,yt=M+N,at=(m.x+1)*c,Ct=S[$],Fs=Math.min(N,N-(yt-t[3]),f-M),Ns=Math.min(c,c-(at-t[2]),d-I);for(let At=Math.max(0,t[1]-M);At<Fs;++At)for(let Et=Math.max(0,t[0]-I);Et<Ns;++Et){const Us=(At*c+Et)*w,ni=Ct.call(A,Us+T[$],B);let jt;r?(jt=(At+M-t[1])*b*i.length+(Et+I-t[0])*i.length+$,s[jt]=ni):(jt=(At+M-t[1])*b+Et+I-t[0],s[$][jt]=ni)}})}if(await Promise.all(R),o&&t[2]-t[0]!==o||a&&t[3]-t[1]!==a){let D;return r?D=Jn(s,t[2]-t[0],t[3]-t[1],o,a,i.length,h):D=Hn(s,t[2]-t[0],t[3]-t[1],o,a,h),D.width=o,D.height=a,D}return s.width=o||t[2]-t[0],s.height=a||t[3]-t[1],s}async readRasters({window:t,samples:i=[],interleave:s,pool:r=null,width:n,height:o,resampleMethod:a,fillValue:h,signal:l}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],d=c[3]-c[1],f=u*d,p=this.getSamplesPerPixel();if(!i||!i.length)for(let b=0;b<p;++b)i.push(b);else for(let b=0;b<i.length;++b)if(i[b]>=p)return Promise.reject(new RangeError(`Invalid sample index '${i[b]}'.`));let _;if(s){const b=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=Ze(b,w,f*i.length),h&&_.fill(h)}else{_=[];for(let b=0;b<i.length;++b){const w=this.getArrayForSample(i[b],f);Array.isArray(h)&&b<h.length?w.fill(h[b]):h&&!Array.isArray(h)&&w.fill(h),_.push(w)}}const v=r||await jn(this.fileDirectory);return await this._readRaster(c,i,_,s,v,n,o,a,l)}async readRGB({window:t,interleave:i=!0,pool:s=null,width:r,height:n,resampleMethod:o,enableAlpha:a=!1,signal:h}={}){const l=t||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===J.RGB){let k=[0,1,2];if(this.fileDirectory.ExtraSamples!==On.Unspecified&&a){k=[];for(let b=0;b<this.fileDirectory.BitsPerSample.length;b+=1)k.push(b)}return this.readRasters({window:t,interleave:i,samples:k,pool:s,width:r,height:n,resampleMethod:o,signal:h})}let u;switch(c){case J.WhiteIsZero:case J.BlackIsZero:case J.Palette:u=[0];break;case J.CMYK:u=[0,1,2,3];break;case J.YCbCr:case J.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:l,interleave:!0,samples:u,pool:s,width:r,height:n,resampleMethod:o,signal:h},{fileDirectory:f}=this,p=await this.readRasters(d),_=2**this.fileDirectory.BitsPerSample[0];let v;switch(c){case J.WhiteIsZero:v=Dn(p,_);break;case J.BlackIsZero:v=Rn(p,_);break;case J.Palette:v=Mn(p,f.ColorMap);break;case J.CMYK:v=Fn(p);break;case J.YCbCr:v=Nn(p);break;case J.CIELab:v=zn(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!i){const k=new Uint8Array(v.length/3),b=new Uint8Array(v.length/3),w=new Uint8Array(v.length/3);for(let T=0,S=0;T<v.length;T+=3,++S)k[S]=v[T],b[S]=v[T+1],w[S]=v[T+2];v=[k,b,w]}return v.width=p.width,v.height=p.height,v}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let i=0;i<this.fileDirectory.ModelTiepoint.length;i+=6)t.push({i:this.fileDirectory.ModelTiepoint[i],j:this.fileDirectory.ModelTiepoint[i+1],k:this.fileDirectory.ModelTiepoint[i+2],x:this.fileDirectory.ModelTiepoint[i+3],y:this.fileDirectory.ModelTiepoint[i+4],z:this.fileDirectory.ModelTiepoint[i+5]});return t}getGDALMetadata(t=null){const i={};if(!this.fileDirectory.GDAL_METADATA)return null;const s=this.fileDirectory.GDAL_METADATA;let r=En(s,"Item");t!==null&&(r=r.filter(n=>Number(bs(n,"sample"))===t));for(let n=0;n<r.length;++n){const o=r[n];i[bs(o,"name")]=o.inner}return i}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,i=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(i)return[i[3],i[7],i[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const i=this.fileDirectory.ModelPixelScale,s=this.fileDirectory.ModelTransformation;if(i)return[i[0],-i[1],i[2]];if(s)return[s[0],s[5],s[10]];if(t){const[r,n,o]=t.getResolution();return[r*t.getWidth()/this.getWidth(),n*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const t=this.getOrigin(),i=this.getResolution(),s=t[0],r=t[1],n=s+i[0]*this.getWidth(),o=r+i[1]*this.getHeight();return[Math.min(s,n),Math.min(r,o),Math.max(s,n),Math.max(r,o)]}}var Qn=Yn;class to{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,i){const s=this.getUint32(t,i),r=this.getUint32(t+4,i);let n;if(i){if(n=s+2**32*r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*s+r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(t,i){let s=0;const r=(this._dataView.getUint8(t+(i?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(t+(i?o:7-o));r&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),s+=a*256**o}return r&&(s=-s),s}getUint8(t,i){return this._dataView.getUint8(t,i)}getInt8(t,i){return this._dataView.getInt8(t,i)}getUint16(t,i){return this._dataView.getUint16(t,i)}getInt16(t,i){return this._dataView.getInt16(t,i)}getUint32(t,i){return this._dataView.getUint32(t,i)}getInt32(t,i){return this._dataView.getInt32(t,i)}getFloat16(t,i){return vs(this._dataView,t,i)}getFloat32(t,i){return this._dataView.getFloat32(t,i)}getFloat64(t,i){return this._dataView.getFloat64(t,i)}}class eo{constructor(t,i,s,r){this._dataView=new DataView(t),this._sliceOffset=i,this._littleEndian=s,this._bigTiff=r}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,i){return this.sliceOffset<=t&&this.sliceTop>=t+i}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const i=this.readUint32(t),s=this.readUint32(t+4);let r;if(this._littleEndian){if(r=i+2**32*s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*i+s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}readInt64(t){let i=0;const s=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let r=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(t+(this._littleEndian?n:7-n));s&&(r?o!==0&&(o=~(o-1)&255,r=!1):o=~o&255),i+=o*256**n}return s&&(i=-i),i}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}class io{async fetch(t,i=void 0){return Promise.all(t.map(s=>this.fetchSlice(s,i)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Je extends Error{constructor(t){super(t);Error.captureStackTrace&&Error.captureStackTrace(this,Je),this.name="AbortError"}}class so extends io{constructor(t){super();this.arrayBuffer=t}fetchSlice(t,i){if(i&&i.aborted)throw new Je("Request aborted");return this.arrayBuffer.slice(t.offset,t.offset+t.length)}}function ro(e){return new so(e)}function Ke(e){switch(e){case C.BYTE:case C.ASCII:case C.SBYTE:case C.UNDEFINED:return 1;case C.SHORT:case C.SSHORT:return 2;case C.LONG:case C.SLONG:case C.FLOAT:case C.IFD:return 4;case C.RATIONAL:case C.SRATIONAL:case C.DOUBLE:case C.LONG8:case C.SLONG8:case C.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function no(e){const t=e.GeoKeyDirectory;if(!t)return null;const i={};for(let s=4;s<=t[3]*4;s+=4){const r=he[t[s]],n=t[s+1]?Mt[t[s+1]]:null,o=t[s+2],a=t[s+3];let h=null;if(!n)h=a;else{if(h=e[n],typeof h=="undefined"||h===null)throw new Error(`Could not get value of geoKey '${r}'.`);typeof h=="string"?h=h.substring(a,a+o-1):h.subarray&&(h=h.subarray(a,a+o),o===1&&(h=h[0]))}i[r]=h}return i}function Lt(e,t,i,s){let r=null,n=null;const o=Ke(t);switch(t){case C.BYTE:case C.ASCII:case C.UNDEFINED:r=new Uint8Array(i),n=e.readUint8;break;case C.SBYTE:r=new Int8Array(i),n=e.readInt8;break;case C.SHORT:r=new Uint16Array(i),n=e.readUint16;break;case C.SSHORT:r=new Int16Array(i),n=e.readInt16;break;case C.LONG:case C.IFD:r=new Uint32Array(i),n=e.readUint32;break;case C.SLONG:r=new Int32Array(i),n=e.readInt32;break;case C.LONG8:case C.IFD8:r=new Array(i),n=e.readUint64;break;case C.SLONG8:r=new Array(i),n=e.readInt64;break;case C.RATIONAL:r=new Uint32Array(i*2),n=e.readUint32;break;case C.SRATIONAL:r=new Int32Array(i*2),n=e.readInt32;break;case C.FLOAT:r=new Float32Array(i),n=e.readFloat32;break;case C.DOUBLE:r=new Float64Array(i),n=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===C.RATIONAL||t===C.SRATIONAL)for(let a=0;a<i;a+=2)r[a]=n.call(e,s+a*o),r[a+1]=n.call(e,s+(a*o+4));else for(let a=0;a<i;++a)r[a]=n.call(e,s+a*o);return t===C.ASCII?new TextDecoder("utf-8").decode(r):r}class oo{constructor(t,i,s){this.fileDirectory=t,this.geoKeyDirectory=i,this.nextIFDByteOffset=s}}class ue extends Error{constructor(t){super(`No image at index ${t}`);this.index=t}}class ao{async readRasters(t={}){const{window:i,width:s,height:r}=t;let{resX:n,resY:o,bbox:a}=t;const h=await this.getImage();let l=h;const c=await this.getImageCount(),u=h.getBoundingBox();if(i&&a)throw new Error('Both "bbox" and "window" passed.');if(s||r){if(i){const[p,_]=h.getOrigin(),[v,k]=h.getResolution();a=[p+i[0]*v,_+i[1]*k,p+i[2]*v,_+i[3]*k]}const f=a||u;if(s){if(n)throw new Error("Both width and resX passed");n=(f[2]-f[0])/s}if(r){if(o)throw new Error("Both width and resY passed");o=(f[3]-f[1])/r}}if(n||o){const f=[];for(let p=0;p<c;++p){const _=await this.getImage(p),{SubfileType:v,NewSubfileType:k}=_.fileDirectory;(p===0||v===2||k&1)&&f.push(_)}f.sort((p,_)=>p.getWidth()-_.getWidth());for(let p=0;p<f.length;++p){const _=f[p],v=(u[2]-u[0])/_.getWidth(),k=(u[3]-u[1])/_.getHeight();if(l=_,n&&n>v||o&&o>k)break}}let d=i;if(a){const[f,p]=h.getOrigin(),[_,v]=l.getResolution(h);d=[Math.round((a[0]-f)/_),Math.round((a[1]-p)/v),Math.round((a[2]-f)/_),Math.round((a[3]-p)/v)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return l.readRasters(hi(li({},t),{window:d}))}}class We extends ao{constructor(t,i,s,r,n={}){super();this.source=t,this.littleEndian=i,this.bigTiff=s,this.firstIFDOffset=r,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,i){const s=this.bigTiff?4048:1024;return new eo((await this.source.fetch([{offset:t,length:typeof i!="undefined"?i:s}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const i=this.bigTiff?20:12,s=this.bigTiff?8:2;let r=await this.getSlice(t);const n=this.bigTiff?r.readUint64(t):r.readUint16(t),o=n*i+(this.bigTiff?16:6);r.covers(t,o)||(r=await this.getSlice(t,o));const a={};let h=t+(this.bigTiff?8:2);for(let u=0;u<n;h+=i,++u){const d=r.readUint16(h),f=r.readUint16(h+2),p=this.bigTiff?r.readUint64(h+4):r.readUint32(h+4);let _,v;const k=Ke(f),b=h+(this.bigTiff?12:8);if(k*p<=(this.bigTiff?8:4))_=Lt(r,f,p,b);else{const w=r.readOffset(b),T=Ke(f)*p;if(r.covers(w,T))_=Lt(r,f,p,w);else{const S=await this.getSlice(w,T);_=Lt(S,f,p,w)}}p===1&&In.indexOf(d)===-1&&!(f===C.RATIONAL||f===C.SRATIONAL)?v=_[0]:v=_,a[Mt[d]]=v}const l=no(a),c=r.readOffset(t+s+i*n);return new oo(a,l,c)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(i){throw i instanceof ue?new ue(t):i}return this.ifdRequests[t]=(async()=>{const i=await this.ifdRequests[t-1];if(i.nextIFDByteOffset===0)throw new ue(t);return this.parseFileDirectoryAt(i.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const i=await this.requestIFD(t);return new Qn(i.fileDirectory,i.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,i=!0;for(;i;)try{await this.requestIFD(t),++t}catch(s){if(s instanceof ue)i=!1;else throw s}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const i="GDAL_STRUCTURAL_METADATA_SIZE=",s=i.length+100;let r=await this.getSlice(t,s);if(i===Lt(r,C.ASCII,i.length,t)){const o=Lt(r,C.ASCII,s,t).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>s&&(r=await this.getSlice(t,a));const h=Lt(r,C.ASCII,a,t);this.ghostValues={},h.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,c])=>{this.ghostValues[l]=c})}return this.ghostValues}static async fromSource(t,i,s){const r=(await t.fetch([{offset:0,length:1024}],s))[0],n=new to(r),o=n.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const h=n.getUint16(2,a);let l;if(h===42)l=!1;else if(h===43){if(l=!0,n.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=l?n.getUint64(8,a):n.getUint32(4,a);return new We(t,a,l,c,i)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function lo(e,t){return We.fromSource(ro(e),t)}function ho(e,t){const i=Hs(e,t);return qs(ci(i))}function co(e){const[t]=e.getTiePoints(),i=e.getFileDirectory().ModelPixelScale;return[t.x,i[0],0,t.y,0,-1*i[1]]}function uo(e){const t="https://openwms.statkart.no/skwms1/wcs.dtm?&SERVICE=WCS&REQUEST=GetCoverage&VERSION=1.0.0&COVERAGE=land_utm33_10m&FORMAT=GEOTIFF&COLORSCALE=false&CRS=EPSG:4326&WIDTH=700&HEIGHT=700",s=Zs(e).join(",");return`${t}&BBOX=${s}`}async function fo(e){const i=await(await fetch(e)).arrayBuffer();return(await lo(i)).getImage()}async function po(e){const t=await e.readRasters(),i=[];for(let s=0;s<e.getHeight();s++){i[s]=[];for(let r=0;r<e.getWidth();r++)i[s][r]=t[0][r+s*e.getWidth()]}return i}async function mo(e){const t=await fo(uo(e)),i=await po(t),s=co(t);function r(n,o){let a=Math.round((n-s[0])/s[1]),h=Math.round((o-s[3])/s[5]);return a===t.getWidth()&&(a-=1),h===t.getHeight()&&(h-=1),i[h][a]}return{altitudeAtCoord:r}}async function go(e){const t=await mo(e),i=JSON.parse(JSON.stringify(e));return Vs(i,s=>{const r=t.altitudeAtCoord(s[0],s[1]);s[2]=r}),i}async function _o(e){const t=e.toGeoJSON(),i=ho(t,.05),s=await go(i);return x.geoJSON(s)}function yo(e,t){let i=0,s=0,r=e.shift();for(const n of e){const o=n-r;o>t&&(i+=o,r=n),o<-t&&(s+=o,r=n)}return{elevationGain:Math.round(i),elevationLoss:Math.round(-s)}}function vo(e){const t=10,i=ci(e).map(s=>s[2]);return yo(i,t)}const ws={className:"route"},bo={tooltips:!1,allowSelfIntersection:!0,markerStyle:{draggable:!1},finishOn:null,templineStyle:{className:"route is-drawing"},hintlineStyle:{className:"route is-drawing"},pathOptions:ws},xo={theme:"kartorama-theme",detached:!1,autohide:!0,collapsed:!1,position:"topright",followMarker:!1,imperial:!1,reverseCoords:!1,summary:!1,legend:!1,ruler:!1,width:400,height:150,responsive:!0},wo={position:"bottomleft",drawCircle:!1,drawMarker:!1,drawCircleMarker:!1,drawRectangle:!1,drawPolygon:!1,dragMode:!1,cutPolygon:!1,rotateMode:!1,removalMode:!1,editMode:!1,drawPolyline:!0};function So(e,t){const i=document.createElement("p");return i.innerHTML=`Distanse: ${e.distance} km. Opp: ${e.elevationGain} m. Ned: ${e.elevationLoss} m. `,i}function Lo(e){const t=e.toGeoJSON(),i=ui(t).toFixed(1),{elevationGain:s,elevationLoss:r}=vo(t),n=So({elevationGain:s,elevationLoss:r,distance:i});e.bindPopup(n).openPopup()}function Ss(e){return e.controlElevationProfile._layers._layers}function To(e){const t=Ss(e);Object.keys(t).length>0&&Object.values(t)[0].remove()}function ko(e){e.controlElevationProfile._container.style.display="none"}function Co(e){let t=[];return e.routeLayers.eachLayer(i=>{const s=i.toGeoJSON();t=[...t,...s.features]}),t}function Xe(e){function t(l){l.controlElevationProfile._container.style.display="block",l.controlElevationProfile.addTo(e)}function i(l){const c=Ss(l);Object.keys(c).length>0&&Object.values(c)[0].addTo(e)}function s(l){ko(l),To(l),e.state.activeRouteLayer=void 0}function r(l){e.state.activeRouteLayer&&s(e.state.activeRouteLayer),i(l),t(l),e.state.activeRouteLayer=l}function n(l){const c=l.toGeoJSON();l.controlElevationProfile=x.control.elevation(xo),l.controlElevationProfile.addTo(e).loadData(c),Lo(l),e.fitBounds(l.getBounds()),l.setStyle(ws),e.addLayer(l),e.routeLayers.addLayer(l),r(l),l.on("click",u=>{r(u.target)})}function o(l,c){const u=1e3;return e.distance(l,c)/u}function a(){e.on("pm:drawstart",({workingLayer:l})=>{let c=0;const u=x.tooltip();l.bindTooltip(u),l.on("pm:vertexadded",d=>{const f=d.latlng,p=l.toGeoJSON();c=ui(p),l.setTooltipContent(`${c.toFixed(1)} km`),l.openTooltip(d.latlng),e.on("mousemove",_=>{const v=_.latlng,k=o(f,v)+c;l.setTooltipContent(`${k.toFixed(1)} km`),l.openTooltip(_.latlng)})})})}async function h(l){const c=await _o(l);e.removeLayer(l),n(c)}return{init(){e.on("click",()=>{e.state.activeRouteLayer&&s(e.state.activeRouteLayer)}),e.routeLayers=x.layerGroup(),e.pm.setGlobalOptions(bo),e.pm.setLang("no"),e.pm.addControls(wo),e.on("pm:create",l=>{console.log(JSON.stringify(l.layer.toGeoJSON())),h(l.layer)}),a()},addElevationAndReplace:h}}const Ao=[62.21344732933401,6.566903178568401],Eo=10;function Io(){const e=x.map("map",{zoomControl:!1,pmIgnore:!1});x.PM.setOptIn(!0),e.state={};const t=window.localStorage.getItem("currentCenter")?JSON.parse(window.localStorage.getItem("currentCenter")):Ao,i=window.localStorage.getItem("currentZoom")||Eo;return e.setView(t,i),e}function Oo(e){function t(){localStorage.setItem("currentZoom",e.getZoom())}x.control.zoom({position:"bottomleft"}).addTo(e),e.on("zoomend",t)}function Po(e){x.control.scale({imperial:!1,maxWidth:200}).addTo(e)}function Ls(e){const t=window.localStorage.getItem("activeBaseLayerName")||"Vektorkart";e.addLayer(Pe[t]);const i=window.localStorage.getItem("activeOverlayName")||"Helning";e.addLayer(Gi[i]),e.state.overlay=Gi[i]}function Do(e){Ls(e),x.control.groupedLayers(Pe,zi,{exclusiveGroups:["Tillegg"],position:"bottomright",collapsed:!0}).addTo(e);function t(s){localStorage.setItem("activeBaseLayerName",s.name)}function i(s){localStorage.setItem("activeOverlayName",s.name)}e.on("baselayerchange",t),e.on("overlayadd",i)}function Ro(e){x.control.locate({position:"bottomleft",initialZoomLevel:15,icon:"fa fa-map-marker-alt"}).addTo(e);function t(){localStorage.setItem("currentCenter",JSON.stringify(e.getCenter()))}e.on("moveend",t)}function Mo(e){x.Control.FileLayerLoad.LABEL="<span class='fa fa-file-upload'></span>";const t=x.Control.fileLayerLoad({layer:x.geoJson,layerOptions:{style:{className:"route"}},position:"topleft",fileSizeLimit:4e3});t.addTo(e),t.loader.on("data:error",i=>{alert("Feil! Sjekk konsollen"),console.log(i)}),t.loader.on("data:loaded",i=>{new Xe(e).addElevationAndReplace(i.layer)})}function Fo(e){e.state.overlay||Ls(e);const t=window.localStorage.getItem("currentOpacity")||0;e.state.overlay.setOpacity(t);const i=x.control.slider(r=>{e.state.overlay.setOpacity(r)},{min:0,max:1,step:.01,position:"bottomright",collapsed:!1,syncSlider:!0,title:"Gjennomsiktighet",showValue:!1,value:e.state.overlay.options.opacity});i.addTo(e),i.slider.addEventListener("click",()=>{localStorage.setItem("currentOpacity",i.slider.valueAsNumber)});function s(r){if(e.state.overlay=r.layer,i.slider.valueAsNumber===0){const n=.2;e.state.overlay.setOpacity(n),i.slider.value=n}else e.state.overlay.setOpacity(i.slider.value)}e.on("overlayadd",s)}const No="1.27.0",Ts={"X-Client-Info":`supabase-js/${No}`};function Uo(e){return e.replace(/\/$/,"")}var Ye={exports:{}};(function(e,t){var i=typeof self!="undefined"?self:Ks,s=function(){function n(){this.fetch=!1,this.DOMException=i.DOMException}return n.prototype=i,new n}();(function(n){(function(o){var a={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function h(m){return m&&DataView.prototype.isPrototypeOf(m)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(m){return m&&l.indexOf(Object.prototype.toString.call(m))>-1};function u(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(m))throw new TypeError("Invalid character in header field name");return m.toLowerCase()}function d(m){return typeof m!="string"&&(m=String(m)),m}function f(m){var y={next:function(){var A=m.shift();return{done:A===void 0,value:A}}};return a.iterable&&(y[Symbol.iterator]=function(){return y}),y}function p(m){this.map={},m instanceof p?m.forEach(function(y,A){this.append(A,y)},this):Array.isArray(m)?m.forEach(function(y){this.append(y[0],y[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(y){this.append(y,m[y])},this)}p.prototype.append=function(m,y){m=u(m),y=d(y);var A=this.map[m];this.map[m]=A?A+", "+y:y},p.prototype.delete=function(m){delete this.map[u(m)]},p.prototype.get=function(m){return m=u(m),this.has(m)?this.map[m]:null},p.prototype.has=function(m){return this.map.hasOwnProperty(u(m))},p.prototype.set=function(m,y){this.map[u(m)]=d(y)},p.prototype.forEach=function(m,y){for(var A in this.map)this.map.hasOwnProperty(A)&&m.call(y,this.map[A],A,this)},p.prototype.keys=function(){var m=[];return this.forEach(function(y,A){m.push(A)}),f(m)},p.prototype.values=function(){var m=[];return this.forEach(function(y){m.push(y)}),f(m)},p.prototype.entries=function(){var m=[];return this.forEach(function(y,A){m.push([A,y])}),f(m)},a.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function _(m){if(m.bodyUsed)return Promise.reject(new TypeError("Already read"));m.bodyUsed=!0}function v(m){return new Promise(function(y,A){m.onload=function(){y(m.result)},m.onerror=function(){A(m.error)}})}function k(m){var y=new FileReader,A=v(y);return y.readAsArrayBuffer(m),A}function b(m){var y=new FileReader,A=v(y);return y.readAsText(m),A}function w(m){for(var y=new Uint8Array(m),A=new Array(y.length),N=0;N<y.length;N++)A[N]=String.fromCharCode(y[N]);return A.join("")}function T(m){if(m.slice)return m.slice(0);var y=new Uint8Array(m.byteLength);return y.set(new Uint8Array(m)),y.buffer}function S(){return this.bodyUsed=!1,this._initBody=function(m){this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:a.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:a.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():a.arrayBuffer&&a.blob&&h(m)?(this._bodyArrayBuffer=T(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||c(m))?this._bodyArrayBuffer=T(m):this._bodyText=m=Object.prototype.toString.call(m):this._bodyText="",this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var m=_(this);if(m)return m;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(k)}),this.text=function(){var m=_(this);if(m)return m;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(w(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(V)}),this.json=function(){return this.text().then(JSON.parse)},this}var R=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function B(m){var y=m.toUpperCase();return R.indexOf(y)>-1?y:m}function D(m,y){y=y||{};var A=y.body;if(m instanceof D){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,y.headers||(this.headers=new p(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!A&&m._bodyInit!=null&&(A=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=y.credentials||this.credentials||"same-origin",(y.headers||!this.headers)&&(this.headers=new p(y.headers)),this.method=B(y.method||this.method||"GET"),this.mode=y.mode||this.mode||null,this.signal=y.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&A)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(A)}D.prototype.clone=function(){return new D(this,{body:this._bodyInit})};function V(m){var y=new FormData;return m.trim().split("&").forEach(function(A){if(A){var N=A.split("="),M=N.shift().replace(/\+/g," "),I=N.join("=").replace(/\+/g," ");y.append(decodeURIComponent(M),decodeURIComponent(I))}}),y}function j(m){var y=new p,A=m.replace(/\r?\n[\t ]+/g," ");return A.split(/\r?\n/).forEach(function(N){var M=N.split(":"),I=M.shift().trim();if(I){var yt=M.join(":").trim();y.append(I,yt)}}),y}S.call(D.prototype);function $(m,y){y||(y={}),this.type="default",this.status=y.status===void 0?200:y.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in y?y.statusText:"OK",this.headers=new p(y.headers),this.url=y.url||"",this._initBody(m)}S.call($.prototype),$.prototype.clone=function(){return new $(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},$.error=function(){var m=new $(null,{status:0,statusText:""});return m.type="error",m};var ge=[301,302,303,307,308];$.redirect=function(m,y){if(ge.indexOf(y)===-1)throw new RangeError("Invalid status code");return new $(null,{status:y,headers:{location:m}})},o.DOMException=n.DOMException;try{new o.DOMException}catch{o.DOMException=function(y,A){this.message=y,this.name=A;var N=Error(y);this.stack=N.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function _t(m,y){return new Promise(function(A,N){var M=new D(m,y);if(M.signal&&M.signal.aborted)return N(new o.DOMException("Aborted","AbortError"));var I=new XMLHttpRequest;function yt(){I.abort()}I.onload=function(){var at={status:I.status,statusText:I.statusText,headers:j(I.getAllResponseHeaders()||"")};at.url="responseURL"in I?I.responseURL:at.headers.get("X-Request-URL");var Ct="response"in I?I.response:I.responseText;A(new $(Ct,at))},I.onerror=function(){N(new TypeError("Network request failed"))},I.ontimeout=function(){N(new TypeError("Network request failed"))},I.onabort=function(){N(new o.DOMException("Aborted","AbortError"))},I.open(M.method,M.url,!0),M.credentials==="include"?I.withCredentials=!0:M.credentials==="omit"&&(I.withCredentials=!1),"responseType"in I&&a.blob&&(I.responseType="blob"),M.headers.forEach(function(at,Ct){I.setRequestHeader(Ct,at)}),M.signal&&(M.signal.addEventListener("abort",yt),I.onreadystatechange=function(){I.readyState===4&&M.signal.removeEventListener("abort",yt)}),I.send(typeof M._bodyInit=="undefined"?null:M._bodyInit)})}return _t.polyfill=!0,n.fetch||(n.fetch=_t,n.Headers=p,n.Request=D,n.Response=$),o.Headers=p,o.Request=D,o.Response=$,o.fetch=_t,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var r=s;t=r.fetch,t.default=r.fetch,t.fetch=r.fetch,t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response,e.exports=t})(Ye,Ye.exports);var de=Js(Ye.exports),Ft=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};const Bo=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Go=(e,t)=>{if(typeof e.json!="function")return t(e);e.json().then(i=>t({message:Bo(i),status:(e==null?void 0:e.status)||500}))},zo=(e,t,i)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||(s.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(i)),s};function fe(e=de,t,i,s,r){return Ft(this,void 0,void 0,function*(){return new Promise((n,o)=>{e(i,zo(t,s,r)).then(a=>{if(!a.ok)throw a;return(s==null?void 0:s.noResolveJson)?n:a.json()}).then(a=>n(a)).catch(a=>Go(a,o))})})}function jo(e,t,i){return Ft(this,void 0,void 0,function*(){return fe(e,"GET",t,i)})}function W(e,t,i,s){return Ft(this,void 0,void 0,function*(){return fe(e,"POST",t,s,i)})}function $o(e,t,i,s){return Ft(this,void 0,void 0,function*(){return fe(e,"PUT",t,s,i)})}function qo(e,t,i,s){return Ft(this,void 0,void 0,function*(){return fe(e,"DELETE",t,s,i)})}const Ho="1.20.0",Vo="http://localhost:9999",Zo={"X-Client-Info":`gotrue-js/${Ho}`},pe="supabase.auth.token",Jo={name:"sb:token",lifetime:60*60*8,domain:"",path:"/",sameSite:"lax"};function Ko(e,t,i){const s=i||{},r=encodeURIComponent,n=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if(typeof r!="function")throw new TypeError("option encode is invalid");if(!n.test(e))throw new TypeError("argument name is invalid");const o=r(t);if(o&&!n.test(o))throw new TypeError("argument val is invalid");let a=e+"="+o;if(s.maxAge!=null){const h=s.maxAge-0;if(isNaN(h)||!isFinite(h))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(h)}if(s.domain){if(!n.test(s.domain))throw new TypeError("option domain is invalid");a+="; Domain="+s.domain}if(s.path){if(!n.test(s.path))throw new TypeError("option path is invalid");a+="; Path="+s.path}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(a+="; HttpOnly"),s.secure&&(a+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function Wo(e){if(!e||!e.headers||!e.headers.host)throw new Error('The "host" request header is not available');const t=e.headers.host.indexOf(":")>-1&&e.headers.host.split(":")[0]||e.headers.host;return!(["localhost","127.0.0.1"].indexOf(t)>-1||t.endsWith(".local"))}function Xo(e,t){var i,s,r;return Ko(e.name,e.value,{maxAge:e.maxAge,expires:new Date(Date.now()+e.maxAge*1e3),httpOnly:!0,secure:t,path:(i=e.path)!==null&&i!==void 0?i:"/",domain:(s=e.domain)!==null&&s!==void 0?s:"",sameSite:(r=e.sameSite)!==null&&r!==void 0?r:"lax"})}function Yo(e,t,i){const s=i.map(n=>Xo(n,Wo(e))),r=t.getHeader("Set-Cookie");r&&(r instanceof Array?Array.prototype.push.apply(s,r):typeof r=="string"&&s.push(r)),t.setHeader("Set-Cookie",s)}function ks(e,t,i){Yo(e,t,[i])}function Qo(e,t,i){ks(e,t,{name:i,value:"",maxAge:-1})}function Nt(e){return Math.round(Date.now()/1e3)+e}function ta(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const mt=()=>typeof window!="undefined";function nt(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const i=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)"),s=i.exec(t);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}var z=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};class ea{constructor({url:t="",headers:i={},cookieOptions:s,fetch:r}){this.url=t,this.headers=i,this.cookieOptions=Object.assign(Object.assign({},Jo),s),this.fetch=r}signUpWithEmail(t,i,s={}){return z(this,void 0,void 0,function*(){try{const r=Object.assign({},this.headers);let n="";s.redirectTo&&(n="?redirect_to="+encodeURIComponent(s.redirectTo));const o=yield W(this.fetch,`${this.url}/signup${n}`,{email:t,password:i,data:s.data},{headers:r}),a=Object.assign({},o);return a.expires_in&&(a.expires_at=Nt(o.expires_in)),{data:a,error:null}}catch(r){return{data:null,error:r}}})}signInWithEmail(t,i,s={}){return z(this,void 0,void 0,function*(){try{const r=Object.assign({},this.headers);let n="?grant_type=password";s.redirectTo&&(n+="&redirect_to="+encodeURIComponent(s.redirectTo));const o=yield W(this.fetch,`${this.url}/token${n}`,{email:t,password:i},{headers:r}),a=Object.assign({},o);return a.expires_in&&(a.expires_at=Nt(o.expires_in)),{data:a,error:null}}catch(r){return{data:null,error:r}}})}signUpWithPhone(t,i,s={}){return z(this,void 0,void 0,function*(){try{const r=Object.assign({},this.headers),n=yield W(this.fetch,`${this.url}/signup`,{phone:t,password:i,data:s.data},{headers:r}),o=Object.assign({},n);return o.expires_in&&(o.expires_at=Nt(n.expires_in)),{data:o,error:null}}catch(r){return{data:null,error:r}}})}signInWithPhone(t,i){return z(this,void 0,void 0,function*(){try{const s=Object.assign({},this.headers),r="?grant_type=password",n=yield W(this.fetch,`${this.url}/token${r}`,{phone:t,password:i},{headers:s}),o=Object.assign({},n);return o.expires_in&&(o.expires_at=Nt(n.expires_in)),{data:o,error:null}}catch(s){return{data:null,error:s}}})}sendMagicLinkEmail(t,i={}){return z(this,void 0,void 0,function*(){try{const s=Object.assign({},this.headers);let r="";return i.redirectTo&&(r+="?redirect_to="+encodeURIComponent(i.redirectTo)),{data:yield W(this.fetch,`${this.url}/magiclink${r}`,{email:t},{headers:s}),error:null}}catch(s){return{data:null,error:s}}})}sendMobileOTP(t){return z(this,void 0,void 0,function*(){try{const i=Object.assign({},this.headers);return{data:yield W(this.fetch,`${this.url}/otp`,{phone:t},{headers:i}),error:null}}catch(i){return{data:null,error:i}}})}verifyMobileOTP(t,i,s={}){return z(this,void 0,void 0,function*(){try{const r=Object.assign({},this.headers);return{data:yield W(this.fetch,`${this.url}/verify`,{phone:t,token:i,type:"sms",redirect_to:s.redirectTo},{headers:r}),error:null}}catch(r){return{data:null,error:r}}})}inviteUserByEmail(t,i={}){return z(this,void 0,void 0,function*(){try{const s=Object.assign({},this.headers);let r="";return i.redirectTo&&(r+="?redirect_to="+encodeURIComponent(i.redirectTo)),{data:yield W(this.fetch,`${this.url}/invite${r}`,{email:t,data:i.data},{headers:s}),error:null}}catch(s){return{data:null,error:s}}})}resetPasswordForEmail(t,i={}){return z(this,void 0,void 0,function*(){try{const s=Object.assign({},this.headers);let r="";return i.redirectTo&&(r+="?redirect_to="+encodeURIComponent(i.redirectTo)),{data:yield W(this.fetch,`${this.url}/recover${r}`,{email:t},{headers:s}),error:null}}catch(s){return{data:null,error:s}}})}_createRequestHeaders(t){const i=Object.assign({},this.headers);return i.Authorization=`Bearer ${t}`,i}signOut(t){return z(this,void 0,void 0,function*(){try{return yield W(this.fetch,`${this.url}/logout`,{},{headers:this._createRequestHeaders(t),noResolveJson:!0}),{error:null}}catch(i){return{error:i}}})}getUrlForProvider(t,i){const s=[`provider=${encodeURIComponent(t)}`];return(i==null?void 0:i.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),(i==null?void 0:i.scopes)&&s.push(`scopes=${encodeURIComponent(i.scopes)}`),`${this.url}/authorize?${s.join("&")}`}getUser(t){return z(this,void 0,void 0,function*(){try{const i=yield jo(this.fetch,`${this.url}/user`,{headers:this._createRequestHeaders(t)});return{user:i,data:i,error:null}}catch(i){return{user:null,data:null,error:i}}})}updateUser(t,i){return z(this,void 0,void 0,function*(){try{const s=yield $o(this.fetch,`${this.url}/user`,i,{headers:this._createRequestHeaders(t)});return{user:s,data:s,error:null}}catch(s){return{user:null,data:null,error:s}}})}deleteUser(t,i){return z(this,void 0,void 0,function*(){try{const s=yield qo(this.fetch,`${this.url}/admin/users/${t}`,{},{headers:this._createRequestHeaders(i)});return{user:s,data:s,error:null}}catch(s){return{user:null,data:null,error:s}}})}refreshAccessToken(t){return z(this,void 0,void 0,function*(){try{const i=yield W(this.fetch,`${this.url}/token?grant_type=refresh_token`,{refresh_token:t},{headers:this.headers}),s=Object.assign({},i);return s.expires_in&&(s.expires_at=Nt(i.expires_in)),{data:s,error:null}}catch(i){return{data:null,error:i}}})}setAuthCookie(t,i){t.method!=="POST"&&(i.setHeader("Allow","POST"),i.status(405).end("Method Not Allowed"));const{event:s,session:r}=t.body;if(!s)throw new Error("Auth event missing!");if(s==="SIGNED_IN"){if(!r)throw new Error("Auth session missing!");ks(t,i,{name:this.cookieOptions.name,value:r.access_token,domain:this.cookieOptions.domain,maxAge:this.cookieOptions.lifetime,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite})}s==="SIGNED_OUT"&&Qo(t,i,this.cookieOptions.name),i.status(200).json({})}getUserByCookie(t){return z(this,void 0,void 0,function*(){try{if(!t.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");if(!t.cookies[this.cookieOptions.name])throw new Error("No cookie found!");const i=t.cookies[this.cookieOptions.name],{user:s,error:r}=yield this.getUser(i);if(r)throw r;return{user:s,data:s,error:null}}catch(i){return{user:null,data:null,error:i}}})}generateLink(t,i,s={}){return z(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/admin/generate_link`,{type:t,email:i,password:s.password,data:s.data,redirect_to:s.redirectTo},{headers:this.headers}),error:null}}catch(r){return{data:null,error:r}}})}}function ia(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self!="undefined"&&(self.globalThis=self)}}var K=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};ia();const sa={url:Vo,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Zo};class ra{constructor(t){this.stateChangeEmitters=new Map;const i=Object.assign(Object.assign({},sa),t);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=i.autoRefreshToken,this.persistSession=i.persistSession,this.localStorage=i.localStorage||globalThis.localStorage,this.api=new ea({url:i.url,headers:i.headers,cookieOptions:i.cookieOptions,fetch:i.fetch}),this._recoverSession(),this._recoverAndRefresh(),i.detectSessionInUrl&&mt()&&!!nt("access_token")&&this.getSessionFromUrl({storeSession:!0}).then(({error:s})=>{s&&console.error("Error getting session from URL.",s)})}signUp({email:t,password:i,phone:s},r={}){return K(this,void 0,void 0,function*(){try{this._removeSession();const{data:n,error:o}=s&&i?yield this.api.signUpWithPhone(s,i,{data:r.data}):yield this.api.signUpWithEmail(t,i,{redirectTo:r.redirectTo,data:r.data});if(o)throw o;if(!n)throw"An error occurred on sign up.";let a=null,h=null;return n.access_token&&(a=n,h=a.user,this._saveSession(a),this._notifyAllSubscribers("SIGNED_IN")),n.id&&(h=n),{data:n,user:h,session:a,error:null}}catch(n){return{data:null,user:null,session:null,error:n}}})}signIn({email:t,phone:i,password:s,refreshToken:r,provider:n},o={}){return K(this,void 0,void 0,function*(){try{if(this._removeSession(),t&&!s){const{error:a}=yield this.api.sendMagicLinkEmail(t,{redirectTo:o.redirectTo});return{data:null,user:null,session:null,error:a}}if(t&&s)return this._handleEmailSignIn(t,s,{redirectTo:o.redirectTo});if(i&&!s){const{error:a}=yield this.api.sendMobileOTP(i);return{data:null,user:null,session:null,error:a}}if(i&&s)return this._handlePhoneSignIn(i,s);if(r){const{error:a}=yield this._callRefreshToken(r);if(a)throw a;return{data:this.currentSession,user:this.currentUser,session:this.currentSession,error:null}}if(n)return this._handleProviderSignIn(n,{redirectTo:o.redirectTo,scopes:o.scopes});throw new Error("You must provide either an email, phone number or a third-party provider.")}catch(a){return{data:null,user:null,session:null,error:a}}})}verifyOTP({phone:t,token:i},s={}){return K(this,void 0,void 0,function*(){try{this._removeSession();const{data:r,error:n}=yield this.api.verifyMobileOTP(t,i,s);if(n)throw n;if(!r)throw"An error occurred on token verification.";let o=null,a=null;return r.access_token&&(o=r,a=o.user,this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN")),r.id&&(a=r),{data:r,user:a,session:o,error:null}}catch(r){return{data:null,user:null,session:null,error:r}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var t;return K(this,void 0,void 0,function*(){try{if(!((t=this.currentSession)===null||t===void 0?void 0:t.access_token))throw new Error("Not logged in.");const{error:i}=yield this._callRefreshToken();if(i)throw i;return{data:this.currentSession,user:this.currentUser,error:null}}catch(i){return{data:null,user:null,error:i}}})}update(t){var i;return K(this,void 0,void 0,function*(){try{if(!((i=this.currentSession)===null||i===void 0?void 0:i.access_token))throw new Error("Not logged in.");const{user:s,error:r}=yield this.api.updateUser(this.currentSession.access_token,t);if(r)throw r;if(!s)throw Error("Invalid user data.");const n=Object.assign(Object.assign({},this.currentSession),{user:s});return this._saveSession(n),this._notifyAllSubscribers("USER_UPDATED"),{data:s,user:s,error:null}}catch(s){return{data:null,user:null,error:s}}})}setSession(t){return K(this,void 0,void 0,function*(){try{if(!t)throw new Error("No current session.");const{data:i,error:s}=yield this.api.refreshAccessToken(t);return s?{session:null,error:s}:(this._saveSession(i),this._notifyAllSubscribers("SIGNED_IN"),{session:i,error:null})}catch(i){return{error:i,session:null}}})}setAuth(t){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:t,token_type:"bearer",user:null}),this.currentSession}getSessionFromUrl(t){return K(this,void 0,void 0,function*(){try{if(!mt())throw new Error("No browser detected.");const i=nt("error_description");if(i)throw new Error(i);const s=nt("provider_token"),r=nt("access_token");if(!r)throw new Error("No access_token detected.");const n=nt("expires_in");if(!n)throw new Error("No expires_in detected.");const o=nt("refresh_token");if(!o)throw new Error("No refresh_token detected.");const a=nt("token_type");if(!a)throw new Error("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(n),{user:c,error:u}=yield this.api.getUser(r);if(u)throw u;const d={provider_token:s,access_token:r,expires_in:parseInt(n),expires_at:l,refresh_token:o,token_type:a,user:c};return(t==null?void 0:t.storeSession)&&(this._saveSession(d),this._notifyAllSubscribers("SIGNED_IN"),nt("type")==="recovery"&&this._notifyAllSubscribers("PASSWORD_RECOVERY")),window.location.hash="",{data:d,error:null}}catch(i){return{data:null,error:i}}})}signOut(){var t;return K(this,void 0,void 0,function*(){const i=(t=this.currentSession)===null||t===void 0?void 0:t.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),i){const{error:s}=yield this.api.signOut(i);if(s)return{error:s}}return{error:null}})}onAuthStateChange(t){try{const i=ta(),s={id:i,callback:t,unsubscribe:()=>{this.stateChangeEmitters.delete(i)}};return this.stateChangeEmitters.set(i,s),{data:s,error:null}}catch(i){return{data:null,error:i}}}_handleEmailSignIn(t,i,s={}){var r,n;return K(this,void 0,void 0,function*(){try{const{data:o,error:a}=yield this.api.signInWithEmail(t,i,{redirectTo:s.redirectTo});return a||!o?{data:null,user:null,session:null,error:a}:((((r=o==null?void 0:o.user)===null||r===void 0?void 0:r.confirmed_at)||((n=o==null?void 0:o.user)===null||n===void 0?void 0:n.email_confirmed_at))&&(this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN")),{data:o,user:o.user,session:o,error:null})}catch(o){return{data:null,user:null,session:null,error:o}}})}_handlePhoneSignIn(t,i){var s;return K(this,void 0,void 0,function*(){try{const{data:r,error:n}=yield this.api.signInWithPhone(t,i);return n||!r?{data:null,user:null,session:null,error:n}:(((s=r==null?void 0:r.user)===null||s===void 0?void 0:s.phone_confirmed_at)&&(this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN")),{data:r,user:r.user,session:r,error:null})}catch(r){return{data:null,user:null,session:null,error:r}}})}_handleProviderSignIn(t,i={}){const s=this.api.getUrlForProvider(t,{redirectTo:i.redirectTo,scopes:i.scopes});try{return mt()&&(window.location.href=s),{provider:t,url:s,data:null,session:null,user:null,error:null}}catch(r){return s?{provider:t,url:s,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:r}}}_recoverSession(){var t;try{const i=mt()&&((t=this.localStorage)===null||t===void 0?void 0:t.getItem(pe));if(!i||typeof i!="string")return null;const s=JSON.parse(i),{currentSession:r,expiresAt:n}=s,o=Math.round(Date.now()/1e3);n>=o&&(r==null?void 0:r.user)&&(this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN"))}catch(i){console.log("error",i)}}_recoverAndRefresh(){return K(this,void 0,void 0,function*(){try{const t=mt()&&(yield this.localStorage.getItem(pe));if(!t)return null;const i=JSON.parse(t),{currentSession:s,expiresAt:r}=i,n=Math.round(Date.now()/1e3);if(r<n)if(this.autoRefreshToken&&s.refresh_token){const{error:o}=yield this._callRefreshToken(s.refresh_token);o&&(console.log(o.message),yield this._removeSession())}else this._removeSession();else!s||!s.user?(console.log("Current session is missing data."),this._removeSession()):(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN"))}catch(t){return console.error(t),null}})}_callRefreshToken(t){var i;return t===void 0&&(t=(i=this.currentSession)===null||i===void 0?void 0:i.refresh_token),K(this,void 0,void 0,function*(){try{if(!t)throw new Error("No current session.");const{data:s,error:r}=yield this.api.refreshAccessToken(t);if(r)throw r;if(!s)throw Error("Invalid session data.");return this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN"),{data:s,error:null}}catch(s){return{data:null,error:s}}})}_notifyAllSubscribers(t){this.stateChangeEmitters.forEach(i=>i.callback(t,this.currentSession))}_saveSession(t){this.currentSession=t,this.currentUser=t.user;const i=t.expires_at;if(i){const s=Math.round(Date.now()/1e3),r=i-s,n=r>60?60:.5;this._startAutoRefreshToken((r-n)*1e3)}this.persistSession&&t.expires_at&&this._persistSession(this.currentSession)}_persistSession(t){const i={currentSession:t,expiresAt:t.expires_at};mt()&&this.localStorage.setItem(pe,JSON.stringify(i))}_removeSession(){return K(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),mt()&&(yield this.localStorage.removeItem(pe))})}_startAutoRefreshToken(t){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),!(t<=0||!this.autoRefreshToken)&&(this.refreshTokenTimer=setTimeout(()=>this._callRefreshToken(),t),typeof this.refreshTokenTimer.unref=="function"&&this.refreshTokenTimer.unref())}}class na extends ra{constructor(t){super(t)}}var oa=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};class Qe{constructor(t){this.shouldThrowOnError=!1,Object.assign(this,t),this.fetch=t.fetch||de}throwOnError(){return this.shouldThrowOnError=!0,this}then(t,i){typeof this.schema=="undefined"||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let s=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(r=>oa(this,void 0,void 0,function*(){var n,o,a;let h=null,l=null,c=null;if(r.ok){const d=(n=this.headers.Prefer)===null||n===void 0?void 0:n.split(",").includes("return=minimal");if(this.method!=="HEAD"&&!d){const _=yield r.text();_&&(this.headers.Accept==="text/csv"?l=_:l=JSON.parse(_))}const f=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),p=(a=r.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");f&&p&&p.length>1&&(c=parseInt(p[1]))}else if(h=yield r.json(),h&&this.shouldThrowOnError)throw h;return{error:h,data:l,count:c,status:r.status,statusText:r.statusText,body:l}}));return this.shouldThrowOnError||(s=s.catch(r=>({error:{message:`FetchError: ${r.message}`,details:"",hint:"",code:r.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}))),s.then(t,i)}}class ti extends Qe{select(t="*"){let i=!1;const s=t.split("").map(r=>/\s/.test(r)&&!i?"":(r==='"'&&(i=!i),r)).join("");return this.url.searchParams.set("select",s),this}order(t,{ascending:i=!0,nullsFirst:s=!1,foreignTable:r}={}){const n=typeof r=="undefined"?"order":`${r}.order`,o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${t}.${i?"asc":"desc"}.${s?"nullsfirst":"nullslast"}`),this}limit(t,{foreignTable:i}={}){const s=typeof i=="undefined"?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,i,{foreignTable:s}={}){const r=typeof s=="undefined"?"offset":`${s}.offset`,n=typeof s=="undefined"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${t}`),this.url.searchParams.set(n,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){this.headers.Accept="application/vnd.pgrst.object+json";const t=new ti(this);return t.then=(i,s)=>this.then(r=>{var n,o;return((o=(n=r.error)===null||n===void 0?void 0:n.details)===null||o===void 0?void 0:o.includes("Results contain 0 rows"))?i({error:null,data:null,count:r.count,status:200,statusText:"OK",body:null}):i(r)},s),t}csv(){return this.headers.Accept="text/csv",this}}class Tt extends ti{constructor(){super(...arguments);this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(t,i,s){return this.url.searchParams.append(`${t}`,`not.${i}.${s}`),this}or(t,{foreignTable:i}={}){const s=typeof i=="undefined"?"or":`${i}.or`;return this.url.searchParams.append(s,`(${t})`),this}eq(t,i){return this.url.searchParams.append(`${t}`,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(`${t}`,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(`${t}`,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(`${t}`,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(`${t}`,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(`${t}`,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(`${t}`,`like.${i}`),this}ilike(t,i){return this.url.searchParams.append(`${t}`,`ilike.${i}`),this}is(t,i){return this.url.searchParams.append(`${t}`,`is.${i}`),this}in(t,i){const s=i.map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(`${t}`,`in.(${s})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(`${t}`,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(`${t}`,`cs.{${i.join(",")}}`):this.url.searchParams.append(`${t}`,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(`${t}`,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(`${t}`,`cd.{${i.join(",")}}`):this.url.searchParams.append(`${t}`,`cd.${JSON.stringify(i)}`),this}rangeLt(t,i){return this.url.searchParams.append(`${t}`,`sl.${i}`),this}rangeGt(t,i){return this.url.searchParams.append(`${t}`,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(`${t}`,`nxl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(`${t}`,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(`${t}`,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(`${t}`,`ov.${i}`):this.url.searchParams.append(`${t}`,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:s,type:r=null}={}){let n="";r==="plain"?n="pl":r==="phrase"?n="ph":r==="websearch"&&(n="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(`${t}`,`${n}fts${o}.${i}`),this}fts(t,i,{config:s}={}){const r=typeof s=="undefined"?"":`(${s})`;return this.url.searchParams.append(`${t}`,`fts${r}.${i}`),this}plfts(t,i,{config:s}={}){const r=typeof s=="undefined"?"":`(${s})`;return this.url.searchParams.append(`${t}`,`plfts${r}.${i}`),this}phfts(t,i,{config:s}={}){const r=typeof s=="undefined"?"":`(${s})`;return this.url.searchParams.append(`${t}`,`phfts${r}.${i}`),this}wfts(t,i,{config:s}={}){const r=typeof s=="undefined"?"":`(${s})`;return this.url.searchParams.append(`${t}`,`wfts${r}.${i}`),this}filter(t,i,s){return this.url.searchParams.append(`${t}`,`${i}.${s}`),this}match(t){return Object.keys(t).forEach(i=>{this.url.searchParams.append(`${i}`,`eq.${t[i]}`)}),this}}class Cs extends Qe{constructor(t,{headers:i={},schema:s,fetch:r}={}){super({fetch:r});this.url=new URL(t),this.headers=Object.assign({},i),this.schema=s}select(t="*",{head:i=!1,count:s=null}={}){this.method="GET";let r=!1;const n=t.split("").map(o=>/\s/.test(o)&&!r?"":(o==='"'&&(r=!r),o)).join("");return this.url.searchParams.set("select",n),s&&(this.headers.Prefer=`count=${s}`),i&&(this.method="HEAD"),new Tt(this)}insert(t,{upsert:i=!1,onConflict:s,returning:r="representation",count:n=null}={}){this.method="POST";const o=[`return=${r}`];if(i&&o.push("resolution=merge-duplicates"),i&&s!==void 0&&this.url.searchParams.set("on_conflict",s),this.body=t,n&&o.push(`count=${n}`),this.headers.Prefer=o.join(","),Array.isArray(t)){const a=t.reduce((h,l)=>h.concat(Object.keys(l)),[]);if(a.length>0){const h=[...new Set(a)].map(l=>`"${l}"`);this.url.searchParams.set("columns",h.join(","))}}return new Tt(this)}upsert(t,{onConflict:i,returning:s="representation",count:r=null,ignoreDuplicates:n=!1}={}){this.method="POST";const o=[`resolution=${n?"ignore":"merge"}-duplicates`,`return=${s}`];return i!==void 0&&this.url.searchParams.set("on_conflict",i),this.body=t,r&&o.push(`count=${r}`),this.headers.Prefer=o.join(","),new Tt(this)}update(t,{returning:i="representation",count:s=null}={}){this.method="PATCH";const r=[`return=${i}`];return this.body=t,s&&r.push(`count=${s}`),this.headers.Prefer=r.join(","),new Tt(this)}delete({returning:t="representation",count:i=null}={}){this.method="DELETE";const s=[`return=${t}`];return i&&s.push(`count=${i}`),this.headers.Prefer=s.join(","),new Tt(this)}}class aa extends Qe{constructor(t,{headers:i={},schema:s,fetch:r}={}){super({fetch:r});this.url=new URL(t),this.headers=Object.assign({},i),this.schema=s}rpc(t,{head:i=!1,count:s=null}={}){return i?(this.method="HEAD",t&&Object.entries(t).forEach(([r,n])=>{this.url.searchParams.append(r,n)})):(this.method="POST",this.body=t),s&&(this.headers.Prefer!==void 0?this.headers.Prefer+=`,count=${s}`:this.headers.Prefer=`count=${s}`),new Tt(this)}}const la="0.35.0",ha={"X-Client-Info":`postgrest-js/${la}`};class ca{constructor(t,{headers:i={},schema:s,fetch:r}={}){this.url=t,this.headers=Object.assign(Object.assign({},ha),i),this.schema=s,this.fetch=r}auth(t){return this.headers.Authorization=`Bearer ${t}`,this}from(t){const i=`${this.url}/${t}`;return new Cs(i,{headers:this.headers,schema:this.schema,fetch:this.fetch})}rpc(t,i,{head:s=!1,count:r=null}={}){const n=`${this.url}/rpc/${t}`;return new aa(n,{headers:this.headers,schema:this.schema,fetch:this.fetch}).rpc(i,{head:s,count:r})}}var P;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(P||(P={}));const As=(e,t,i={})=>{var s;const r=(s=i.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(t).reduce((n,o)=>(n[o]=ua(o,e,t,r),n),{})},ua=(e,t,i,s)=>{const r=t.find(a=>a.name===e),n=r==null?void 0:r.type,o=i[e];return n&&!s.includes(n)?Es(n,o):ei(o)},Es=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return ma(t,i)}switch(e){case P.bool:return da(t);case P.float4:case P.float8:case P.int2:case P.int4:case P.int8:case P.numeric:case P.oid:return fa(t);case P.json:case P.jsonb:return pa(t);case P.timestamp:return ga(t);case P.abstime:case P.date:case P.daterange:case P.int4range:case P.int8range:case P.money:case P.reltime:case P.text:case P.time:case P.timestamptz:case P.timetz:case P.tsrange:case P.tstzrange:return ei(t);default:return ei(t)}},ei=e=>e,da=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},fa=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},pa=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},ma=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,s=e[i];if(e[0]==="{"&&s==="}"){let n;const o=e.slice(1,i);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>Es(t,a))}return e},ga=e=>typeof e=="string"?e.replace(" ","T"):e,_a="1.2.1",ya={"X-Client-Info":`realtime-js/${_a}`},va="1.0.0",Is=1e4,ba=1e3;var Ut;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Ut||(Ut={}));var H;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(H||(H={}));var et;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave"})(et||(et={}));var ii;(function(e){e.websocket="websocket"})(ii||(ii={}));class Os{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class si{constructor(t,i,s={},r=Is){this.channel=t,this.event=i,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}receive(t,i){var s;return this._hasReceived(t)&&i((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(t,i){this.refEvent&&this.channel.trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){!this.refEvent||this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(s=>s.status===t).forEach(s=>s.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}class xa{constructor(t,i={},s){this.topic=t,this.params=i,this.socket=s,this.bindings=[],this.state=H.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new si(this,et.join,this.params,this.timeout),this.rejoinTimer=new Os(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=H.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=H.closed,this.socket.remove(this)}),this.onError(r=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{!this.isJoining()||(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=H.errored,this.rejoinTimer.scheduleTimeout())}),this.on(et.reply,(r,n)=>{this.trigger(this.replyEventName(n),r)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(t=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(t),this.joinPush}onClose(t){this.on(et.close,t)}onError(t){this.on(et.error,i=>t(i))}on(t,i){this.bindings.push({event:t,callback:i})}off(t){this.bindings=this.bindings.filter(i=>i.event!==t)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(t,i,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new si(this,t,i,s);return this.canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}unsubscribe(t=this.timeout){this.state=H.leaving;let i=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(et.close,"leave",this.joinRef())};this.joinPush.destroy();let s=new si(this,et.leave,{},t);return s.receive("ok",()=>i()).receive("timeout",()=>i()),s.send(),this.canPush()||s.trigger("ok",{}),s}onMessage(t,i,s){return i}isMember(t){return this.topic===t}joinRef(){return this.joinPush.ref}sendJoin(t){this.state=H.joining,this.joinPush.resend(t)}rejoin(t=this.timeout){this.isLeaving()||this.sendJoin(t)}trigger(t,i,s){let{close:r,error:n,leave:o,join:a}=et;if(s&&[r,n,o,a].indexOf(t)>=0&&s!==this.joinRef())return;let l=this.onMessage(t,i,s);if(i&&!l)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(c=>c.event==="*"?t===(i==null?void 0:i.type):c.event===t).map(c=>c.callback(l,s))}replyEventName(t){return`chan_reply_${t}`}isClosed(){return this.state===H.closed}isErrored(){return this.state===H.errored}isJoined(){return this.state===H.joined}isJoining(){return this.state===H.joining}isLeaving(){return this.state===H.leaving}}const wa="websocket",Sa="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",La=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Ta="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",ka=["I\xF1aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Ca="1.0.34",Aa={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Ea="https://github.com/theturtle32/WebSocket-Node",Ia={node:">=4.0.0"},Oa={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Pa={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},Da={verbose:!1},Ra={test:"tape test/unit/*.js",gulp:"gulp"},Ma="index",Fa={lib:"./lib"},Na="lib/browser.js",Ua="Apache-2.0";var Ba={name:wa,description:Sa,keywords:La,author:Ta,contributors:ka,version:Ca,repository:Aa,homepage:Ea,engines:Ia,dependencies:Oa,devDependencies:Pa,config:Da,scripts:Ra,main:Ma,directories:Fa,browser:Na,license:Ua},Ga=Ba.version,gt;if(typeof globalThis=="object")gt=globalThis;else try{gt=require("es5-ext/global")}catch{}finally{if(!gt&&typeof window!="undefined"&&(gt=window),!gt)throw new Error("Could not determine global this")}var Bt=gt.WebSocket||gt.MozWebSocket,za=Ga;function Ps(e,t){var i;return t?i=new Bt(e,t):i=new Bt(e),i}Bt&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(Ps,e,{get:function(){return Bt[e]}})});var ja={w3cwebsocket:Bt?Ps:null,version:za};class $a{constructor(){this.HEADER_LENGTH=1}decode(t,i){return t.constructor===ArrayBuffer?i(this._binaryDecode(t)):i(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const i=new DataView(t),s=new TextDecoder;return this._decodeBroadcast(t,i,s)}_decodeBroadcast(t,i,s){const r=i.getUint8(1),n=i.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(t.slice(o,o+r));o=o+r;const h=s.decode(t.slice(o,o+n));o=o+n;const l=JSON.parse(s.decode(t.slice(o,t.byteLength)));return{ref:null,topic:a,event:h,payload:l}}}var qa=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};const Ha=()=>{};class Va{constructor(t,i){this.channels=[],this.endPoint="",this.headers=ya,this.params={},this.timeout=Is,this.transport=ja.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ha,this.conn=null,this.sendBuffer=[],this.serializer=new $a,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${t}/${ii.websocket}`,(i==null?void 0:i.params)&&(this.params=i.params),(i==null?void 0:i.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),(i==null?void 0:i.timeout)&&(this.timeout=i.timeout),(i==null?void 0:i.logger)&&(this.logger=i.logger),(i==null?void 0:i.transport)&&(this.transport=i.transport),(i==null?void 0:i.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs),(i==null?void 0:i.longpollerTimeout)&&(this.longpollerTimeout=i.longpollerTimeout),this.reconnectAfterMs=(i==null?void 0:i.reconnectAfterMs)?i.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=(i==null?void 0:i.encode)?i.encode:(s,r)=>r(JSON.stringify(s)),this.decode=(i==null?void 0:i.decode)?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Os(()=>qa(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t)))}disconnect(t,i){return new Promise((s,r)=>{try{this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,i||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),s({error:null,data:!0})}catch(n){s({error:n,data:!1})}})}log(t,i,s){this.logger(t,i,s)}onOpen(t){this.stateChangeCallbacks.open.push(t)}onClose(t){this.stateChangeCallbacks.close.push(t)}onError(t){this.stateChangeCallbacks.error.push(t)}onMessage(t){this.stateChangeCallbacks.message.push(t)}connectionState(){switch(this.conn&&this.conn.readyState){case Ut.connecting:return"connecting";case Ut.open:return"open";case Ut.closing:return"closing";default:return"closed"}}isConnected(){return this.connectionState()==="open"}remove(t){this.channels=this.channels.filter(i=>i.joinRef()!==t.joinRef())}channel(t,i={}){let s=new xa(t,i,this);return this.channels.push(s),s}push(t){let{topic:i,event:s,payload:r,ref:n}=t,o=()=>{this.encode(t,a=>{var h;(h=this.conn)===null||h===void 0||h.send(a)})};this.log("push",`${i} ${s} (${n})`,r),this.isConnected()?o():this.sendBuffer.push(o)}onConnMessage(t){this.decode(t.data,i=>{let{topic:s,event:r,payload:n,ref:o}=i;o&&o===this.pendingHeartbeatRef?this.pendingHeartbeatRef=null:r===(n==null?void 0:n.type)&&this._resetHeartbeat(),this.log("receive",`${n.status||""} ${s} ${r} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a.isMember(s)).forEach(a=>a.trigger(r,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(i))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:va}))}makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this._resetHeartbeat(),this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(t))}_triggerChanError(){this.channels.forEach(t=>t.trigger(et.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const s=t.match(/\?/)?"&":"?",r=new URLSearchParams(i);return`${t}${s}${r}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_resetHeartbeat(){this.pendingHeartbeatRef=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs)}_sendHeartbeat(){var t;if(!!this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(ba,"hearbeat timeout");return}this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}}class Za{constructor(t,i,s,r){const n={},o=r==="*"?`realtime:${s}`:`realtime:${s}:${r}`,a=i.Authorization.split(" ")[1];a&&(n.user_token=a),this.subscription=t.channel(o,n)}getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=As(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=As(t.columns,t.old_record)),i}on(t,i){return this.subscription.on(t,s=>{let r={schema:s.schema,table:s.table,commit_timestamp:s.commit_timestamp,eventType:s.type,new:{},old:{}};r=Object.assign(Object.assign({},r),this.getPayloadRecords(s)),i(r)}),this}subscribe(t=()=>{}){return this.subscription.onError(i=>t("SUBSCRIPTION_ERROR",i)),this.subscription.onClose(()=>t("CLOSED")),this.subscription.subscribe().receive("ok",()=>t("SUBSCRIBED")).receive("error",i=>t("SUBSCRIPTION_ERROR",i)).receive("timeout",()=>t("RETRYING_AFTER_TIMEOUT")),this.subscription}}class Ja extends Cs{constructor(t,{headers:i={},schema:s,realtime:r,table:n,fetch:o}){super(t,{headers:i,schema:s,fetch:o});this._subscription=new Za(r,i,s,n),this._realtime=r}on(t,i){return this._realtime.isConnected()||this._realtime.connect(),this._subscription.on(t,i)}}var Gt=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};const Ka=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Wa=(e,t)=>{if(typeof e.json!="function")return t(e);e.json().then(i=>t({message:Ka(i),status:(e==null?void 0:e.status)||500}))},Xa=(e,t,i,s)=>{const r={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),i))};function me(e=de,t,i,s,r,n){return Gt(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(i,Xa(t,s,r,n)).then(h=>{if(!h.ok)throw h;return(s==null?void 0:s.noResolveJson)?o(h):h.json()}).then(h=>o(h)).catch(h=>Wa(h,a))})})}function ri(e,t,i,s){return Gt(this,void 0,void 0,function*(){return me(e,"GET",t,i,s)})}function zt(e,t,i,s,r){return Gt(this,void 0,void 0,function*(){return me(e,"POST",t,s,r,i)})}function Ya(e,t,i,s,r){return Gt(this,void 0,void 0,function*(){return me(e,"PUT",t,s,r,i)})}function Ds(e,t,i,s,r){return Gt(this,void 0,void 0,function*(){return me(e,"DELETE",t,s,r,i)})}const Qa="0.0.0",tl={"X-Client-Info":`storage-js/${Qa}`};var kt=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};class el{constructor(t,i={},s){this.url=t,this.headers=Object.assign(Object.assign({},tl),i),this.fetch=s}listBuckets(){return kt(this,void 0,void 0,function*(){try{return{data:yield ri(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}})}getBucket(t){return kt(this,void 0,void 0,function*(){try{return{data:yield ri(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(i){return{data:null,error:i}}})}createBucket(t,i={public:!1}){return kt(this,void 0,void 0,function*(){try{return{data:(yield zt(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:i.public},{headers:this.headers})).name,error:null}}catch(s){return{data:null,error:s}}})}updateBucket(t,i){return kt(this,void 0,void 0,function*(){try{return{data:yield Ya(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:i.public},{headers:this.headers}),error:null}}catch(s){return{data:null,error:s}}})}emptyBucket(t){return kt(this,void 0,void 0,function*(){try{return{data:yield zt(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(i){return{data:null,error:i}}})}deleteBucket(t){return kt(this,void 0,void 0,function*(){try{return{data:yield Ds(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){return{data:null,error:i}}})}}var ot=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};const il={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},sl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rl{constructor(t,i={},s,r){this.url=t,this.headers=i,this.bucketId=s,this.fetch=r}uploadOrUpdate(t,i,s,r){return ot(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},sl),r),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob!="undefined"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),n.append("",s)):typeof FormData!="undefined"&&s instanceof FormData?(n=s,n.append("cacheControl",o.cacheControl)):(n=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const h=this._getFinalPath(i),l=yield de(`${this.url}/object/${h}`,{method:t,body:n,headers:a});if(l.ok)return{data:{Key:h},error:null};{const c=yield l.json();return{data:null,error:c}}}catch(n){return{data:null,error:n}}})}upload(t,i,s){return ot(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,i,s)})}update(t,i,s){return ot(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,i,s)})}move(t,i){return ot(this,void 0,void 0,function*(){try{return{data:yield zt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i},{headers:this.headers}),error:null}}catch(s){return{data:null,error:s}}})}createSignedUrl(t,i){return ot(this,void 0,void 0,function*(){try{const s=this._getFinalPath(t);let r=yield zt(this.fetch,`${this.url}/object/sign/${s}`,{expiresIn:i},{headers:this.headers});const n=`${this.url}${r.signedURL}`;return r={signedURL:n},{data:r,error:null,signedURL:n}}catch(s){return{data:null,error:s,signedURL:null}}})}download(t){return ot(this,void 0,void 0,function*(){try{const i=this._getFinalPath(t);return{data:yield(yield ri(this.fetch,`${this.url}/object/${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(i){return{data:null,error:i}}})}getPublicUrl(t){try{const i=this._getFinalPath(t),s=`${this.url}/object/public/${i}`;return{data:{publicURL:s},error:null,publicURL:s}}catch(i){return{data:null,error:i,publicURL:null}}}remove(t){return ot(this,void 0,void 0,function*(){try{return{data:yield Ds(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(i){return{data:null,error:i}}})}list(t,i,s){return ot(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},il),i),{prefix:t||""});return{data:yield zt(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){return{data:null,error:r}}})}_getFinalPath(t){return`${this.bucketId}/${t}`}}class nl extends el{constructor(t,i={},s){super(t,i,s)}from(t){return new rl(this.url,this.headers,t,this.fetch)}}var Rs=globalThis&&globalThis.__awaiter||function(e,t,i,s){function r(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):r(c.value).then(a,h)}l((s=s.apply(e,t||[])).next())})};const ol={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ts};class al{constructor(t,i,s){if(this.supabaseUrl=t,this.supabaseKey=i,!t)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");t=Uo(t);const r=Object.assign(Object.assign({},ol),s);this.restUrl=`${t}/rest/v1`,this.realtimeUrl=`${t}/realtime/v1`.replace("http","ws"),this.authUrl=`${t}/auth/v1`,this.storageUrl=`${t}/storage/v1`,this.schema=r.schema,this.auth=this._initSupabaseAuthClient(r),this.realtime=this._initRealtimeClient(r.realtime),this.fetch=r.fetch}get storage(){return new nl(this.storageUrl,this._getAuthHeaders(),this.fetch)}from(t){const i=`${this.restUrl}/${t}`;return new Ja(i,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:t,fetch:this.fetch})}rpc(t,i,{head:s=!1,count:r=null}={}){return this._initPostgRESTClient().rpc(t,i,{head:s,count:r})}removeSubscription(t){return new Promise(i=>Rs(this,void 0,void 0,function*(){try{yield this._closeSubscription(t);const s=this.getSubscriptions().length;if(!s){const{error:r}=yield this.realtime.disconnect();if(r)return i({error:r})}return i({error:null,data:{openSubscriptions:s}})}catch(s){return i({error:s})}}))}_closeSubscription(t){return Rs(this,void 0,void 0,function*(){t.isClosed()||(yield this._closeChannel(t))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:s,localStorage:r,headers:n}){const o={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new na({url:this.authUrl,headers:Object.assign(Object.assign({},n),o),autoRefreshToken:t,persistSession:i,detectSessionInUrl:s,localStorage:r,fetch:this.fetch})}_initRealtimeClient(t){return new Va(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign(Object.assign({},t==null?void 0:t.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new ca(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch})}_getAuthHeaders(){var t,i;const s=Ts,r=(i=(t=this.auth.session())===null||t===void 0?void 0:t.access_token)!==null&&i!==void 0?i:this.supabaseKey;return s.apikey=this.supabaseKey,s.Authorization=`Bearer ${r}`,s}_closeChannel(t){return new Promise((i,s)=>{t.unsubscribe().receive("ok",()=>(this.realtime.remove(t),i(!0))).receive("error",r=>s(r))})}}const Ms=(e,t,i)=>new al(e,t,i);function ll(e){const t=x.DomUtil.create("a","save-route-button leaflet-control-zoom-in",e);return t.href="#",t.title="Lagre rute",t.innerHTML="<span class='fa fa-save'></span>",t}x.Control.SaveRoute=x.Control.extend({options:{position:"topleft"},initialize(e){x.Util.setOptions(this,e)},onAdd(e){this._isLoading=!1,this._map=e,this._routeHandler=new Xe(this._map);const t=this.getRouteIdFromUrl();t&&this.loadRoute(t);const i=x.DomUtil.create("div","leaflet-control-save-route leaflet-bar");return this._button=ll(i),x.DomEvent.on(this._button,"dblclick",x.DomEvent.stop,this).on(this._button,"click",x.DomEvent.stop,this).on(this._button,"click",this._saveRoute,this),i},onRemove(){this._isActive=!1,this._isLoading=!1,x.DomUtil.removeClass(this._button,"active"),x.DomUtil.removeClass(this._button,"loading")},_saveRoute(){x.DomUtil.addClass(this._button,"loading");const e=Co(this._map);e.length>0&&this._postRoute(e)},generatePath(e){return`/?routeid=${e}`},async _postRoute(e){const t=Ms("https://cvkrixhyrwhqqvrekwgz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNjkwNTE2MCwiZXhwIjoxOTUyNDgxMTYwfQ.H_zIyV0rN9nGxS5jVjSoo49UHdKw5n3fpQ6SZq21Z1g");try{const{data:i,error:s}=await t.from("routes").insert([{geojson:e}]);if(s)throw s;if(i){const r=this.generatePath(i[0].id);history.replaceState(void 0,"",r),alert(`Ruten er lagret p\xE5 ${window.location.origin+r}`)}}catch(i){alert(i.message)}},getRouteIdFromUrl(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).routeid||void 0},async loadRoute(e){const t=Ms("https://cvkrixhyrwhqqvrekwgz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNjkwNTE2MCwiZXhwIjoxOTUyNDgxMTYwfQ.H_zIyV0rN9nGxS5jVjSoo49UHdKw5n3fpQ6SZq21Z1g");try{const{data:i,error:s,status:r}=await t.from("routes").select("id, geojson").eq("id",e).single();if(s&&r!==406)throw s;if(i)for(const n of i.geojson){const o=x.geoJSON(n).addTo(this._map);this._routeHandler.addElevationAndReplace(o)}}catch(i){alert(i.message)}}});x.Control.saveRoute=()=>new x.Control.SaveRoute;function hl(e){x.Control.saveRoute().addTo(e)}const st=Io(),cl=new Xe(st);Po(st);Oo(st);Fo(st);Do(st);cl.init(st);Mo(st);Ro(st);hl(st);export{Tl as L,kl as a};
