import{L as s,g as z,k as G,d as P,l as U,c as y,a as j,b as F,e as J,f as V,h as _,i as w}from"./vendor.9077714b.js";const H=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};H();L.Control.Slider=L.Control.extend({update:function(t){return t},options:{size:"100px",position:"topright",min:0,max:250,step:1,id:"slider",value:50,collapsed:!0,title:"Leaflet Slider",logo:"S",orientation:"horizontal",increment:!1,getValue:function(t){return t},showValue:!0,syncSlider:!1},initialize:function(t,e){L.setOptions(this,e),typeof t=="function"?this.update=t:this.update=function(o){console.log(o)},typeof this.options.getValue!="function"&&(this.options.getValue=function(o){return o}),this.options.orientation!="vertical"&&(this.options.orientation="horizontal")},onAdd:function(t){return this._initLayout(),this.update(this.options.value+""),this._container},_updateValue:function(){this.value=this.slider.value,this.options.showValue&&(this._sliderValue.innerHTML=this.options.getValue(this.value)),this.update(this.value)},_initLayout:function(){var t="leaflet-control-slider";this._container=L.DomUtil.create("div",t+" "+t+"-"+this.options.orientation),this._sliderLink=L.DomUtil.create("a",t+"-toggle",this._container),this._sliderLink.setAttribute("title",this.options.title),this._sliderLink.innerHTML=this.options.logo,this.options.showValue&&(this._sliderValue=L.DomUtil.create("p",t+"-value",this._container),this._sliderValue.innerHTML=this.options.getValue(this.options.value)),this.options.increment&&(this._plus=L.DomUtil.create("a",t+"-plus",this._container),this._plus.innerHTML="+",L.DomEvent.on(this._plus,"click",this._increment,this),L.DomUtil.addClass(this._container,"leaflet-control-slider-incdec")),this._sliderContainer=L.DomUtil.create("div","leaflet-slider-container",this._container),this.slider=L.DomUtil.create("input","leaflet-slider",this._sliderContainer),this.options.orientation=="vertical"&&this.slider.setAttribute("orient","vertical"),this.slider.setAttribute("title",this.options.title),this.slider.setAttribute("id",this.options.id),this.slider.setAttribute("type","range"),this.slider.setAttribute("min",this.options.min),this.slider.setAttribute("max",this.options.max),this.slider.setAttribute("step",this.options.step),this.slider.setAttribute("value",this.options.value),this.options.syncSlider?L.DomEvent.on(this.slider,"input",function(e){this._updateValue()},this):L.DomEvent.on(this.slider,"change",function(e){this._updateValue()},this),this.options.increment&&(this._minus=L.DomUtil.create("a",t+"-minus",this._container),this._minus.innerHTML="-",L.DomEvent.on(this._minus,"click",this._decrement,this)),this.options.showValue?window.matchMedia("screen and (-webkit-min-device-pixel-ratio:0)").matches&&this.options.orientation=="vertical"?(this.slider.style.width=this.options.size.replace("px","")-36+"px",this._sliderContainer.style.height=this.options.size.replace("px","")-36+"px"):this.options.orientation=="vertical"?this._sliderContainer.style.height=this.options.size.replace("px","")-36+"px":this._sliderContainer.style.width=this.options.size.replace("px","")-56+"px":window.matchMedia("screen and (-webkit-min-device-pixel-ratio:0)").matches&&this.options.orientation=="vertical"?(this.slider.style.width=this.options.size.replace("px","")-10+"px",this._sliderContainer.style.height=this.options.size.replace("px","")-10+"px"):this.options.orientation=="vertical"?this._sliderContainer.style.height=this.options.size.replace("px","")-10+"px":this._sliderContainer.style.width=this.options.size.replace("px","")-25+"px",L.DomEvent.disableClickPropagation(this._container),this.options.collapsed?(L.Browser.android||L.DomEvent.on(this._container,"mouseenter",this._expand,this).on(this._container,"mouseleave",this._collapse,this),L.Browser.touch?L.DomEvent.on(this._sliderLink,"click",L.DomEvent.stop).on(this._sliderLink,"click",this._expand,this):L.DomEvent.on(this._sliderLink,"focus",this._expand,this)):this._expand()},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-slider-expanded")},_collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-control-slider-expanded")},_increment:function(){console.log(this.slider.value-this.slider.step+" "+this.slider.value+this.slider.step),this.slider.value=this.slider.value*1+this.slider.step*1,this._updateValue()},_decrement:function(){console.log(this.slider.value-this.slider.step+" "+this.slider.value+this.slider.step),this.slider.value=this.slider.value*1-this.slider.step*1,this._updateValue()}});L.control.slider=function(t,e){return new L.Control.Slider(t,e)};const B=s.Layer.extend({options:{layer:s.geoJson,layerOptions:{},fileSizeLimit:1024},initialize(t,e){this._map=t,s.Util.setOptions(this,e),this._parsers={geojson:this._loadGeoJSON,json:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load(t,e){let o,i;return this._isParameterMissing(t,"file")||!this._isFileSizeOk(t.size)||(o=this._getParser(t.name,e),!o)?!1:(i=new FileReader,i.addEventListener("load",s.Util.bind(function(n){let r;try{this.fire("data:loading",{filename:t.name,format:o.ext}),r=o.processor.call(this,n.target.result,o.ext),this.fire("data:loaded",{layer:r,filename:t.name,format:o.ext})}catch(l){this.fire("data:error",{error:l})}},this)),t.testing||i.readAsText(t),i)},loadMultiple(t,e){const o=[];if(t[0])for(t=Array.prototype.slice.apply(t);t.length>0;)o.push(this.load(t.shift(),e));return o},loadData(t,e,o){let i,n;if(!(this._isParameterMissing(t,"data")||this._isParameterMissing(e,"name"))&&!!this._isFileSizeOk(t.length)&&(i=this._getParser(e,o),!!i))try{this.fire("data:loading",{filename:e,format:i.ext}),n=i.processor.call(this,t,i.ext),this.fire("data:loaded",{layer:n,filename:e,format:i.ext})}catch(r){this.fire("data:error",{error:r})}},_isParameterMissing(t,e){return typeof t=="undefined"?(this.fire("data:error",{error:new Error("Missing parameter: "+e)}),!0):!1},_getParser(t,e){let o;if(e=e||t.split(".").pop(),o=this._parsers[e],!o){this.fire("data:error",{error:new Error("Unsupported file type ("+e+")")});return}return{processor:o,ext:e}},_isFileSizeOk(t){const e=(t/1024).toFixed(4);return e>this.options.fileSizeLimit?(this.fire("data:error",{error:new Error("File size exceeds limit ("+e+" > "+this.options.fileSizeLimit+"kb)")}),!1):!0},_loadGeoJSON:function(e){let o;if(typeof e=="string"&&(e=JSON.parse(e)),o=this.options.layer(e,this.options.layerOptions),o.getLayers().length===0)throw new Error("GeoJSON has no valid layers.");return this.options.addToMap&&o.addTo(this._map),o},_convertToGeoJSON:function(e,o){let i;return typeof e=="string"&&(e=new window.DOMParser().parseFromString(e,"text/xml")),o==="gpx"&&(i=z(e)),o==="kml"&&(i=G(e)),this._loadGeoJSON(i)}}),W=s.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{},addToMap:!0,fileSizeLimit:1024},initialize(t){s.Util.setOptions(this,t),this.loader=null},onAdd(t){return this.loader=s.FileLayer.fileLoader(t,this.options),this.loader.on("data:loaded",function(e){this.options.fitBounds&&window.setTimeout(function(){t.fitBounds(e.layer.getBounds())},500)},this),this._initDragAndDrop(t),this._initContainer()},_initDragAndDrop(t){let e;const o=this.loader,i=t._container,n={dragenter(){t.scrollWheelZoom.disable()},dragleave(){t.scrollWheelZoom.enable()},dragover(r){r.stopPropagation(),r.preventDefault()},drop(r){r.stopPropagation(),r.preventDefault(),o.loadMultiple(r.dataTransfer.files),t.scrollWheelZoom.enable()}};for(e in n)n.hasOwnProperty(e)&&i.addEventListener(e,n[e],!1)},_initContainer(){const t=this.loader,e="leaflet-control-filelayer leaflet-control-zoom",o="leaflet-bar",i=o+"-part",n=s.DomUtil.create("div",e+" "+o),r=s.DomUtil.create("a",e+"-in "+i,n);r.innerHTML=s.Control.FileLayerLoad.LABEL,r.href="#",r.title=s.Control.FileLayerLoad.TITLE;const l=s.DomUtil.create("input","hidden",n);return l.type="file",l.multiple="multiple",l.accept=this.options.formats?this.options.formats.join(","):".gpx,.kml,.json,.geojson",l.style.display="none",l.addEventListener("change",function(){t.loadMultiple(this.files),this.value=""},!1),s.DomEvent.disableClickPropagation(r),s.DomEvent.on(r,"click",function(u){l.click(),u.preventDefault()}),n}});s.FileLayer={};s.FileLayer.FileLoader=B;s.FileLayer.fileLoader=function(t,e){return new s.FileLayer.FileLoader(t,e)};s.Control.FileLayerLoad=W;s.Control.fileLayerLoad=function(t){return new s.Control.FileLayerLoad(t)};const S='<a href="http://www.kartverket.no/">Kartverket</a>',O=["opencache","opencache2","opencache3"],b='<a href="https://www.nve.no/">NVE</a>',Z=s.tileLayer("https://{s}.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=toporaster4&zoom={z}&x={x}&y={y}",{attribution:S,subdomains:O}),K=s.tileLayer("https://{s}.statkart.no/gatekeeper/gk/gk.open_gmaps?layers=topo4&zoom={z}&x={x}&y={y}",{attribution:S,subdomains:O}),x=P({url:"https://gis2.nve.no/arcgis/rest/services/wmts/KastWMTS/MapServer",layers:[0,1,2,3]},{attribution:b}),k=s.tileLayer.wms("https://gis3.nve.no/map/services/Bratthet/MapServer/WmsServer?",{layers:"Bratthet_snoskred",format:"image/png",transparent:"true",attribution:b}),f={Vektorkart:K,Rasterkart:Z},E={Helning:k,AutoKAST:x},C={Tillegg:{Helning:k,AutoKAST:x}};s.control.groupedLayers(f,C,{exclusiveGroups:["Tillegg"],position:"bottomright",collapsed:!0});function $(t,e){const o=j(t,e);return U(y(o))}function q(t){const[e]=t.getTiePoints(),o=t.getFileDirectory().ModelPixelScale;return[e.x,o[0],0,e.y,0,-1*o[1]]}function X(t){const e="https://openwms.statkart.no/skwms1/wcs.dtm?&SERVICE=WCS&REQUEST=GetCoverage&VERSION=1.0.0&COVERAGE=land_utm33_10m&FORMAT=GEOTIFF&COLORSCALE=false&CRS=EPSG:4326&WIDTH=700&HEIGHT=700",i=J(t).join(",");return`${e}&BBOX=${i}`}async function Y(t){const o=await(await fetch(t)).arrayBuffer();return(await V(o)).getImage()}async function Q(t){const e=await t.readRasters(),o=[];for(let i=0;i<t.getHeight();i++){o[i]=[];for(let n=0;n<t.getWidth();n++)o[i][n]=e[0][n+i*t.getWidth()]}return o}async function tt(t){const e=await Y(X(t)),o=await Q(e),i=q(e);function n(r,l){let u=Math.round((r-i[0])/i[1]),h=Math.round((l-i[3])/i[5]);return u===e.getWidth()&&(u-=1),h===e.getHeight()&&(h-=1),o[h][u]}return{altitudeAtCoord:n}}async function et(t){const e=await tt(t),o=JSON.parse(JSON.stringify(t));return F(o,i=>{const n=e.altitudeAtCoord(i[0],i[1]);i[2]=n}),o}async function ot(t){const e=t.toGeoJSON(),o=$(e,.05),i=await et(o);return s.geoJSON(i)}function it(t,e){let o=0,i=0,n=t.shift();for(const r of t){const l=r-n;l>e&&(o+=l,n=r),l<-e&&(i+=l,n=r)}return{elevationGain:Math.round(o),elevationLoss:Math.round(-i)}}function nt(t){const e=10,o=y(t).map(i=>i[2]);return it(o,e)}const T={className:"route"},st={tooltips:!1,allowSelfIntersection:!0,markerStyle:{draggable:!1},finishOn:null,templineStyle:{className:"route is-drawing"},hintlineStyle:{className:"route is-drawing"},pathOptions:T},rt={theme:"kartorama-theme",detached:!1,autohide:!0,collapsed:!1,position:"topright",followMarker:!1,imperial:!1,reverseCoords:!1,summary:!1,legend:!1,ruler:!1,width:400,height:150,responsive:!0},at={position:"bottomleft",drawCircle:!1,drawMarker:!1,drawCircleMarker:!1,drawRectangle:!1,drawPolygon:!1,dragMode:!1,cutPolygon:!1,rotateMode:!1,removalMode:!1,editMode:!1,drawPolyline:!0};function lt(t,e){const o=document.createElement("p");return o.innerHTML=`Distanse: ${t.distance} km. Opp: ${t.elevationGain} m. Ned: ${t.elevationLoss} m. `,o}function ct(t){const e=t.toGeoJSON(),o=_(e).toFixed(1),{elevationGain:i,elevationLoss:n}=nt(e),r=lt({elevationGain:i,elevationLoss:n,distance:o});t.bindPopup(r).openPopup()}function N(t){return t.controlElevationProfile._layers._layers}function dt(t){const e=N(t);Object.keys(e).length>0&&Object.values(e)[0].remove()}function ut(t){t.controlElevationProfile._container.style.display="none"}function ht(t){let e=[];return t.routeLayers.eachLayer(o=>{const i=o.toGeoJSON();e=[...e,...i.features]}),e}function m(t){function e(a){a.controlElevationProfile._container.style.display="block",a.controlElevationProfile.addTo(t)}function o(a){const c=N(a);Object.keys(c).length>0&&Object.values(c)[0].addTo(t)}function i(a){ut(a),dt(a),t.state.activeRouteLayer=void 0}function n(a){t.state.activeRouteLayer&&i(t.state.activeRouteLayer),o(a),e(a),t.state.activeRouteLayer=a}function r(a){const c=a.toGeoJSON();a.controlElevationProfile=s.control.elevation(rt),a.controlElevationProfile.addTo(t).loadData(c),ct(a),t.fitBounds(a.getBounds()),a.setStyle(T),t.addLayer(a),t.routeLayers.addLayer(a),n(a),a.on("click",p=>{n(p.target)})}function l(a,c){const p=1e3;return t.distance(a,c)/p}function u(){t.on("pm:drawstart",({workingLayer:a})=>{let c=0;const p=s.tooltip();a.bindTooltip(p),a.on("pm:vertexadded",g=>{const M=g.latlng,D=a.toGeoJSON();c=_(D),a.setTooltipContent(`${c.toFixed(1)} km`),a.openTooltip(g.latlng),t.on("mousemove",v=>{const A=v.latlng,R=l(M,A)+c;a.setTooltipContent(`${R.toFixed(1)} km`),a.openTooltip(v.latlng)})})})}async function h(a){const c=await ot(a);t.removeLayer(a),r(c)}return{init(){t.on("click",()=>{t.state.activeRouteLayer&&i(t.state.activeRouteLayer)}),t.routeLayers=s.layerGroup(),t.pm.setGlobalOptions(st),t.pm.setLang("no"),t.pm.addControls(at),t.on("pm:create",a=>{h(a.layer)}),u()},addElevationAndReplace:h}}const pt=[62.21344732933401,6.566903178568401],ft=10;function mt(){const t=s.map("map",{zoomControl:!1,pmIgnore:!1});s.PM.setOptIn(!0),t.state={};const e=window.localStorage.getItem("currentCenter")?JSON.parse(window.localStorage.getItem("currentCenter")):pt,o=window.localStorage.getItem("currentZoom")||ft;return t.setView(e,o),t}function gt(t){function e(){localStorage.setItem("currentZoom",t.getZoom())}s.control.zoom({position:"bottomleft"}).addTo(t),t.on("zoomend",e)}function vt(t){s.control.scale({imperial:!1,maxWidth:200}).addTo(t)}function I(t){const e=window.localStorage.getItem("activeBaseLayerName")||"Vektorkart";t.addLayer(f[e]);const o=window.localStorage.getItem("activeOverlayName")||"Helning";t.addLayer(E[o]),t.state.overlay=E[o]}function yt(t){I(t),s.control.groupedLayers(f,C,{exclusiveGroups:["Tillegg"],position:"bottomright",collapsed:!0}).addTo(t);function e(i){localStorage.setItem("activeBaseLayerName",i.name)}function o(i){localStorage.setItem("activeOverlayName",i.name)}t.on("baselayerchange",e),t.on("overlayadd",o)}function Lt(t){s.control.locate({position:"bottomleft",initialZoomLevel:15,icon:"fa fa-map-marker-alt"}).addTo(t);function e(){localStorage.setItem("currentCenter",JSON.stringify(t.getCenter()))}t.on("moveend",e)}function _t(t){s.Control.FileLayerLoad.LABEL="<span class='fa fa-file-upload'></span>";const e=s.Control.fileLayerLoad({layer:s.geoJson,layerOptions:{style:{className:"route"}},position:"topleft",fileSizeLimit:4e3});e.addTo(t),e.loader.on("data:error",o=>{alert("Feil! Sjekk konsollen"),console.log(o)}),e.loader.on("data:loaded",o=>{new m(t).addElevationAndReplace(o.layer)})}function wt(t){t.state.overlay||I(t);const e=window.localStorage.getItem("currentOpacity")||0;t.state.overlay.setOpacity(e);const o=s.control.slider(n=>{t.state.overlay.setOpacity(n)},{min:0,max:1,step:.01,position:"bottomright",collapsed:!1,syncSlider:!0,title:"Gjennomsiktighet",showValue:!1,value:t.state.overlay.options.opacity});o.addTo(t),o.slider.addEventListener("click",()=>{localStorage.setItem("currentOpacity",o.slider.valueAsNumber)});function i(n){if(t.state.overlay=n.layer,o.slider.valueAsNumber===0){const r=.2;t.state.overlay.setOpacity(r),o.slider.value=r}else t.state.overlay.setOpacity(o.slider.value)}t.on("overlayadd",i)}function St(t){const e=s.DomUtil.create("a","save-route-button leaflet-control-zoom-in",t);return e.href="#",e.title="Lagre rute",e.innerHTML="<span class='fa fa-save'></span>",e}s.Control.SaveRoute=s.Control.extend({options:{position:"topleft"},initialize(t){s.Util.setOptions(this,t)},onAdd(t){this._isLoading=!1,this._map=t,this._routeHandler=new m(this._map);const e=this.getRouteIdFromUrl();e&&this.loadRoute(e);const o=s.DomUtil.create("div","leaflet-control-save-route leaflet-bar");return this._button=St(o),s.DomEvent.on(this._button,"dblclick",s.DomEvent.stop,this).on(this._button,"click",s.DomEvent.stop,this).on(this._button,"click",this._saveRoute,this),o},onRemove(){this._isActive=!1,this._isLoading=!1,s.DomUtil.removeClass(this._button,"active"),s.DomUtil.removeClass(this._button,"loading")},_saveRoute(){s.DomUtil.addClass(this._button,"loading");const t=ht(this._map);t.length>0&&this._postRoute(t)},generatePath(t){return`/?routeid=${t}`},async _postRoute(t){const e=w("https://cvkrixhyrwhqqvrekwgz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNjkwNTE2MCwiZXhwIjoxOTUyNDgxMTYwfQ.H_zIyV0rN9nGxS5jVjSoo49UHdKw5n3fpQ6SZq21Z1g");try{const{data:o,error:i}=await e.from("routes").insert([{geojson:t}]);if(i)throw i;if(o){const n=this.generatePath(o[0].id);history.replaceState(void 0,"",n),alert(`Ruten er lagret p\xE5 ${window.location.origin+n}`)}}catch(o){alert(o.message)}},getRouteIdFromUrl(){const t=new URLSearchParams(window.location.search);return Object.fromEntries(t.entries()).routeid||void 0},async loadRoute(t){const e=w("https://cvkrixhyrwhqqvrekwgz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNjkwNTE2MCwiZXhwIjoxOTUyNDgxMTYwfQ.H_zIyV0rN9nGxS5jVjSoo49UHdKw5n3fpQ6SZq21Z1g");try{const{data:o,error:i,status:n}=await e.from("routes").select("id, geojson").eq("id",t).single();if(i&&n!==406)throw i;if(o)for(const r of o.geojson){const l=s.geoJSON(r).addTo(this._map);this._routeHandler.addElevationAndReplace(l)}}catch(o){alert(o.message)}}});s.Control.saveRoute=()=>new s.Control.SaveRoute;function Ot(t){s.Control.saveRoute().addTo(t)}const d=mt(),bt=new m(d);vt(d);gt(d);wt(d);yt(d);bt.init(d);_t(d);Lt(d);Ot(d);
//# sourceMappingURL=index.02362779.js.map
